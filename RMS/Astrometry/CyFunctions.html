<!DOCTYPE html>
<!-- Generated by Cython 0.29.33 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: CyFunctions.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #3D7B7B; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #9C6500 } /* Comment.Preproc */
.cython .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cython .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.cython .gr { color: #E40000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #008400 } /* Generic.Inserted */
.cython .go { color: #717171 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #687822 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #717171; font-weight: bold } /* Name.Entity */
.cython .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #767600 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #A45A77 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.33</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="CyFunctions.c">CyFunctions.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0001</span>: <span class="c">#!python</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0002</span>: <span class="c">#cython: language_level=3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0003</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0004</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0005</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0006</span>: <span class="c"># Cython import</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0007</span>: <span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0008</span>: <span class="k">cimport</span> <span class="nn">cython</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0009</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0010</span>: <span class="c"># Import the Python bool type</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0011</span>: <span class="k">from</span> <span class="nn">cpython</span> <span class="k">cimport</span> <span class="nb">bool</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0012</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0013</span>: <span class="c"># Define numpy types</span></pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0014</span>: <span class="n">INT_TYPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span></pre>
<pre class='cython code score-11 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_uint32);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_INT_TYPE, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0015</span>: <span class="k">ctypedef</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32_t</span> <span class="n">INT_TYPE_t</span></pre>
<pre class='cython code score-0 '>typedef __pyx_t_5numpy_uint32_t __pyx_t_3RMS_10Astrometry_11CyFunctions_INT_TYPE_t;
</pre><pre class="cython line score-0">&#xA0;<span class="">0016</span>: </pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0017</span>: <span class="n">FLOAT_TYPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span></pre>
<pre class='cython code score-11 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_FLOAT_TYPE, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0018</span>: <span class="k">ctypedef</span> <span class="n">np</span><span class="o">.</span><span class="n">float64_t</span> <span class="n">FLOAT_TYPE_t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0019</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0020</span>: <span class="c"># Declare math functions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0021</span>: <span class="k">cdef</span> <span class="kr">extern</span> <span class="k">from</span> <span class="s">&quot;math.h&quot;</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0022</span>:     <span class="n">double</span> <span class="n">fabs</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0023</span>:     <span class="n">double</span> <span class="n">sin</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0024</span>:     <span class="n">double</span> <span class="n">asin</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0025</span>:     <span class="n">double</span> <span class="n">cos</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0026</span>:     <span class="n">double</span> <span class="n">acos</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0027</span>:     <span class="n">double</span> <span class="n">tan</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0028</span>:     <span class="n">double</span> <span class="n">atan2</span><span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0029</span>:     <span class="n">double</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0030</span>:     <span class="n">double</span> <span class="n">hypot</span><span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0031</span>:     <span class="n">double</span> <span class="n">fmod</span><span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0032</span>:     <span class="n">double</span> <span class="n">M_PI</span> <span class="s">&quot;M_PI&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0034</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0035</span>: <span class="c"># Define Pi</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0036</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pi</span> <span class="o">=</span> <span class="n">M_PI</span></pre>
<pre class='cython code score-0 '>  __pyx_v_3RMS_10Astrometry_11CyFunctions_pi = M_PI;
</pre><pre class="cython line score-0">&#xA0;<span class="">0037</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0038</span>: <span class="c"># Define the Julian date at the J2000 epoch</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0039</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">J2000_DAYS</span> <span class="o">=</span> <span class="mf">2451545.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS = 2451545.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0040</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0041</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0042</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0043</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0044</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">radians</span><span class="p">(</span><span class="n">double</span> <span class="n">deg</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static double __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(double __pyx_v_deg) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("radians", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0045</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts degrees to radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0046</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0047</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0048</span>:     <span class="k">return</span> <span class="n">deg</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_r = ((__pyx_v_deg / 180.0) * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0049</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0051</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0052</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0053</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">degrees</span><span class="p">(</span><span class="n">double</span> <span class="n">deg</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static double __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(double __pyx_v_deg) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("degrees", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0054</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts radians to degrees.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0055</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0056</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0057</span>:     <span class="k">return</span> <span class="n">deg</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">pi</span></pre>
<pre class='cython code score-0 '>  __pyx_r = ((__pyx_v_deg * 180.0) / __pyx_v_3RMS_10Astrometry_11CyFunctions_pi);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0058</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0059</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0060</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sign</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static double __pyx_f_3RMS_10Astrometry_11CyFunctions_sign(double __pyx_v_x) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sign", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0061</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_x &gt;= 1.0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0062</span>:         <span class="k">return</span> <span class="mf">1.0</span></pre>
<pre class='cython code score-0 '>    __pyx_r = 1.0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0063</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0064</span>:     <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span></pre>
<pre class='cython code score-0 '>  __pyx_r = -1.0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0065</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0066</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0067</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0068</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0069</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0070</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-85" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0071</span>: <span class="k">cpdef</span> <span class="kt">double</span> <span class="nf">angularSeparation</span><span class="p">(</span><span class="n">double</span> <span class="n">ra1</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec1</span><span class="p">,</span> <span class="n">double</span> <span class="n">ra2</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec2</span><span class="p">):</span></pre>
<pre class='cython code score-85 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_1angularSeparation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static double __pyx_f_3RMS_10Astrometry_11CyFunctions_angularSeparation(double __pyx_v_ra1, double __pyx_v_dec1, double __pyx_v_ra2, double __pyx_v_dec2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angularSeparation", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_1angularSeparation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_angularSeparation[] = " Calculate the angular separation between 2 stars in equatorial celestial coordinates. \n\n    Source of the equation: http://www.astronomycafe.net/qadir/q1890.html (May 1, 2016)\n\n    @param ra1: [float] right ascension of the first stars (in degrees)\n    @param dec1: [float] declination of the first star (in degrees)\n    @param ra2: [float] right ascension of the decons stars (in degrees)\n    @param dec2: [float] declination of the decons star (in degrees)\n\n    @return angular_separation: [float] angular separation (in degrees)\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_1angularSeparation(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_ra1;
  double __pyx_v_dec1;
  double __pyx_v_ra2;
  double __pyx_v_dec2;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angularSeparation (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra1,&amp;__pyx_n_s_dec1,&amp;__pyx_n_s_ra2,&amp;__pyx_n_s_dec2,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angularSeparation", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angularSeparation", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angularSeparation", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "angularSeparation") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_ra1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_ra1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
    __pyx_v_dec1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dec1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
    __pyx_v_ra2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_ra2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
    __pyx_v_dec2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_dec2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angularSeparation", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.angularSeparation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_angularSeparation(__pyx_self, __pyx_v_ra1, __pyx_v_dec1, __pyx_v_ra2, __pyx_v_dec2);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_angularSeparation(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra1, double __pyx_v_dec1, double __pyx_v_ra2, double __pyx_v_dec2) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angularSeparation", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_angularSeparation(__pyx_v_ra1, __pyx_v_dec1, __pyx_v_ra2, __pyx_v_dec2, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 71, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.angularSeparation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0072</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the angular separation between 2 stars in equatorial celestial coordinates. </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0073</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0074</span>: <span class="sd">    Source of the equation: http://www.astronomycafe.net/qadir/q1890.html (May 1, 2016)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0075</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0076</span>: <span class="sd">    @param ra1: [float] right ascension of the first stars (in degrees)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0077</span>: <span class="sd">    @param dec1: [float] declination of the first star (in degrees)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0078</span>: <span class="sd">    @param ra2: [float] right ascension of the decons stars (in degrees)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0079</span>: <span class="sd">    @param dec2: [float] declination of the decons star (in degrees)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0080</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0081</span>: <span class="sd">    @return angular_separation: [float] angular separation (in degrees)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0082</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0083</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0084</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">deldec2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0085</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">delra2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0086</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sindis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0087</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0088</span>:     <span class="c"># Convert input coordinates to radians</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0089</span>:     <span class="n">ra1</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">ra1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ra1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_ra1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0090</span>:     <span class="n">dec1</span> <span class="o">=</span>  <span class="n">radians</span><span class="p">(</span><span class="n">dec1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dec1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_dec1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0091</span>:     <span class="n">ra2</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">ra2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ra2 = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_ra2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0092</span>:     <span class="n">dec2</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">dec2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dec2 = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_dec2);
</pre><pre class="cython line score-0">&#xA0;<span class="">0093</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0094</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0095</span>:     <span class="c"># Classical method</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0096</span>:     <span class="k">return</span> <span class="n">degrees</span><span class="p">(</span><span class="n">acos</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">dec1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dec2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">dec1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">dec2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">ra2</span> <span class="o">-</span> <span class="n">ra1</span><span class="p">)))</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(acos(((sin(__pyx_v_dec1) * sin(__pyx_v_dec2)) + ((cos(__pyx_v_dec1) * cos(__pyx_v_dec2)) * cos((__pyx_v_ra2 - __pyx_v_ra1))))));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0097</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0098</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0099</span>:     <span class="c"># # Compute the angular separation using the haversine formula</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0100</span>:     <span class="c"># #   Source: https://idlastro.gsfc.nasa.gov/ftp/pro/astro/gcirc.pro</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0101</span>:     <span class="c"># deldec2 = (dec2 - dec1)/2.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0102</span>:     <span class="c"># delra2 =  (ra2 - ra1)/2.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0103</span>:     <span class="c"># sindis = sqrt(sin(deldec2)*sin(deldec2) + cos(dec1)*cos(dec2)*sin(delra2)*sin(delra2))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0104</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0105</span>:     <span class="c"># return degrees(2.0*asin(sindis))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0106</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0107</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0108</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0109</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0110</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0111</span>: <span class="k">def</span> <span class="nf">subsetCatalog</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">catalog_list</span><span class="p">,</span> <span class="n">double</span> <span class="n">ra_c</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec_c</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span></pre>
<pre class='cython code score-40 '>/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_3subsetCatalog(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_2subsetCatalog[] = " Make a subset of stars from the given star catalog around the given coordinates with a given radius.\n    \n    Arguments:\n        catalog_list: [ndarray] An array of (ra, dec, mag) pairs for stars (J2000, degrees). Note that the \n            array needs to be sorted by descending declination!\n        ra_c: [float] Centre of extraction RA (degrees).\n        dec_c: [float] Centre of extraction dec (degrees).\n        jd: [float] Julian date of observations.\n        lat: [float] Observer latitude (deg).\n        lon: [float] Observer longitude (deg).\n        radius: [float] Extraction radius (degrees).\n        mag_limit: [float] Limiting magnitude.\n\n    Keyword arguments:\n        remove_under_horizon: [bool] Remove stars below the horizon (-5 deg below).\n\n    Return:\n        filtered_indices, filtered_list: (ndarray, ndarray)\n            - filtered_indices - Indices of catalog_list entries which satisfy the filters.\n            - filtered_list - catalog_list entires that satisfy the filters.\n        ...\n\n    ";
static PyMethodDef __pyx_mdef_3RMS_10Astrometry_11CyFunctions_3subsetCatalog = {"subsetCatalog", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_3RMS_10Astrometry_11CyFunctions_3subsetCatalog, METH_VARARGS|METH_KEYWORDS, __pyx_doc_3RMS_10Astrometry_11CyFunctions_2subsetCatalog};
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_3subsetCatalog(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_catalog_list = 0;
  double __pyx_v_ra_c;
  double __pyx_v_dec_c;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  double __pyx_v_radius;
  double __pyx_v_mag_limit;
  PyBoolObject *__pyx_v_remove_under_horizon = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("subsetCatalog (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_catalog_list,&amp;__pyx_n_s_ra_c,&amp;__pyx_n_s_dec_c,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,&amp;__pyx_n_s_radius,&amp;__pyx_n_s_mag_limit,&amp;__pyx_n_s_remove_under_horizon,0};
    PyObject* values[9] = {0,0,0,0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_2subsetCatalog(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_catalog_list, double __pyx_v_ra_c, double __pyx_v_dec_c, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, double __pyx_v_radius, double __pyx_v_mag_limit, PyBoolObject *__pyx_v_remove_under_horizon) {
  int __pyx_v_i;
  int __pyx_v_k;
  double __pyx_v_dec_min;
  double __pyx_v_dec_max;
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_mag;
  double __pyx_v_elev;
  PyArrayObject *__pyx_v_filtered_list = 0;
  PyArrayObject *__pyx_v_filtered_indices = 0;
  CYTHON_UNUSED double __pyx_v__;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_catalog_list;
  __Pyx_Buffer __pyx_pybuffer_catalog_list;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_filtered_indices;
  __Pyx_Buffer __pyx_pybuffer_filtered_indices;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_filtered_list;
  __Pyx_Buffer __pyx_pybuffer_filtered_list;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("subsetCatalog", 0);
  __pyx_pybuffer_filtered_list.pybuffer.buf = NULL;
  __pyx_pybuffer_filtered_list.refcount = 0;
  __pyx_pybuffernd_filtered_list.data = NULL;
  __pyx_pybuffernd_filtered_list.rcbuffer = &amp;__pyx_pybuffer_filtered_list;
  __pyx_pybuffer_filtered_indices.pybuffer.buf = NULL;
  __pyx_pybuffer_filtered_indices.refcount = 0;
  __pyx_pybuffernd_filtered_indices.data = NULL;
  __pyx_pybuffernd_filtered_indices.rcbuffer = &amp;__pyx_pybuffer_filtered_indices;
  __pyx_pybuffer_catalog_list.pybuffer.buf = NULL;
  __pyx_pybuffer_catalog_list.refcount = 0;
  __pyx_pybuffernd_catalog_list.data = NULL;
  __pyx_pybuffernd_catalog_list.rcbuffer = &amp;__pyx_pybuffer_catalog_list;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_catalog_list, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_catalog_list.diminfo[0].strides = __pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_catalog_list.diminfo[0].shape = __pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_catalog_list.diminfo[1].strides = __pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_catalog_list.diminfo[1].shape = __pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_filtered_indices.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.subsetCatalog", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_filtered_indices.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_filtered_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_filtered_indices);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(20, __pyx_n_s_catalog_list, __pyx_n_s_ra_c, __pyx_n_s_dec_c, __pyx_n_s_jd, __pyx_n_s_lat, __pyx_n_s_lon, __pyx_n_s_radius, __pyx_n_s_mag_limit, __pyx_n_s_remove_under_horizon, __pyx_n_s_i, __pyx_n_s_k, __pyx_n_s_dec_min, __pyx_n_s_dec_max, __pyx_n_s_ra, __pyx_n_s_dec, __pyx_n_s_mag, __pyx_n_s_elev, __pyx_n_s_filtered_list, __pyx_n_s_filtered_indices, __pyx_n_s__5);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3RMS_10Astrometry_11CyFunctions_3subsetCatalog, NULL, __pyx_n_s_RMS_Astrometry_CyFunctions);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_subsetCatalog, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__7 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(9, 0, 20, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_RMS_Astrometry_CyFunctions_pyx, __pyx_n_s_subsetCatalog, 111, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
</pre><pre class="cython line score-138" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0112</span>:         <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span> <span class="n">double</span> <span class="n">radius</span><span class="p">,</span> <span class="n">double</span> <span class="n">mag_limit</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">remove_under_horizon</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-138 '>    values[8] = (PyObject *)((PyBoolObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_catalog_list)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra_c)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, 1); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec_c)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, 2); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, 3); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, 4); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, 5); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_radius)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, 6); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mag_limit)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, 7); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_remove_under_horizon);
          if (value) { values[8] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "subsetCatalog") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_catalog_list = ((PyArrayObject *)values[0]);
    __pyx_v_ra_c = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_ra_c == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
    __pyx_v_dec_c = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_dec_c == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
    __pyx_v_radius = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_radius == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
    __pyx_v_mag_limit = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_mag_limit == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L3_error)</span>
    __pyx_v_remove_under_horizon = ((PyBoolObject *)values[8]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("subsetCatalog", 0, 8, 9, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.subsetCatalog", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_catalog_list), __pyx_ptype_5numpy_ndarray, 1, "catalog_list", 0))) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_remove_under_horizon), __pyx_ptype_7cpython_4bool_bool, 1, "remove_under_horizon", 0))) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_2subsetCatalog(__pyx_self, __pyx_v_catalog_list, __pyx_v_ra_c, __pyx_v_dec_c, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, __pyx_v_radius, __pyx_v_mag_limit, __pyx_v_remove_under_horizon);
</pre><pre class="cython line score-0">&#xA0;<span class="">0113</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Make a subset of stars from the given star catalog around the given coordinates with a given radius.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0114</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0115</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0116</span>: <span class="sd">        catalog_list: [ndarray] An array of (ra, dec, mag) pairs for stars (J2000, degrees). Note that the </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0117</span>: <span class="sd">            array needs to be sorted by descending declination!</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0118</span>: <span class="sd">        ra_c: [float] Centre of extraction RA (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0119</span>: <span class="sd">        dec_c: [float] Centre of extraction dec (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0120</span>: <span class="sd">        jd: [float] Julian date of observations.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0121</span>: <span class="sd">        lat: [float] Observer latitude (deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0122</span>: <span class="sd">        lon: [float] Observer longitude (deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0123</span>: <span class="sd">        radius: [float] Extraction radius (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0124</span>: <span class="sd">        mag_limit: [float] Limiting magnitude.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0125</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0126</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0127</span>: <span class="sd">        remove_under_horizon: [bool] Remove stars below the horizon (-5 deg below).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0128</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0129</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0130</span>: <span class="sd">        filtered_indices, filtered_list: (ndarray, ndarray)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0131</span>: <span class="sd">            - filtered_indices - Indices of catalog_list entries which satisfy the filters.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0132</span>: <span class="sd">            - filtered_list - catalog_list entires that satisfy the filters.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0133</span>: <span class="sd">        ...</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0134</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0135</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0136</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0137</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0138</span>:     <span class="c"># Define variables</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0139</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">k</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0140</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dec_min</span><span class="p">,</span> <span class="nf">dec_max</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0141</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ra</span><span class="p">,</span> <span class="nf">dec</span><span class="p">,</span> <span class="nf">mag</span><span class="p">,</span> <span class="nf">elev</span></pre>
<pre class="cython line score-31" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0142</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">filtered_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">catalog_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="w">\</span></pre>
<pre class='cython code score-31 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>((__pyx_v_catalog_list-&gt;dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
/* … */
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_shape, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 142, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_filtered_list = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 142, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_filtered_list.diminfo[0].strides = __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_filtered_list.diminfo[0].shape = __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_filtered_list.diminfo[1].strides = __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_filtered_list.diminfo[1].shape = __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_filtered_list = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0143</span>:         <span class="n">catalog_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_TYPE</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>((__pyx_v_catalog_list-&gt;dimensions[1]));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
/* … */
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_FLOAT_TYPE);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0144</span>: </pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0145</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">INT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">filtered_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">catalog_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]),</span> <span class="w">\</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>((__pyx_v_catalog_list-&gt;dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_shape, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_filtered_indices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_INT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_filtered_indices = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_filtered_indices.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_filtered_indices.diminfo[0].strides = __pyx_pybuffernd_filtered_indices.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_filtered_indices.diminfo[0].shape = __pyx_pybuffernd_filtered_indices.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_filtered_indices = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0146</span>:         <span class="n">dtype</span><span class="o">=</span><span class="n">INT_TYPE</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_INT_TYPE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0147</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0148</span>:     <span class="c"># Calculate minimum and maximum declination</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0149</span>:     <span class="n">dec_min</span> <span class="o">=</span> <span class="n">dec_c</span> <span class="o">-</span> <span class="n">radius</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dec_min = (__pyx_v_dec_c - __pyx_v_radius);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0150</span>:     <span class="k">if</span> <span class="n">dec_min</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_dec_min &lt; -90.0) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0151</span>:         <span class="n">dec_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dec_min = -90.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0152</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0153</span>:     <span class="n">dec_max</span> <span class="o">=</span> <span class="n">dec_c</span> <span class="o">+</span> <span class="n">radius</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dec_max = (__pyx_v_dec_c + __pyx_v_radius);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0154</span>:     <span class="k">if</span> <span class="n">dec_max</span> <span class="o">&gt;</span> <span class="mf">90</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_dec_max &gt; 90.0) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0155</span>:         <span class="n">dec_max</span> <span class="o">=</span> <span class="mf">90</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dec_max = 90.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0156</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0157</span>:     <span class="n">k</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_k = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0158</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">catalog_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = (__pyx_v_catalog_list-&gt;dimensions[0]);
  __pyx_t_10 = __pyx_t_9;
  for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_i = __pyx_t_11;
</pre><pre class="cython line score-0">&#xA0;<span class="">0159</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0160</span>:         <span class="n">ra</span> <span class="o">=</span> <span class="n">catalog_list</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_t_13 = 0;
    __pyx_v_ra = (*__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_catalog_list.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_catalog_list.diminfo[1].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0161</span>:         <span class="n">dec</span> <span class="o">=</span> <span class="n">catalog_list</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = __pyx_v_i;
    __pyx_t_12 = 1;
    __pyx_v_dec = (*__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_catalog_list.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_catalog_list.diminfo[1].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0162</span>:         <span class="n">mag</span> <span class="o">=</span> <span class="n">catalog_list</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_t_13 = 2;
    __pyx_v_mag = (*__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_catalog_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_catalog_list.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_catalog_list.diminfo[1].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0163</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0164</span>:         <span class="c"># Skip if the declination is too large</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0165</span>:         <span class="k">if</span> <span class="n">dec</span> <span class="o">&gt;</span> <span class="n">dec_max</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_dec &gt; __pyx_v_dec_max) != 0);
    if (__pyx_t_8) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0166</span>:             <span class="k">continue</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L5_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0167</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0168</span>:         <span class="c"># End the loop if the declination is too small</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0169</span>:         <span class="k">if</span> <span class="n">dec</span> <span class="o">&lt;</span> <span class="n">dec_min</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_dec &lt; __pyx_v_dec_min) != 0);
    if (__pyx_t_8) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0170</span>:             <span class="k">break</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L6_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">0171</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0172</span>:         <span class="c"># Add star to the list if it is within a given radius and has a certain brightness</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0173</span>:         <span class="k">if</span> <span class="p">(</span><span class="n">angularSeparation</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">ra_c</span><span class="p">,</span> <span class="n">dec_c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mag</span> <span class="o">&lt;=</span> <span class="n">mag_limit</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_14 = ((__pyx_f_3RMS_10Astrometry_11CyFunctions_angularSeparation(__pyx_v_ra, __pyx_v_dec, __pyx_v_ra_c, __pyx_v_dec_c, 0) &lt;= __pyx_v_radius) != 0);
    if (__pyx_t_14) {
    } else {
      __pyx_t_8 = __pyx_t_14;
      goto __pyx_L10_bool_binop_done;
    }
    __pyx_t_14 = ((__pyx_v_mag &lt;= __pyx_v_mag_limit) != 0);
    __pyx_t_8 = __pyx_t_14;
    __pyx_L10_bool_binop_done:;
    if (__pyx_t_8) {
/* … */
    }
    __pyx_L5_continue:;
  }
  __pyx_L6_break:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0174</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0175</span>:             <span class="c"># Compute the local star elevation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0176</span>:             <span class="n">_</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">cyraDec2AltAz</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">dec</span><span class="p">),</span> <span class="n">jd</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_15 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyraDec2AltAz(__pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_ra), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_dec), __pyx_v_jd, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lat), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lon), 0);
      __pyx_t_16 = __pyx_t_15.f0;
      __pyx_t_17 = __pyx_t_15.f1;
      __pyx_v__ = __pyx_t_16;
      __pyx_v_elev = __pyx_t_17;
</pre><pre class="cython line score-0">&#xA0;<span class="">0177</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0178</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0179</span>:             <span class="c"># Only take stars above -5 degrees, if the filtering is on</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0180</span>:             <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">remove_under_horizon</span> <span class="ow">and</span> <span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">5</span><span class="p">)):</span></pre>
<pre class='cython code score-2 '>      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_remove_under_horizon)); if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 180, __pyx_L1_error)</span>
      if (__pyx_t_14) {
      } else {
        __pyx_t_8 = __pyx_t_14;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_14 = ((__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_elev) &lt; -5.0) != 0);
      __pyx_t_8 = __pyx_t_14;
      __pyx_L13_bool_binop_done:;
      __pyx_t_14 = ((!__pyx_t_8) != 0);
      if (__pyx_t_14) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">0181</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0182</span>:                 <span class="n">filtered_list</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ra</span></pre>
<pre class='cython code score-0 '>        __pyx_t_13 = __pyx_v_k;
        __pyx_t_12 = 0;
        *__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_filtered_list.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_filtered_list.diminfo[1].strides) = __pyx_v_ra;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0183</span>:                 <span class="n">filtered_list</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dec</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = __pyx_v_k;
        __pyx_t_13 = 1;
        *__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_filtered_list.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_filtered_list.diminfo[1].strides) = __pyx_v_dec;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0184</span>:                 <span class="n">filtered_list</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span></pre>
<pre class='cython code score-0 '>        __pyx_t_13 = __pyx_v_k;
        __pyx_t_12 = 2;
        *__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_filtered_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_filtered_list.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_filtered_list.diminfo[1].strides) = __pyx_v_mag;
</pre><pre class="cython line score-0">&#xA0;<span class="">0185</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0186</span>:                 <span class="c"># Add index to the list of indices which passed the filter</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0187</span>:                 <span class="n">filtered_indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = __pyx_v_k;
        *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_INT_TYPE_t *, __pyx_pybuffernd_filtered_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_filtered_indices.diminfo[0].strides) = __pyx_v_i;
</pre><pre class="cython line score-0">&#xA0;<span class="">0188</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0189</span>:                 <span class="c"># Increment filtered list counter</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0190</span>:                 <span class="n">k</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>        __pyx_v_k = (__pyx_v_k + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">0191</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0192</span>: </pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0193</span>:     <span class="k">return</span> <span class="n">filtered_indices</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="n">filtered_list</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_k);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_filtered_indices), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_k);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_5, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_filtered_list), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_5);
  __pyx_t_2 = 0;
  __pyx_t_5 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0194</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0195</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0196</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0197</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0198</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-112" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0199</span>: <span class="k">def</span> <span class="nf">matchStars</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">stars_list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">cat_x_array</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-112 '>/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_5matchStars(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_3RMS_10Astrometry_11CyFunctions_5matchStars = {"matchStars", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_3RMS_10Astrometry_11CyFunctions_5matchStars, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_5matchStars(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_stars_list = 0;
  PyArrayObject *__pyx_v_cat_x_array = 0;
  PyArrayObject *__pyx_v_cat_y_array = 0;
  PyArrayObject *__pyx_v_cat_good_indices = 0;
  double __pyx_v_max_radius;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("matchStars (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_stars_list,&amp;__pyx_n_s_cat_x_array,&amp;__pyx_n_s_cat_y_array,&amp;__pyx_n_s_cat_good_indices,&amp;__pyx_n_s_max_radius,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_stars_list)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cat_x_array)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("matchStars", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cat_y_array)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("matchStars", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cat_good_indices)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("matchStars", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_max_radius)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("matchStars", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "matchStars") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_stars_list = ((PyArrayObject *)values[0]);
    __pyx_v_cat_x_array = ((PyArrayObject *)values[1]);
    __pyx_v_cat_y_array = ((PyArrayObject *)values[2]);
    __pyx_v_cat_good_indices = ((PyArrayObject *)values[3]);
    __pyx_v_max_radius = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_max_radius == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 201, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("matchStars", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.matchStars", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_stars_list), __pyx_ptype_5numpy_ndarray, 1, "stars_list", 0))) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_cat_x_array), __pyx_ptype_5numpy_ndarray, 1, "cat_x_array", 0))) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_cat_y_array), __pyx_ptype_5numpy_ndarray, 1, "cat_y_array", 0))) <span class='error_goto'>__PYX_ERR(0, 200, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_cat_good_indices), __pyx_ptype_5numpy_ndarray, 1, "cat_good_indices", 0))) <span class='error_goto'>__PYX_ERR(0, 200, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_4matchStars(__pyx_self, __pyx_v_stars_list, __pyx_v_cat_x_array, __pyx_v_cat_y_array, __pyx_v_cat_good_indices, __pyx_v_max_radius);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_4matchStars(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_stars_list, PyArrayObject *__pyx_v_cat_x_array, PyArrayObject *__pyx_v_cat_y_array, PyArrayObject *__pyx_v_cat_good_indices, double __pyx_v_max_radius) {
  int __pyx_v_i;
  int __pyx_v_j;
  unsigned int __pyx_v_cat_idx;
  int __pyx_v_k;
  double __pyx_v_min_dist;
  double __pyx_v_dist;
  double __pyx_v_cat_match_indx;
  double __pyx_v_im_star_y;
  double __pyx_v_im_star_x;
  double __pyx_v_cat_x;
  double __pyx_v_cat_y;
  int __pyx_v_stars_len;
  int __pyx_v_cat_len;
  PyArrayObject *__pyx_v_matched_indices = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cat_good_indices;
  __Pyx_Buffer __pyx_pybuffer_cat_good_indices;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cat_x_array;
  __Pyx_Buffer __pyx_pybuffer_cat_x_array;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cat_y_array;
  __Pyx_Buffer __pyx_pybuffer_cat_y_array;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_matched_indices;
  __Pyx_Buffer __pyx_pybuffer_matched_indices;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_stars_list;
  __Pyx_Buffer __pyx_pybuffer_stars_list;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("matchStars", 0);
  __pyx_pybuffer_matched_indices.pybuffer.buf = NULL;
  __pyx_pybuffer_matched_indices.refcount = 0;
  __pyx_pybuffernd_matched_indices.data = NULL;
  __pyx_pybuffernd_matched_indices.rcbuffer = &amp;__pyx_pybuffer_matched_indices;
  __pyx_pybuffer_stars_list.pybuffer.buf = NULL;
  __pyx_pybuffer_stars_list.refcount = 0;
  __pyx_pybuffernd_stars_list.data = NULL;
  __pyx_pybuffernd_stars_list.rcbuffer = &amp;__pyx_pybuffer_stars_list;
  __pyx_pybuffer_cat_x_array.pybuffer.buf = NULL;
  __pyx_pybuffer_cat_x_array.refcount = 0;
  __pyx_pybuffernd_cat_x_array.data = NULL;
  __pyx_pybuffernd_cat_x_array.rcbuffer = &amp;__pyx_pybuffer_cat_x_array;
  __pyx_pybuffer_cat_y_array.pybuffer.buf = NULL;
  __pyx_pybuffer_cat_y_array.refcount = 0;
  __pyx_pybuffernd_cat_y_array.data = NULL;
  __pyx_pybuffernd_cat_y_array.rcbuffer = &amp;__pyx_pybuffer_cat_y_array;
  __pyx_pybuffer_cat_good_indices.pybuffer.buf = NULL;
  __pyx_pybuffer_cat_good_indices.refcount = 0;
  __pyx_pybuffernd_cat_good_indices.data = NULL;
  __pyx_pybuffernd_cat_good_indices.rcbuffer = &amp;__pyx_pybuffer_cat_good_indices;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_stars_list, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_stars_list.diminfo[0].strides = __pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_stars_list.diminfo[0].shape = __pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_stars_list.diminfo[1].strides = __pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_stars_list.diminfo[1].shape = __pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cat_x_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_cat_x_array, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_cat_x_array.diminfo[0].strides = __pyx_pybuffernd_cat_x_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cat_x_array.diminfo[0].shape = __pyx_pybuffernd_cat_x_array.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cat_y_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_cat_y_array, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_cat_y_array.diminfo[0].strides = __pyx_pybuffernd_cat_y_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cat_y_array.diminfo[0].shape = __pyx_pybuffernd_cat_y_array.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cat_good_indices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_cat_good_indices, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_INT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_cat_good_indices.diminfo[0].strides = __pyx_pybuffernd_cat_good_indices.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cat_good_indices.diminfo[0].shape = __pyx_pybuffernd_cat_good_indices.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cat_good_indices.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cat_x_array.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cat_y_array.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.matchStars", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cat_good_indices.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cat_x_array.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cat_y_array.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_matched_indices);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__8 = <span class='py_c_api'>PyTuple_Pack</span>(19, __pyx_n_s_stars_list, __pyx_n_s_cat_x_array, __pyx_n_s_cat_y_array, __pyx_n_s_cat_good_indices, __pyx_n_s_max_radius, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_cat_idx, __pyx_n_s_k, __pyx_n_s_min_dist, __pyx_n_s_dist, __pyx_n_s_cat_match_indx, __pyx_n_s_im_star_y, __pyx_n_s_im_star_x, __pyx_n_s_cat_x, __pyx_n_s_cat_y, __pyx_n_s_stars_len, __pyx_n_s_cat_len, __pyx_n_s_matched_indices);<span class='error_goto'> if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 199, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__8);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3RMS_10Astrometry_11CyFunctions_5matchStars, NULL, __pyx_n_s_RMS_Astrometry_CyFunctions);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_matchStars, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__9 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__8, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_RMS_Astrometry_CyFunctions_pyx, __pyx_n_s_matchStars, 199, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 199, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0200</span>:     <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">cat_y_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">INT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">cat_good_indices</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0201</span>:     <span class="n">double</span> <span class="n">max_radius</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0202</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0203</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0204</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0205</span>:     <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">cat_idx</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0206</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">k</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_k = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0207</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">min_dist</span><span class="p">,</span> <span class="nf">dist</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0208</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">cat_match_indx</span><span class="p">,</span> <span class="nf">im_star_y</span><span class="p">,</span> <span class="nf">im_star_x</span><span class="p">,</span> <span class="nf">cat_x</span><span class="p">,</span> <span class="nf">cat_y</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0209</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0210</span>:     <span class="c"># Get the lengths of input arrays</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0211</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">stars_len</span> <span class="o">=</span> <span class="n">stars_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_stars_len = (__pyx_v_stars_list-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0212</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">cat_len</span> <span class="o">=</span> <span class="n">cat_good_indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_cat_len = (__pyx_v_cat_good_indices-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0213</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0214</span>:     <span class="c"># List for matched indices</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0215</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">matched_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">stars_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="mf">3</span><span class="p">),</span> <span class="w">\</span></pre>
<pre class='cython code score-32 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>((__pyx_v_stars_list-&gt;dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_3);
  __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_shape, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_matched_indices = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_matched_indices.diminfo[0].strides = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matched_indices.diminfo[0].shape = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matched_indices.diminfo[1].strides = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matched_indices.diminfo[1].shape = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_matched_indices = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0216</span>:         <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT_TYPE</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_FLOAT_TYPE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 216, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0217</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0218</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0219</span>:     <span class="c">### Match image and catalog stars ###</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0220</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0221</span>:     <span class="c"># Go through all image stars</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0222</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stars_len</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_6 = __pyx_v_stars_len;
  __pyx_t_7 = __pyx_t_6;
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">0223</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0224</span>:         <span class="c"># Extract image star coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0225</span>:         <span class="n">im_star_y</span> <span class="o">=</span> <span class="n">stars_list</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = 0;
    __pyx_v_im_star_y = (*__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_stars_list.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_stars_list.diminfo[1].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0226</span>:         <span class="n">im_star_x</span> <span class="o">=</span> <span class="n">stars_list</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_i;
    __pyx_t_9 = 1;
    __pyx_v_im_star_x = (*__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_stars_list.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_stars_list.diminfo[0].strides, __pyx_t_9, __pyx_pybuffernd_stars_list.diminfo[1].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0227</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0228</span>:         <span class="n">min_dist</span> <span class="o">=</span> <span class="n">max_radius</span></pre>
<pre class='cython code score-0 '>    __pyx_v_min_dist = __pyx_v_max_radius;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0229</span>:         <span class="n">cat_match_indx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_cat_match_indx = -1.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0230</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0231</span>:         <span class="c"># Check for the best match among catalog stars</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0232</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cat_len</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_cat_len;
    __pyx_t_12 = __pyx_t_11;
    for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_12; __pyx_t_13+=1) {
      __pyx_v_j = __pyx_t_13;
</pre><pre class="cython line score-0">&#xA0;<span class="">0233</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0234</span>:             <span class="n">cat_idx</span> <span class="o">=</span> <span class="n">cat_good_indices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_j;
      __pyx_v_cat_idx = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_INT_TYPE_t *, __pyx_pybuffernd_cat_good_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_cat_good_indices.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0235</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0236</span>:             <span class="c"># Extract catalog coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0237</span>:             <span class="n">cat_x</span> <span class="o">=</span> <span class="n">cat_x_array</span><span class="p">[</span><span class="n">cat_idx</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_14 = __pyx_v_cat_idx;
      __pyx_v_cat_x = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_cat_x_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_cat_x_array.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0238</span>:             <span class="n">cat_y</span> <span class="o">=</span> <span class="n">cat_y_array</span><span class="p">[</span><span class="n">cat_idx</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_14 = __pyx_v_cat_idx;
      __pyx_v_cat_y = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_cat_y_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_cat_y_array.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0239</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0240</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0241</span>:             <span class="c"># Calculate the distance between stars</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0242</span>:             <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">im_star_x</span> <span class="o">-</span> <span class="n">cat_x</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">im_star_y</span> <span class="o">-</span> <span class="n">cat_y</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dist = sqrt((pow((__pyx_v_im_star_x - __pyx_v_cat_x), 2.0) + pow((__pyx_v_im_star_y - __pyx_v_cat_y), 2.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0243</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0244</span>:             <span class="c"># Set the catalog star as the best match if it is the closest to the image star than any previous</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0245</span>:             <span class="k">if</span> <span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_15 = ((__pyx_v_dist &lt; __pyx_v_min_dist) != 0);
      if (__pyx_t_15) {
/* … */
      }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0246</span>:                 <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span></pre>
<pre class='cython code score-0 '>        __pyx_v_min_dist = __pyx_v_dist;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0247</span>:                 <span class="n">cat_match_indx</span> <span class="o">=</span> <span class="n">cat_idx</span></pre>
<pre class='cython code score-0 '>        __pyx_v_cat_match_indx = __pyx_v_cat_idx;
</pre><pre class="cython line score-0">&#xA0;<span class="">0248</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0249</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0250</span>:         <span class="c"># Take the best matched star if the distance was within the maximum radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0251</span>:         <span class="k">if</span> <span class="n">min_dist</span> <span class="o">&lt;</span> <span class="n">max_radius</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_15 = ((__pyx_v_min_dist &lt; __pyx_v_max_radius) != 0);
    if (__pyx_t_15) {
/* … */
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0252</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0253</span>:             <span class="c"># Add the matched indices to the output list</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0254</span>:             <span class="n">matched_indices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_k;
      __pyx_t_10 = 0;
      *__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_matched_indices.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_matched_indices.diminfo[1].strides) = __pyx_v_i;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0255</span>:             <span class="n">matched_indices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat_match_indx</span></pre>
<pre class='cython code score-0 '>      __pyx_t_10 = __pyx_v_k;
      __pyx_t_9 = 1;
      *__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_matched_indices.diminfo[0].strides, __pyx_t_9, __pyx_pybuffernd_matched_indices.diminfo[1].strides) = __pyx_v_cat_match_indx;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0256</span>:             <span class="n">matched_indices</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_dist</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_k;
      __pyx_t_10 = 2;
      *__Pyx_BufPtrStrided2d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_matched_indices.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_matched_indices.diminfo[1].strides) = __pyx_v_min_dist;
</pre><pre class="cython line score-0">&#xA0;<span class="">0257</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0258</span>:             <span class="n">k</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_v_k = (__pyx_v_k + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">0259</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0260</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0261</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0262</span>:     <span class="c"># Cut the output list to the number of matched stars</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0263</span>:     <span class="n">matched_indices</span> <span class="o">=</span> <span class="n">matched_indices</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_k);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 263, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_4, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 263, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_matched_indices), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 263, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 263, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_16, &amp;__pyx_t_17, &amp;__pyx_t_18);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_matched_indices, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_18);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_16, __pyx_t_17, __pyx_t_18);
      }
      __pyx_t_16 = __pyx_t_17 = __pyx_t_18 = 0;
    }
    __pyx_pybuffernd_matched_indices.diminfo[0].strides = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matched_indices.diminfo[0].shape = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matched_indices.diminfo[1].strides = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matched_indices.diminfo[1].shape = __pyx_pybuffernd_matched_indices.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 263, __pyx_L1_error)</span>
  }
  __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_matched_indices, ((PyArrayObject *)__pyx_t_4));
  __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0264</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0265</span>:     <span class="k">return</span> <span class="n">matched_indices</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_matched_indices));
  __pyx_r = ((PyObject *)__pyx_v_matched_indices);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0266</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0267</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0268</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0269</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0270</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">cyjd2LST</span><span class="p">(</span><span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static double __pyx_f_3RMS_10Astrometry_11CyFunctions_cyjd2LST(double __pyx_v_jd, double __pyx_v_lon) {
  double __pyx_v_gst;
  double __pyx_v_t;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyjd2LST", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0271</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert Julian date to apparent Local Sidereal Time. The times is apparent, not mean!</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0272</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0273</span>: <span class="sd">    Source: J. Meeus: Astronomical Algorithms</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0274</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0275</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0276</span>: <span class="sd">        jd: [float] Decimal julian date, epoch J2000.0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0277</span>: <span class="sd">        lon: [float] Longitude of the observer in degrees.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0278</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0279</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0280</span>: <span class="sd">        lst [float] Apparent Local Sidereal Time (deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0281</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0282</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0283</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gst</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0284</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0285</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">jd</span> <span class="o">-</span> <span class="n">J2000_DAYS</span><span class="p">)</span><span class="o">/</span><span class="mf">36525.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_t = ((__pyx_v_jd - __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS) / 36525.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0286</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0287</span>:     <span class="c"># Calculate the Mean sidereal rotation of the Earth in radians (Greenwich Sidereal Time)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0288</span>:     <span class="n">gst</span> <span class="o">=</span> <span class="mf">280.46061837</span> <span class="o">+</span> <span class="mf">360.98564736629</span><span class="o">*</span><span class="p">(</span><span class="n">jd</span> <span class="o">-</span> <span class="n">J2000_DAYS</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.000387933</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mf">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mf">3</span><span class="p">)</span><span class="o">/</span><span class="mf">38710000.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_gst = (((280.46061837 + (360.98564736629 * (__pyx_v_jd - __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS))) + (0.000387933 * pow(__pyx_v_t, 2.0))) - (pow(__pyx_v_t, 3.0) / 38710000.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0289</span>:     <span class="n">gst</span> <span class="o">=</span> <span class="p">(</span><span class="n">gst</span> <span class="o">+</span> <span class="mf">360</span><span class="p">)</span><span class="o">%</span><span class="mf">360</span></pre>
<pre class='cython code score-0 '>  __pyx_v_gst = fmod((__pyx_v_gst + 360.0), 360.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0290</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0291</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0292</span>:     <span class="c"># Compute the apparent Local Sidereal Time (LST)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0293</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">gst</span> <span class="o">+</span> <span class="n">lon</span> <span class="o">+</span> <span class="mf">360</span><span class="p">)</span><span class="o">%</span><span class="mf">360</span></pre>
<pre class='cython code score-0 '>  __pyx_r = fmod(((__pyx_v_gst + __pyx_v_lon) + 360.0), 360.0);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0294</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0295</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0296</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0297</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-82" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0298</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">equatorialCoordPrecession</span><span class="p">(</span><span class="n">double</span> <span class="n">start_epoch</span><span class="p">,</span> <span class="n">double</span> <span class="n">final_epoch</span><span class="p">,</span> <span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-82 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_7equatorialCoordPrecession(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(double __pyx_v_start_epoch, double __pyx_v_final_epoch, double __pyx_v_ra, double __pyx_v_dec, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_T;
  double __pyx_v_t;
  double __pyx_v_zeta;
  double __pyx_v_z;
  double __pyx_v_theta;
  double __pyx_v_A;
  double __pyx_v_B;
  double __pyx_v_C;
  double __pyx_v_ra_corr;
  double __pyx_v_dec_corr;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equatorialCoordPrecession", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_7equatorialCoordPrecession(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_6equatorialCoordPrecession[] = " Corrects Right Ascension and Declination from one epoch to another, taking only precession into \n        account.\n\n        Implemented from: Jean Meeus - Astronomical Algorithms, 2nd edition, pages 134-135\n    \n    Arguments:\n        start_epoch: [float] Julian date of the starting epoch.\n        final_epoch: [float] Julian date of the final epoch.\n        ra: [float] Input right ascension (radians).\n        dec: [float] Input declination (radians).\n    \n    Return:\n        (ra, dec): [tuple of floats] Precessed equatorial coordinates (radians).\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_7equatorialCoordPrecession(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_start_epoch;
  double __pyx_v_final_epoch;
  double __pyx_v_ra;
  double __pyx_v_dec;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equatorialCoordPrecession (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_start_epoch,&amp;__pyx_n_s_final_epoch,&amp;__pyx_n_s_ra,&amp;__pyx_n_s_dec,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_start_epoch)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_final_epoch)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordPrecession", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordPrecession", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordPrecession", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equatorialCoordPrecession") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_start_epoch = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_start_epoch == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
    __pyx_v_final_epoch = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_final_epoch == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
    __pyx_v_ra = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_ra == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
    __pyx_v_dec = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_dec == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 299, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordPrecession", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.equatorialCoordPrecession", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_6equatorialCoordPrecession(__pyx_self, __pyx_v_start_epoch, __pyx_v_final_epoch, __pyx_v_ra, __pyx_v_dec);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_6equatorialCoordPrecession(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_start_epoch, double __pyx_v_final_epoch, double __pyx_v_ra, double __pyx_v_dec) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equatorialCoordPrecession", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(__pyx_v_start_epoch, __pyx_v_final_epoch, __pyx_v_ra, __pyx_v_dec, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.equatorialCoordPrecession", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_ctuple_double__and_double {
  double f0;
  double f1;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">0299</span>:     <span class="n">double</span> <span class="n">dec</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0300</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Corrects Right Ascension and Declination from one epoch to another, taking only precession into </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0301</span>: <span class="sd">        account.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0302</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0303</span>: <span class="sd">        Implemented from: Jean Meeus - Astronomical Algorithms, 2nd edition, pages 134-135</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0304</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0305</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0306</span>: <span class="sd">        start_epoch: [float] Julian date of the starting epoch.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0307</span>: <span class="sd">        final_epoch: [float] Julian date of the final epoch.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0308</span>: <span class="sd">        ra: [float] Input right ascension (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0309</span>: <span class="sd">        dec: [float] Input declination (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0310</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0311</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0312</span>: <span class="sd">        (ra, dec): [tuple of floats] Precessed equatorial coordinates (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0313</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0314</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0315</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">T</span><span class="p">,</span> <span class="nf">t</span><span class="p">,</span> <span class="nf">zeta</span><span class="p">,</span> <span class="nf">z</span><span class="p">,</span> <span class="nf">theta</span><span class="p">,</span> <span class="nf">A</span><span class="p">,</span> <span class="nf">B</span><span class="p">,</span> <span class="nf">C</span><span class="p">,</span> <span class="nf">ra_corr</span><span class="p">,</span> <span class="nf">dec_corr</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0316</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0317</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0318</span>:     <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_epoch</span> <span class="o">-</span> <span class="n">J2000_DAYS</span> <span class="p">)</span><span class="o">/</span><span class="mf">36525.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_T = ((__pyx_v_start_epoch - __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS) / 36525.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0319</span>:     <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">)</span><span class="o">/</span><span class="mf">36525.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_t = ((__pyx_v_final_epoch - __pyx_v_start_epoch) / 36525.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0320</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0321</span>:     <span class="c"># Calculate correction parameters in degrees</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0322</span>:     <span class="n">zeta</span>  <span class="o">=</span> <span class="p">((</span><span class="mf">2306.2181</span> <span class="o">+</span> <span class="mf">1.39656</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="mf">0.000139</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.30188</span> <span class="o">-</span> <span class="mf">0.000344</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">0.017998</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mf">3</span><span class="p">)</span><span class="o">/</span><span class="mf">3600</span></pre>
<pre class='cython code score-0 '>  __pyx_v_zeta = ((((((2306.2181 + (1.39656 * __pyx_v_T)) - (0.000139 * pow(__pyx_v_T, 2.0))) * __pyx_v_t) + ((0.30188 - (0.000344 * __pyx_v_T)) * pow(__pyx_v_t, 2.0))) + (0.017998 * pow(__pyx_v_t, 3.0))) / 3600.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0323</span>:     <span class="n">z</span>     <span class="o">=</span> <span class="p">((</span><span class="mf">2306.2181</span> <span class="o">+</span> <span class="mf">1.39656</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="mf">0.000139</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.09468</span> <span class="o">+</span> <span class="mf">0.000066</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">0.018203</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mf">3</span><span class="p">)</span><span class="o">/</span><span class="mf">3600</span></pre>
<pre class='cython code score-0 '>  __pyx_v_z = ((((((2306.2181 + (1.39656 * __pyx_v_T)) - (0.000139 * pow(__pyx_v_T, 2.0))) * __pyx_v_t) + ((1.09468 + (0.000066 * __pyx_v_T)) * pow(__pyx_v_t, 2.0))) + (0.018203 * pow(__pyx_v_t, 3.0))) / 3600.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0324</span>:     <span class="n">theta</span> <span class="o">=</span> <span class="p">((</span><span class="mf">2004.3109</span> <span class="o">-</span> <span class="mf">0.85330</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="mf">0.000217</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.42665</span> <span class="o">+</span> <span class="mf">0.000217</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mf">2</span> <span class="o">-</span> <span class="mf">0.041833</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mf">3</span><span class="p">)</span><span class="o">/</span><span class="mf">3600</span></pre>
<pre class='cython code score-0 '>  __pyx_v_theta = ((((((2004.3109 - (0.85330 * __pyx_v_T)) - (0.000217 * pow(__pyx_v_T, 2.0))) * __pyx_v_t) - ((0.42665 + (0.000217 * __pyx_v_T)) * pow(__pyx_v_t, 2.0))) - (0.041833 * pow(__pyx_v_t, 3.0))) / 3600.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0325</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0326</span>:     <span class="c"># Convert parameters to radians</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0327</span>:     <span class="n">zeta</span>  <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_zeta = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_zeta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0328</span>:     <span class="n">z</span>     <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_z = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_z);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0329</span>:     <span class="n">theta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_theta = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_theta);
</pre><pre class="cython line score-0">&#xA0;<span class="">0330</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0331</span>:     <span class="c"># Calculate the next set of parameters</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0332</span>:     <span class="n">A</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">dec</span>  <span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_A = (cos(__pyx_v_dec) * sin((__pyx_v_ra + __pyx_v_zeta)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0333</span>:     <span class="n">B</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_B = (((cos(__pyx_v_theta) * cos(__pyx_v_dec)) * cos((__pyx_v_ra + __pyx_v_zeta))) - (sin(__pyx_v_theta) * sin(__pyx_v_dec)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0334</span>:     <span class="n">C</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_C = (((sin(__pyx_v_theta) * cos(__pyx_v_dec)) * cos((__pyx_v_ra + __pyx_v_zeta))) + (cos(__pyx_v_theta) * sin(__pyx_v_dec)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0335</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0336</span>:     <span class="c"># Calculate right ascension</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0337</span>:     <span class="n">ra_corr</span> <span class="o">=</span> <span class="p">(</span><span class="n">atan2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span> <span class="o">+</span> <span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ra_corr = fmod(((atan2(__pyx_v_A, __pyx_v_B) + __pyx_v_z) + (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi)), (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi));
</pre><pre class="cython line score-0">&#xA0;<span class="">0338</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0339</span>:     <span class="c"># Calculate declination (apply a different equation if close to the pole, closer then 0.5 degrees)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0340</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mf">2</span> <span class="o">-</span> <span class="n">fabs</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">radians</span><span class="p">(</span><span class="mf">0.5</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((((__pyx_v_3RMS_10Astrometry_11CyFunctions_pi / 2.0) - fabs(__pyx_v_dec)) &lt; __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(0.5)) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0341</span>:         <span class="n">dec_corr</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">acos</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">B</span><span class="o">**</span><span class="mf">2</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dec_corr = (__pyx_f_3RMS_10Astrometry_11CyFunctions_sign(__pyx_v_dec) * acos(sqrt((pow(__pyx_v_A, 2.0) + pow(__pyx_v_B, 2.0)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0342</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0343</span>:         <span class="n">dec_corr</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="n">C</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_dec_corr = asin(__pyx_v_C);
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0344</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0345</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0346</span>:     <span class="k">return</span> <span class="n">ra_corr</span><span class="p">,</span> <span class="n">dec_corr</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2.f0 = __pyx_v_ra_corr;
  __pyx_t_2.f1 = __pyx_v_dec_corr;
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0347</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0348</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0349</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0350</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0351</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0352</span>: <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="kt">np</span>.<span class="nf">float64_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">precessionMatrix</span><span class="p">(</span><span class="n">double</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">double</span> <span class="n">theta</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">):</span></pre>
<pre class='cython code score-15 '>static PyArrayObject *__pyx_f_3RMS_10Astrometry_11CyFunctions_precessionMatrix(double __pyx_v_zeta, double __pyx_v_theta, double __pyx_v_z) {
  PyArrayObject *__pyx_v_P = 0;
  double __pyx_v_czeta;
  double __pyx_v_szeta;
  double __pyx_v_ctheta;
  double __pyx_v_stheta;
  double __pyx_v_cz;
  double __pyx_v_sz;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_P;
  __Pyx_Buffer __pyx_pybuffer_P;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("precessionMatrix", 0);
  __pyx_pybuffer_P.pybuffer.buf = NULL;
  __pyx_pybuffer_P.refcount = 0;
  __pyx_pybuffernd_P.data = NULL;
  __pyx_pybuffernd_P.rcbuffer = &amp;__pyx_pybuffer_P;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.precessionMatrix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_P);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0353</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the precession matrix based on precession angles.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0354</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0355</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0356</span>: <span class="sd">        zeta: [double] Precession angle zeta in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0357</span>: <span class="sd">        theta: [double] Precession angle theta in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0358</span>: <span class="sd">        z: [double] Precession angle z in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0359</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0360</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0361</span>: <span class="sd">        [np.ndarray] A 3x3 rotation matrix representing the precession transformation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0362</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0363</span>: <span class="sd">    Notes:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0364</span>: <span class="sd">        - This matrix is used to transform coordinates from one epoch to another, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0365</span>: <span class="sd">          accounting for the precession of the Earth&#39;s rotational axis.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0366</span>: <span class="sd">        - The matrix is calculated using the formulation from the IAU 1976 precession model.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0367</span>: <span class="sd">        - Input angles should be calculated for the time span between the initial and final epochs.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0368</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0369</span>: </pre>
<pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0370</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="kt">np</span>.<span class="nf">float64_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">]</span> <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">3</span><span class="p">,</span> <span class="mf">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></pre>
<pre class='cython code score-37 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_3, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_tuple__2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_P = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_P.diminfo[0].strides = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_P.diminfo[0].shape = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_P.diminfo[1].strides = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_P.diminfo[1].shape = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_P = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_tuple_);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0371</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">czeta</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_czeta = cos(__pyx_v_zeta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0372</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">szeta</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_szeta = sin(__pyx_v_zeta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0373</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ctheta</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ctheta = cos(__pyx_v_theta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0374</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">stheta</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_stheta = sin(__pyx_v_theta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0375</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">cz</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_cz = cos(__pyx_v_z);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0376</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sz</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sz = sin(__pyx_v_z);
</pre><pre class="cython line score-0">&#xA0;<span class="">0377</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0378</span>:     <span class="c"># Calculate matrix elements</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0379</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">czeta</span><span class="o">*</span><span class="n">ctheta</span><span class="o">*</span><span class="n">cz</span> <span class="o">-</span> <span class="n">szeta</span><span class="o">*</span><span class="n">sz</span></pre>
<pre class='cython code score-0 '>  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_7, __pyx_pybuffernd_P.diminfo[1].strides) = (((__pyx_v_czeta * __pyx_v_ctheta) * __pyx_v_cz) - (__pyx_v_szeta * __pyx_v_sz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0380</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">szeta</span><span class="o">*</span><span class="n">ctheta</span><span class="o">*</span><span class="n">cz</span> <span class="o">-</span> <span class="n">czeta</span><span class="o">*</span><span class="n">sz</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = 0;
  __pyx_t_6 = 1;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_P.diminfo[1].strides) = ((((-__pyx_v_szeta) * __pyx_v_ctheta) * __pyx_v_cz) - (__pyx_v_czeta * __pyx_v_sz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0381</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">stheta</span><span class="o">*</span><span class="n">cz</span></pre>
<pre class='cython code score-0 '>  __pyx_t_6 = 0;
  __pyx_t_7 = 2;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_7, __pyx_pybuffernd_P.diminfo[1].strides) = ((-__pyx_v_stheta) * __pyx_v_cz);
</pre><pre class="cython line score-0">&#xA0;<span class="">0382</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0383</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">czeta</span><span class="o">*</span><span class="n">ctheta</span><span class="o">*</span><span class="n">sz</span> <span class="o">+</span> <span class="n">szeta</span><span class="o">*</span><span class="n">cz</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = 1;
  __pyx_t_6 = 0;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_P.diminfo[1].strides) = (((__pyx_v_czeta * __pyx_v_ctheta) * __pyx_v_sz) + (__pyx_v_szeta * __pyx_v_cz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0384</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">szeta</span><span class="o">*</span><span class="n">ctheta</span><span class="o">*</span><span class="n">sz</span> <span class="o">+</span> <span class="n">czeta</span><span class="o">*</span><span class="n">cz</span></pre>
<pre class='cython code score-0 '>  __pyx_t_6 = 1;
  __pyx_t_7 = 1;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_7, __pyx_pybuffernd_P.diminfo[1].strides) = ((((-__pyx_v_szeta) * __pyx_v_ctheta) * __pyx_v_sz) + (__pyx_v_czeta * __pyx_v_cz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0385</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">stheta</span><span class="o">*</span><span class="n">sz</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = 1;
  __pyx_t_6 = 2;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_P.diminfo[1].strides) = ((-__pyx_v_stheta) * __pyx_v_sz);
</pre><pre class="cython line score-0">&#xA0;<span class="">0386</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0387</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">czeta</span><span class="o">*</span><span class="n">stheta</span></pre>
<pre class='cython code score-0 '>  __pyx_t_6 = 2;
  __pyx_t_7 = 0;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_7, __pyx_pybuffernd_P.diminfo[1].strides) = (__pyx_v_czeta * __pyx_v_stheta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0388</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">szeta</span><span class="o">*</span><span class="n">stheta</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = 2;
  __pyx_t_6 = 1;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_P.diminfo[1].strides) = ((-__pyx_v_szeta) * __pyx_v_stheta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0389</span>:     <span class="n">P</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctheta</span></pre>
<pre class='cython code score-0 '>  __pyx_t_6 = 2;
  __pyx_t_7 = 2;
  *__Pyx_BufPtrCContig2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_P.diminfo[0].strides, __pyx_t_7, __pyx_pybuffernd_P.diminfo[1].strides) = __pyx_v_ctheta;
</pre><pre class="cython line score-0">&#xA0;<span class="">0390</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0391</span>:     <span class="k">return</span> <span class="n">P</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_P));
  __pyx_r = ((PyArrayObject *)__pyx_v_P);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0392</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0393</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0394</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0395</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0396</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0397</span>: <span class="k">cdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">nutationComponents</span><span class="p">(</span><span class="n">double</span> <span class="n">T</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_nutationComponents(double __pyx_v_T) {
  double __pyx_v_omega;
  double __pyx_v_L;
  double __pyx_v_Ll;
  double __pyx_v_delta_psi;
  double __pyx_v_delta_eps;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("nutationComponents", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0398</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate nutation corrections &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0399</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0400</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">omega</span><span class="p">,</span> <span class="nf">L</span><span class="p">,</span> <span class="nf">Ll</span><span class="p">,</span> <span class="nf">delta_psi</span><span class="p">,</span> <span class="nf">delta_eps</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0401</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0402</span>:     <span class="c"># Longitude of the ascending node of the Moon&#39;s mean orbit on the ecliptic, measured from the mean equinox</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0403</span>:     <span class="c"># of the date</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0404</span>:     <span class="n">omega</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">125.04452</span> <span class="o">-</span> <span class="mf">1934.136261</span><span class="o">*</span><span class="n">T</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_omega = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((125.04452 - (1934.136261 * __pyx_v_T)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0405</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0406</span>:     <span class="c"># Mean longitude of the Sun</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0407</span>:     <span class="n">L</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">280.4665</span> <span class="o">+</span> <span class="mf">36000.7698</span><span class="o">*</span><span class="n">T</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_L = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((280.4665 + (36000.7698 * __pyx_v_T)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0408</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0409</span>:     <span class="c"># Mean longitude of the Moon</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0410</span>:     <span class="n">Ll</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">218.3165</span> <span class="o">+</span> <span class="mf">481267.8813</span><span class="o">*</span><span class="n">T</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_Ll = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((218.3165 + (481267.8813 * __pyx_v_T)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0411</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0412</span>:     <span class="c"># Nutation in longitude</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0413</span>:     <span class="n">delta_psi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">17.2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.32</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.23</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">Ll</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.21</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_delta_psi = ((((-17.2 * sin(__pyx_v_omega)) - (1.32 * sin((2.0 * __pyx_v_L)))) - (0.23 * sin((2.0 * __pyx_v_Ll)))) + (0.21 * sin((2.0 * __pyx_v_omega))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0414</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0415</span>:     <span class="c"># Nutation in obliquity</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0416</span>:     <span class="n">delta_eps</span> <span class="o">=</span> <span class="mf">9.2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.57</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">Ll</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.09</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_delta_eps = ((((9.2 * cos(__pyx_v_omega)) + (0.57 * cos((2.0 * __pyx_v_L)))) + (0.1 * cos((2.0 * __pyx_v_Ll)))) - (0.09 * cos((2.0 * __pyx_v_omega))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0417</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0418</span>:     <span class="c"># Convert to radians</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0419</span>:     <span class="n">delta_psi</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">delta_psi</span><span class="o">/</span><span class="mf">3600</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_delta_psi = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((__pyx_v_delta_psi / 3600.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0420</span>:     <span class="n">delta_eps</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">delta_eps</span><span class="o">/</span><span class="mf">3600</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_delta_eps = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((__pyx_v_delta_eps / 3600.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">0421</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0422</span>:     <span class="k">return</span> <span class="n">delta_psi</span><span class="p">,</span> <span class="n">delta_eps</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1.f0 = __pyx_v_delta_psi;
  __pyx_t_1.f1 = __pyx_v_delta_eps;
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0423</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0424</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0425</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0426</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0427</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-166" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0428</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">equatorialCoordAndRotPrecession</span><span class="p">(</span><span class="n">double</span> <span class="n">start_epoch</span><span class="p">,</span> <span class="n">double</span> <span class="n">final_epoch</span><span class="p">,</span></pre>
<pre class='cython code score-166 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_9equatorialCoordAndRotPrecession(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordAndRotPrecession(double __pyx_v_start_epoch, double __pyx_v_final_epoch, double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_rot_angle, CYTHON_UNUSED int __pyx_skip_dispatch) {
  PyArrayObject *__pyx_v_initial_vector = 0;
  PyArrayObject *__pyx_v_transformed_vector = 0;
  PyArrayObject *__pyx_v_parallel_vec = 0;
  PyArrayObject *__pyx_v_parallel_vec_precessed = 0;
  PyArrayObject *__pyx_v_normal_vector = 0;
  PyArrayObject *__pyx_v_transformed_normal = 0;
  PyArrayObject *__pyx_v_proj_parallel = 0;
  PyArrayObject *__pyx_v_proj_parallel_precessed = 0;
  PyArrayObject *__pyx_v_P = 0;
  PyArrayObject *__pyx_v_epsilon_matrix = 0;
  PyArrayObject *__pyx_v_psi_matrix = 0;
  double __pyx_v_ra_precessed;
  double __pyx_v_dec_precessed;
  double __pyx_v_T;
  double __pyx_v_t;
  double __pyx_v_zeta;
  double __pyx_v_z;
  double __pyx_v_theta;
  double __pyx_v_Delta_psi;
  double __pyx_v_Delta_epsilon;
  double __pyx_v_new_rot_angle;
  double __pyx_v_angle1;
  double __pyx_v_angle2;
  double __pyx_v_rotation_change;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_P;
  __Pyx_Buffer __pyx_pybuffer_P;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_epsilon_matrix;
  __Pyx_Buffer __pyx_pybuffer_epsilon_matrix;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_initial_vector;
  __Pyx_Buffer __pyx_pybuffer_initial_vector;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_normal_vector;
  __Pyx_Buffer __pyx_pybuffer_normal_vector;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_parallel_vec;
  __Pyx_Buffer __pyx_pybuffer_parallel_vec;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_parallel_vec_precessed;
  __Pyx_Buffer __pyx_pybuffer_parallel_vec_precessed;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_proj_parallel;
  __Pyx_Buffer __pyx_pybuffer_proj_parallel;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_proj_parallel_precessed;
  __Pyx_Buffer __pyx_pybuffer_proj_parallel_precessed;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_psi_matrix;
  __Pyx_Buffer __pyx_pybuffer_psi_matrix;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_transformed_normal;
  __Pyx_Buffer __pyx_pybuffer_transformed_normal;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_transformed_vector;
  __Pyx_Buffer __pyx_pybuffer_transformed_vector;
  __pyx_ctuple_double__and_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equatorialCoordAndRotPrecession", 0);
  __pyx_pybuffer_initial_vector.pybuffer.buf = NULL;
  __pyx_pybuffer_initial_vector.refcount = 0;
  __pyx_pybuffernd_initial_vector.data = NULL;
  __pyx_pybuffernd_initial_vector.rcbuffer = &amp;__pyx_pybuffer_initial_vector;
  __pyx_pybuffer_transformed_vector.pybuffer.buf = NULL;
  __pyx_pybuffer_transformed_vector.refcount = 0;
  __pyx_pybuffernd_transformed_vector.data = NULL;
  __pyx_pybuffernd_transformed_vector.rcbuffer = &amp;__pyx_pybuffer_transformed_vector;
  __pyx_pybuffer_parallel_vec.pybuffer.buf = NULL;
  __pyx_pybuffer_parallel_vec.refcount = 0;
  __pyx_pybuffernd_parallel_vec.data = NULL;
  __pyx_pybuffernd_parallel_vec.rcbuffer = &amp;__pyx_pybuffer_parallel_vec;
  __pyx_pybuffer_parallel_vec_precessed.pybuffer.buf = NULL;
  __pyx_pybuffer_parallel_vec_precessed.refcount = 0;
  __pyx_pybuffernd_parallel_vec_precessed.data = NULL;
  __pyx_pybuffernd_parallel_vec_precessed.rcbuffer = &amp;__pyx_pybuffer_parallel_vec_precessed;
  __pyx_pybuffer_normal_vector.pybuffer.buf = NULL;
  __pyx_pybuffer_normal_vector.refcount = 0;
  __pyx_pybuffernd_normal_vector.data = NULL;
  __pyx_pybuffernd_normal_vector.rcbuffer = &amp;__pyx_pybuffer_normal_vector;
  __pyx_pybuffer_transformed_normal.pybuffer.buf = NULL;
  __pyx_pybuffer_transformed_normal.refcount = 0;
  __pyx_pybuffernd_transformed_normal.data = NULL;
  __pyx_pybuffernd_transformed_normal.rcbuffer = &amp;__pyx_pybuffer_transformed_normal;
  __pyx_pybuffer_proj_parallel.pybuffer.buf = NULL;
  __pyx_pybuffer_proj_parallel.refcount = 0;
  __pyx_pybuffernd_proj_parallel.data = NULL;
  __pyx_pybuffernd_proj_parallel.rcbuffer = &amp;__pyx_pybuffer_proj_parallel;
  __pyx_pybuffer_proj_parallel_precessed.pybuffer.buf = NULL;
  __pyx_pybuffer_proj_parallel_precessed.refcount = 0;
  __pyx_pybuffernd_proj_parallel_precessed.data = NULL;
  __pyx_pybuffernd_proj_parallel_precessed.rcbuffer = &amp;__pyx_pybuffer_proj_parallel_precessed;
  __pyx_pybuffer_P.pybuffer.buf = NULL;
  __pyx_pybuffer_P.refcount = 0;
  __pyx_pybuffernd_P.data = NULL;
  __pyx_pybuffernd_P.rcbuffer = &amp;__pyx_pybuffer_P;
  __pyx_pybuffer_epsilon_matrix.pybuffer.buf = NULL;
  __pyx_pybuffer_epsilon_matrix.refcount = 0;
  __pyx_pybuffernd_epsilon_matrix.data = NULL;
  __pyx_pybuffernd_epsilon_matrix.rcbuffer = &amp;__pyx_pybuffer_epsilon_matrix;
  __pyx_pybuffer_psi_matrix.pybuffer.buf = NULL;
  __pyx_pybuffer_psi_matrix.refcount = 0;
  __pyx_pybuffernd_psi_matrix.data = NULL;
  __pyx_pybuffernd_psi_matrix.rcbuffer = &amp;__pyx_pybuffer_psi_matrix;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_parallel_vec.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_parallel_vec_precessed.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("RMS.Astrometry.CyFunctions.equatorialCoordAndRotPrecession", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_parallel_vec.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_parallel_vec_precessed.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_initial_vector);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_transformed_vector);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_parallel_vec);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_parallel_vec_precessed);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_normal_vector);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_transformed_normal);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_proj_parallel);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_proj_parallel_precessed);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_P);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_epsilon_matrix);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_psi_matrix);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_9equatorialCoordAndRotPrecession(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_8equatorialCoordAndRotPrecession[] = " Corrects Right Ascension, Declination, and Rotation wrt Standard angle from one epoch to another,\n    taking only precession into account.\n    \n    Arguments:\n        start_epoch: [float] Julian date of the starting epoch.\n        final_epoch: [float] Julian date of the final epoch.\n        ra: [float] Input right ascension (radians).\n        dec: [float] Input declination (radians).\n        rot_angle [float] the rotation wrt Standard angle, aka pos_angle_ref (radians).\n    \n    Return:\n        (ra, dec, rot_angle): [tuple of floats] Precessed equatorial coordinates and rotation angle (radians).\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_9equatorialCoordAndRotPrecession(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_start_epoch;
  double __pyx_v_final_epoch;
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_rot_angle;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equatorialCoordAndRotPrecession (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_start_epoch,&amp;__pyx_n_s_final_epoch,&amp;__pyx_n_s_ra,&amp;__pyx_n_s_dec,&amp;__pyx_n_s_rot_angle,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_start_epoch)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_final_epoch)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordAndRotPrecession", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordAndRotPrecession", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordAndRotPrecession", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_rot_angle)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordAndRotPrecession", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equatorialCoordAndRotPrecession") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_start_epoch = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_start_epoch == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
    __pyx_v_final_epoch = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_final_epoch == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
    __pyx_v_ra = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_ra == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 429, __pyx_L3_error)</span>
    __pyx_v_dec = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_dec == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 429, __pyx_L3_error)</span>
    __pyx_v_rot_angle = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_rot_angle == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 429, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("equatorialCoordAndRotPrecession", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.equatorialCoordAndRotPrecession", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_8equatorialCoordAndRotPrecession(__pyx_self, __pyx_v_start_epoch, __pyx_v_final_epoch, __pyx_v_ra, __pyx_v_dec, __pyx_v_rot_angle);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_8equatorialCoordAndRotPrecession(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_start_epoch, double __pyx_v_final_epoch, double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_rot_angle) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("equatorialCoordAndRotPrecession", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double__and_double</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordAndRotPrecession(__pyx_v_start_epoch, __pyx_v_final_epoch, __pyx_v_ra, __pyx_v_dec, __pyx_v_rot_angle, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.equatorialCoordAndRotPrecession", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_ctuple_double__and_double__and_double {
  double f0;
  double f1;
  double f2;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">0429</span>:                                                                <span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec</span><span class="p">,</span> <span class="n">double</span> <span class="n">rot_angle</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0430</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Corrects Right Ascension, Declination, and Rotation wrt Standard angle from one epoch to another,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0431</span>: <span class="sd">    taking only precession into account.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0432</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0433</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0434</span>: <span class="sd">        start_epoch: [float] Julian date of the starting epoch.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0435</span>: <span class="sd">        final_epoch: [float] Julian date of the final epoch.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0436</span>: <span class="sd">        ra: [float] Input right ascension (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0437</span>: <span class="sd">        dec: [float] Input declination (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0438</span>: <span class="sd">        rot_angle [float] the rotation wrt Standard angle, aka pos_angle_ref (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0439</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0440</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0441</span>: <span class="sd">        (ra, dec, rot_angle): [tuple of floats] Precessed equatorial coordinates and rotation angle (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0442</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0443</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0444</span>:     <span class="c"># Don&#39;t precess if the start and final epoch are the same</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0445</span>:     <span class="k">if</span> <span class="n">start_epoch</span> <span class="o">==</span> <span class="n">final_epoch</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_start_epoch == __pyx_v_final_epoch) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0446</span>:         <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">rot_angle</span></pre>
<pre class='cython code score-0 '>    __pyx_t_2.f0 = __pyx_v_ra;
    __pyx_t_2.f1 = __pyx_v_dec;
    __pyx_t_2.f2 = __pyx_v_rot_angle;
    __pyx_r = __pyx_t_2;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0447</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0448</span>:     <span class="k">cdef</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0449</span>:         <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">initial_vector</span><span class="p">,</span> <span class="n">transformed_vector</span><span class="p">,</span> <span class="n">parallel_vec</span><span class="p">,</span> <span class="n">parallel_vec_precessed</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0450</span>:         <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">normal_vector</span><span class="p">,</span> <span class="n">transformed_normal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0451</span>:         <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">proj_parallel</span><span class="p">,</span> <span class="n">proj_parallel_precessed</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0452</span>:         <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">P</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0453</span>:         <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">epsilon_matrix</span><span class="p">,</span> <span class="n">psi_matrix</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0454</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0455</span>:         <span class="n">double</span> <span class="n">ra_precessed</span><span class="p">,</span> <span class="n">dec_precessed</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Delta_psi</span><span class="p">,</span> <span class="n">Delta_epsilon</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0456</span>:         <span class="n">double</span> <span class="n">new_rot_angle</span><span class="p">,</span> <span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">rotation_change</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0457</span>:         <span class="nb">int</span> <span class="n">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0458</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0459</span>:     <span class="c"># Calculate precession parameters</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0460</span>:     <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_epoch</span> <span class="o">-</span> <span class="mf">2451545.0</span><span class="p">)</span><span class="o">/</span><span class="mf">36525.0</span>  <span class="c"># J2000.0 epoch</span></pre>
<pre class='cython code score-0 '>  __pyx_v_T = ((__pyx_v_start_epoch - 2451545.0) / 36525.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0461</span>:     <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">)</span><span class="o">/</span><span class="mf">36525.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_t = ((__pyx_v_final_epoch - __pyx_v_start_epoch) / 36525.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0462</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0463</span>:     <span class="c"># Calculate correction parameters in degrees</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0464</span>:     <span class="n">zeta</span> <span class="o">=</span> <span class="p">((</span><span class="mf">2306.2181</span> <span class="o">+</span> <span class="mf">1.39656</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="mf">0.000139</span><span class="o">*</span><span class="n">T</span> <span class="o">**</span> <span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.30188</span> <span class="o">-</span> <span class="mf">0.000344</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">**</span> <span class="mf">2</span> <span class="o">+</span> <span class="mf">0.017998</span><span class="o">*</span><span class="n">t</span> <span class="o">**</span> <span class="mf">3</span><span class="p">)</span><span class="o">/</span><span class="mf">3600</span></pre>
<pre class='cython code score-0 '>  __pyx_v_zeta = ((((((2306.2181 + (1.39656 * __pyx_v_T)) - (0.000139 * pow(__pyx_v_T, 2.0))) * __pyx_v_t) + ((0.30188 - (0.000344 * __pyx_v_T)) * pow(__pyx_v_t, 2.0))) + (0.017998 * pow(__pyx_v_t, 3.0))) / 3600.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0465</span>:     <span class="n">z</span> <span class="o">=</span> <span class="p">((</span><span class="mf">2306.2181</span> <span class="o">+</span> <span class="mf">1.39656</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="mf">0.000139</span><span class="o">*</span><span class="n">T</span> <span class="o">**</span> <span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.09468</span> <span class="o">+</span> <span class="mf">0.000066</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">**</span> <span class="mf">2</span> <span class="o">+</span> <span class="mf">0.018203</span><span class="o">*</span><span class="n">t</span> <span class="o">**</span> <span class="mf">3</span><span class="p">)</span><span class="o">/</span><span class="mf">3600</span></pre>
<pre class='cython code score-0 '>  __pyx_v_z = ((((((2306.2181 + (1.39656 * __pyx_v_T)) - (0.000139 * pow(__pyx_v_T, 2.0))) * __pyx_v_t) + ((1.09468 + (0.000066 * __pyx_v_T)) * pow(__pyx_v_t, 2.0))) + (0.018203 * pow(__pyx_v_t, 3.0))) / 3600.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0466</span>:     <span class="n">theta</span> <span class="o">=</span> <span class="p">((</span><span class="mf">2004.3109</span> <span class="o">-</span> <span class="mf">0.85330</span><span class="o">*</span><span class="n">T</span> <span class="o">-</span> <span class="mf">0.000217</span><span class="o">*</span><span class="n">T</span> <span class="o">**</span> <span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.42665</span> <span class="o">+</span> <span class="mf">0.000217</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">t</span> <span class="o">**</span> <span class="mf">2</span> <span class="o">-</span> <span class="mf">0.041833</span><span class="o">*</span><span class="n">t</span> <span class="o">**</span> <span class="mf">3</span><span class="p">)</span><span class="o">/</span><span class="mf">3600</span></pre>
<pre class='cython code score-0 '>  __pyx_v_theta = ((((((2004.3109 - (0.85330 * __pyx_v_T)) - (0.000217 * pow(__pyx_v_T, 2.0))) * __pyx_v_t) - ((0.42665 + (0.000217 * __pyx_v_T)) * pow(__pyx_v_t, 2.0))) - (0.041833 * pow(__pyx_v_t, 3.0))) / 3600.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0467</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0468</span>:     <span class="c"># Convert parameters to radians</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0469</span>:     <span class="n">zeta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_zeta = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_zeta);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0470</span>:     <span class="n">z</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_z = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_z);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0471</span>:     <span class="n">theta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_theta = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_theta);
</pre><pre class="cython line score-0">&#xA0;<span class="">0472</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0473</span>:     <span class="c"># Calculate precession matrix</span></pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0474</span>:     <span class="n">P</span> <span class="o">=</span> <span class="n">precessionMatrix</span><span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span></pre>
<pre class='cython code score-18 '>  __pyx_t_3 = ((PyObject *)__pyx_f_3RMS_10Astrometry_11CyFunctions_precessionMatrix(__pyx_v_zeta, __pyx_v_theta, __pyx_v_z));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 474, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_3), &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_P.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_P, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_P.diminfo[0].strides = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_P.diminfo[0].shape = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_P.diminfo[1].strides = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_P.diminfo[1].shape = __pyx_pybuffernd_P.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L1_error)</span>
  }
  __pyx_v_P = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0475</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0476</span>:     <span class="c"># Convert RA, Dec to cartesian coordinates</span></pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0477</span>:     <span class="n">initial_vector</span> <span class="o">=</span> <span class="n">raDecToCartesian</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-18 '>  __pyx_t_3 = ((PyObject *)__pyx_f_3RMS_10Astrometry_11CyFunctions_raDecToCartesian(__pyx_v_ra, __pyx_v_dec, 0));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_3), &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_initial_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_initial_vector.diminfo[0].strides = __pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_initial_vector.diminfo[0].shape = __pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>
  }
  __pyx_v_initial_vector = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0478</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0479</span>:     <span class="c"># Apply precession</span></pre>
<pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0480</span>:     <span class="n">transformed_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">initial_vector</span><span class="p">)</span></pre>
<pre class='cython code score-62 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 480, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 480, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_9)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_P), ((PyObject *)__pyx_v_initial_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 480, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_9)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_P), ((PyObject *)__pyx_v_initial_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 480, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 480, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (__pyx_t_8) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_P));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_P));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_4, ((PyObject *)__pyx_v_P));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_4, ((PyObject *)__pyx_v_initial_vector));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 480, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 480, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_transformed_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_transformed_vector.diminfo[0].strides = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_transformed_vector.diminfo[0].shape = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 480, __pyx_L1_error)</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_transformed_vector = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0481</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0482</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0483</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0484</span>:     <span class="c"># Calculate nutation corrections</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0485</span>:     <span class="n">Delta_psi</span><span class="p">,</span> <span class="n">Delta_epsilon</span> <span class="o">=</span> <span class="n">nutationComponents</span><span class="p">(</span><span class="n">T</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_12 = __pyx_f_3RMS_10Astrometry_11CyFunctions_nutationComponents(__pyx_v_T);
  __pyx_t_13 = __pyx_t_12.f0;
  __pyx_t_14 = __pyx_t_12.f1;
  __pyx_v_Delta_psi = __pyx_t_13;
  __pyx_v_Delta_epsilon = __pyx_t_14;
</pre><pre class="cython line score-0">&#xA0;<span class="">0486</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0487</span>:     <span class="c"># Construct the nutation matrices</span></pre>
<pre class="cython line score-59" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0488</span>:     <span class="n">epsilon_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1</span><span class="p">,</span>                  <span class="mf">0</span><span class="p">,</span>                   <span class="mf">0</span><span class="p">],</span></pre>
<pre class='cython code score-59 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 0, __pyx_int_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 1, __pyx_int_0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 2, __pyx_int_0);
/* … */
  __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 488, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 2, __pyx_t_17);
  __pyx_t_9 = 0;
  __pyx_t_16 = 0;
  __pyx_t_17 = 0;
  __pyx_t_17 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
    }
  }
  __pyx_t_3 = (__pyx_t_17) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_17, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_epsilon_matrix, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_epsilon_matrix.diminfo[0].strides = __pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_epsilon_matrix.diminfo[0].shape = __pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_epsilon_matrix.diminfo[1].strides = __pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_epsilon_matrix.diminfo[1].shape = __pyx_pybuffernd_epsilon_matrix.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>
  }
  __pyx_t_18 = 0;
  __pyx_v_epsilon_matrix = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0489</span>:                                <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">Delta_epsilon</span><span class="p">),</span>  <span class="n">sin</span><span class="p">(</span><span class="n">Delta_epsilon</span><span class="p">)],</span></pre>
<pre class='cython code score-19 '>  __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(cos(__pyx_v_Delta_epsilon));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_15 = <span class='py_c_api'>PyFloat_FromDouble</span>(sin(__pyx_v_Delta_epsilon));<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_16 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_16, 0, __pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_16, 1, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_16, 2, __pyx_t_15);
  __pyx_t_8 = 0;
  __pyx_t_15 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0490</span>:                                <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">Delta_epsilon</span><span class="p">),</span>  <span class="n">cos</span><span class="p">(</span><span class="n">Delta_epsilon</span><span class="p">)]])</span></pre>
<pre class='cython code score-19 '>  __pyx_t_15 = <span class='py_c_api'>PyFloat_FromDouble</span>((-sin(__pyx_v_Delta_epsilon)));<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(cos(__pyx_v_Delta_epsilon));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_17 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 0, __pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 1, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 2, __pyx_t_8);
  __pyx_t_15 = 0;
  __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0491</span>: </pre>
<pre class="cython line score-67" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0492</span>:     <span class="n">psi_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cos</span><span class="p">(</span><span class="n">Delta_psi</span><span class="p">),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">Delta_psi</span><span class="p">),</span> <span class="mf">0</span><span class="p">],</span></pre>
<pre class='cython code score-67 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(cos(__pyx_v_Delta_psi));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_17 = <span class='py_c_api'>PyFloat_FromDouble</span>((-sin(__pyx_v_Delta_psi)));<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_16 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_16, 1, __pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_16, 2, __pyx_int_0);
  __pyx_t_10 = 0;
  __pyx_t_17 = 0;
/* … */
  __pyx_t_17 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 1, __pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 2, __pyx_t_10);
  __pyx_t_16 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_10, __pyx_t_17) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_psi_matrix, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_psi_matrix.diminfo[0].strides = __pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_psi_matrix.diminfo[0].shape = __pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_psi_matrix.diminfo[1].strides = __pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_psi_matrix.diminfo[1].shape = __pyx_pybuffernd_psi_matrix.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>
  }
  __pyx_t_18 = 0;
  __pyx_v_psi_matrix = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0493</span>:                            <span class="p">[</span><span class="n">sin</span><span class="p">(</span><span class="n">Delta_psi</span><span class="p">),</span>  <span class="n">cos</span><span class="p">(</span><span class="n">Delta_psi</span><span class="p">),</span> <span class="mf">0</span><span class="p">],</span></pre>
<pre class='cython code score-19 '>  __pyx_t_17 = <span class='py_c_api'>PyFloat_FromDouble</span>(sin(__pyx_v_Delta_psi));<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(cos(__pyx_v_Delta_psi));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_9 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 493, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 2, __pyx_int_0);
  __pyx_t_17 = 0;
  __pyx_t_10 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0494</span>:                            <span class="p">[</span><span class="mf">0</span><span class="p">,</span>                            <span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]])</span></pre>
<pre class='cython code score-11 '>  __pyx_t_10 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 494, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_10, 0, __pyx_int_0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_10, 1, __pyx_int_0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_10, 2, __pyx_int_1);
</pre><pre class="cython line score-0">&#xA0;<span class="">0495</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0496</span>:     <span class="c"># Apply nutation</span></pre>
<pre class="cython line score-63" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0497</span>:     <span class="n">transformed_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">epsilon_matrix</span><span class="p">,</span> <span class="n">transformed_vector</span><span class="p">)</span></pre>
<pre class='cython code score-63 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 497, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 497, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_epsilon_matrix), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 497, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_epsilon_matrix), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 497, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 497, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (__pyx_t_8) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_epsilon_matrix));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_epsilon_matrix));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_4, ((PyObject *)__pyx_v_epsilon_matrix));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_4, ((PyObject *)__pyx_v_transformed_vector));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 497, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 497, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_transformed_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_transformed_vector.diminfo[0].strides = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_transformed_vector.diminfo[0].shape = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 497, __pyx_L1_error)</span>
  }
  __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_transformed_vector, ((PyArrayObject *)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-63" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0498</span>:     <span class="n">transformed_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">psi_matrix</span><span class="p">,</span> <span class="n">transformed_vector</span><span class="p">)</span></pre>
<pre class='cython code score-63 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_17, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_17, ((PyObject *)__pyx_v_psi_matrix), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_17, ((PyObject *)__pyx_v_psi_matrix), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_17) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_17); __pyx_t_17 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_psi_matrix));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_psi_matrix));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_4, ((PyObject *)__pyx_v_psi_matrix));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_4, ((PyObject *)__pyx_v_transformed_vector));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 498, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 498, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_transformed_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_transformed_vector.diminfo[0].strides = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_transformed_vector.diminfo[0].shape = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 498, __pyx_L1_error)</span>
  }
  __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_transformed_vector, ((PyArrayObject *)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0499</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0500</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0501</span>:     <span class="c"># Calculate normal vector to the plane of precession</span></pre>
<pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0502</span>:     <span class="n">normal_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">initial_vector</span><span class="p">,</span> <span class="n">transformed_vector</span><span class="p">)</span></pre>
<pre class='cython code score-62 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_cross);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, ((PyObject *)__pyx_v_initial_vector), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, ((PyObject *)__pyx_v_initial_vector), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    if (__pyx_t_10) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_10); __pyx_t_10 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0+__pyx_t_4, ((PyObject *)__pyx_v_initial_vector));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 1+__pyx_t_4, ((PyObject *)__pyx_v_transformed_vector));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_17, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_normal_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_normal_vector.diminfo[0].strides = __pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_normal_vector.diminfo[0].shape = __pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
  }
  __pyx_t_19 = 0;
  __pyx_v_normal_vector = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0503</span>:     <span class="n">transformed_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">normal_vector</span><span class="p">)</span></pre>
<pre class='cython code score-62 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_P), ((PyObject *)__pyx_v_normal_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_P), ((PyObject *)__pyx_v_normal_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (__pyx_t_8) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_P));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_P));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_4, ((PyObject *)__pyx_v_P));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_normal_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_normal_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_4, ((PyObject *)__pyx_v_normal_vector));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 503, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_transformed_normal, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_transformed_normal.diminfo[0].strides = __pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_transformed_normal.diminfo[0].shape = __pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  }
  __pyx_t_19 = 0;
  __pyx_v_transformed_normal = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0504</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0505</span>:     <span class="c"># Normalize vectors</span></pre>
<pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0506</span>:     <span class="n">initial_vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">initial_vector</span><span class="p">)</span></pre>
<pre class='cython code score-46 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_17, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_norm);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
    }
  }
  __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_17, __pyx_t_10, ((PyObject *)__pyx_v_initial_vector)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_17, ((PyObject *)__pyx_v_initial_vector));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_initial_vector), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_17) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_17, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_17);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_initial_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_initial_vector.diminfo[0].strides = __pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_initial_vector.diminfo[0].shape = __pyx_pybuffernd_initial_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
  }
  __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_initial_vector, ((PyArrayObject *)__pyx_t_17));
  __pyx_t_17 = 0;
</pre><pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0507</span>:     <span class="n">transformed_vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">transformed_vector</span><span class="p">)</span></pre>
<pre class='cython code score-46 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_norm);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_17 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, ((PyObject *)__pyx_v_transformed_vector)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_transformed_vector));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_17)) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_transformed_vector), __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_transformed_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_transformed_vector.diminfo[0].strides = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_transformed_vector.diminfo[0].shape = __pyx_pybuffernd_transformed_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  }
  __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_transformed_vector, ((PyArrayObject *)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0508</span>:     <span class="n">normal_vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">)</span></pre>
<pre class='cython code score-46 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_17, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_norm);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
    }
  }
  __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_17, __pyx_t_10, ((PyObject *)__pyx_v_normal_vector)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_17, ((PyObject *)__pyx_v_normal_vector));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_normal_vector), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_17) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_17, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_17);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_normal_vector, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_normal_vector.diminfo[0].strides = __pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_normal_vector.diminfo[0].shape = __pyx_pybuffernd_normal_vector.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
  }
  __pyx_t_19 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_normal_vector, ((PyArrayObject *)__pyx_t_17));
  __pyx_t_17 = 0;
</pre><pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0509</span>:     <span class="n">transformed_normal</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">transformed_normal</span><span class="p">)</span></pre>
<pre class='cython code score-46 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_norm);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_17 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, ((PyObject *)__pyx_v_transformed_normal)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_transformed_normal));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_17)) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_transformed_normal), __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_transformed_normal, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_transformed_normal.diminfo[0].strides = __pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_transformed_normal.diminfo[0].shape = __pyx_pybuffernd_transformed_normal.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
  }
  __pyx_t_19 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_transformed_normal, ((PyArrayObject *)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0510</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0511</span>:     <span class="c"># Convert precessed vector back to RA, Dec</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0512</span>:     <span class="n">ra_precessed</span><span class="p">,</span> <span class="n">dec_precessed</span> <span class="o">=</span> <span class="n">cartesianToRaDec</span><span class="p">(</span><span class="n">transformed_vector</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_12 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cartesianToRaDec(((PyArrayObject *)__pyx_v_transformed_vector), 0);
  __pyx_t_14 = __pyx_t_12.f0;
  __pyx_t_13 = __pyx_t_12.f1;
  __pyx_v_ra_precessed = __pyx_t_14;
  __pyx_v_dec_precessed = __pyx_t_13;
</pre><pre class="cython line score-0">&#xA0;<span class="">0513</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0514</span>:     <span class="c"># Calculate vector tangent to the parallel of declination</span></pre>
<pre class="cython line score-59" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0515</span>:     <span class="n">parallel_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="mf">0</span><span class="p">])</span></pre>
<pre class='cython code score-59 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_17, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 515, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 515, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='py_c_api'>PyFloat_FromDouble</span>((-sin(__pyx_v_ra)));<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 515, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(cos(__pyx_v_ra));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 515, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 515, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 2, __pyx_int_0);
  __pyx_t_17 = 0;
  __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
    }
  }
  __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_8, __pyx_t_9) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, __pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 515, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 515, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_parallel_vec.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_parallel_vec.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_parallel_vec.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_parallel_vec, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_parallel_vec.diminfo[0].strides = __pyx_pybuffernd_parallel_vec.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_parallel_vec.diminfo[0].shape = __pyx_pybuffernd_parallel_vec.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 515, __pyx_L1_error)</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_parallel_vec = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-59" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0516</span>:     <span class="n">parallel_vec_precessed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">ra_precessed</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">ra_precessed</span><span class="p">),</span> <span class="mf">0</span><span class="p">])</span></pre>
<pre class='cython code score-59 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((-sin(__pyx_v_ra_precessed)));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(cos(__pyx_v_ra_precessed));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_17 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 1, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_17, 2, __pyx_int_0);
  __pyx_t_10 = 0;
  __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
    }
  }
  __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_8, __pyx_t_17) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, __pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 516, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_parallel_vec_precessed.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_parallel_vec_precessed.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_parallel_vec_precessed.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_parallel_vec_precessed, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_parallel_vec_precessed.diminfo[0].strides = __pyx_pybuffernd_parallel_vec_precessed.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_parallel_vec_precessed.diminfo[0].shape = __pyx_pybuffernd_parallel_vec_precessed.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 516, __pyx_L1_error)</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_parallel_vec_precessed = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0517</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0518</span>:     <span class="c"># Project parallel vectors onto the plane perpendicular to the line of sight</span></pre>
<pre class="cython line score-74" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0519</span>:     <span class="n">proj_parallel</span> <span class="o">=</span> <span class="n">parallel_vec</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">parallel_vec</span><span class="p">,</span> <span class="n">initial_vector</span><span class="p">)</span><span class="o">*</span><span class="n">initial_vector</span></pre>
<pre class='cython code score-74 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_parallel_vec), ((PyObject *)__pyx_v_initial_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_parallel_vec), ((PyObject *)__pyx_v_initial_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_9) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_parallel_vec));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_parallel_vec));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_4, ((PyObject *)__pyx_v_parallel_vec));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_4, ((PyObject *)__pyx_v_initial_vector));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, ((PyObject *)__pyx_v_initial_vector));<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Subtract</span>(((PyObject *)__pyx_v_parallel_vec), __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_proj_parallel, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_proj_parallel.diminfo[0].strides = __pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_proj_parallel.diminfo[0].shape = __pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
  }
  __pyx_t_20 = 0;
  __pyx_v_proj_parallel = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-74" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0520</span>:     <span class="n">proj_parallel_precessed</span> <span class="o">=</span> <span class="n">parallel_vec_precessed</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">parallel_vec_precessed</span><span class="p">,</span> <span class="n">transformed_vector</span><span class="p">)</span><span class="o">*</span><span class="n">transformed_vector</span></pre>
<pre class='cython code score-74 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_17, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_17, ((PyObject *)__pyx_v_parallel_vec_precessed), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_17, ((PyObject *)__pyx_v_parallel_vec_precessed), ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (__pyx_t_17) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_17); __pyx_t_17 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_parallel_vec_precessed));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_parallel_vec_precessed));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_4, ((PyObject *)__pyx_v_parallel_vec_precessed));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_4, ((PyObject *)__pyx_v_transformed_vector));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, ((PyObject *)__pyx_v_transformed_vector));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Subtract</span>(((PyObject *)__pyx_v_parallel_vec_precessed), __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_proj_parallel_precessed, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_proj_parallel_precessed.diminfo[0].strides = __pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_proj_parallel_precessed.diminfo[0].shape = __pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>
  }
  __pyx_t_20 = 0;
  __pyx_v_proj_parallel_precessed = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0521</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0522</span>:     <span class="c"># Normalize projected vectors</span></pre>
<pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0523</span>:     <span class="n">proj_parallel</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">proj_parallel</span><span class="p">)</span></pre>
<pre class='cython code score-46 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_norm);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  __pyx_t_3 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_9, ((PyObject *)__pyx_v_proj_parallel)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, ((PyObject *)__pyx_v_proj_parallel));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_proj_parallel), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_8) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_8);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_proj_parallel, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
      __pyx_t_7 = __pyx_t_6 = __pyx_t_5 = 0;
    }
    __pyx_pybuffernd_proj_parallel.diminfo[0].strides = __pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_proj_parallel.diminfo[0].shape = __pyx_pybuffernd_proj_parallel.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
  }
  __pyx_t_20 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_proj_parallel, ((PyArrayObject *)__pyx_t_8));
  __pyx_t_8 = 0;
</pre><pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0524</span>:     <span class="n">proj_parallel_precessed</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">proj_parallel_precessed</span><span class="p">)</span></pre>
<pre class='cython code score-46 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_norm);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_8 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_9, ((PyObject *)__pyx_v_proj_parallel_precessed)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_proj_parallel_precessed));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 524, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_proj_parallel_precessed), __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 524, __pyx_L1_error)</span>
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_proj_parallel_precessed, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
      __pyx_t_5 = __pyx_t_6 = __pyx_t_7 = 0;
    }
    __pyx_pybuffernd_proj_parallel_precessed.diminfo[0].strides = __pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_proj_parallel_precessed.diminfo[0].shape = __pyx_pybuffernd_proj_parallel_precessed.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 524, __pyx_L1_error)</span>
  }
  __pyx_t_20 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_proj_parallel_precessed, ((PyArrayObject *)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0525</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0526</span>:     <span class="c"># Calculate the angles between the normal vector and projected parallels</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0527</span>:     <span class="c"># in the plane perpendicular to the line of sight (sensor plane).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0528</span>:     <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0529</span>:     <span class="c"># The normal vectors are fixed relative to the camera sensor.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0530</span>:     <span class="c"># The projected parallels represent how the celestial parallels appear on the sensor plane.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0531</span>:     <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0532</span>:     <span class="c"># Since the rotationWrtStandard function computes pos_angle_ref as the angle between</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0533</span>:     <span class="c"># a row of pixels and the parallel passing through the center of the FOV,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0534</span>:     <span class="c"># we want to determine how precession affects this angle.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0535</span>:     <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0536</span>:     <span class="c"># By comparing these angles before and after precession, we can quantify</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0537</span>:     <span class="c"># the change in field orientation due to precession.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0538</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0539</span>:     <span class="c"># Angle for the initial position</span></pre>
<pre class="cython line score-96" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0540</span>:     <span class="n">angle1</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">,</span> <span class="n">proj_parallel</span><span class="p">),</span> <span class="n">initial_vector</span><span class="p">),</span></pre>
<pre class='cython code score-96 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_17, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_cross);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_17, ((PyObject *)__pyx_v_normal_vector), ((PyObject *)__pyx_v_proj_parallel)};
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_17, ((PyObject *)__pyx_v_normal_vector), ((PyObject *)__pyx_v_proj_parallel)};
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  } else
  #endif
  {
    __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    if (__pyx_t_17) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_17); __pyx_t_17 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_normal_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_normal_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0+__pyx_t_4, ((PyObject *)__pyx_v_normal_vector));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_proj_parallel));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_proj_parallel));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1+__pyx_t_4, ((PyObject *)__pyx_v_proj_parallel));
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_16, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_9)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_8, ((PyObject *)__pyx_v_initial_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_9)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_8, ((PyObject *)__pyx_v_initial_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    if (__pyx_t_10) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_10); __pyx_t_10 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0+__pyx_t_4, __pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_initial_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1+__pyx_t_4, ((PyObject *)__pyx_v_initial_vector));
    __pyx_t_8 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_16, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 540, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_v_angle1 = atan2(__pyx_t_13, __pyx_t_14);
</pre><pre class="cython line score-53" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0541</span>:                    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">,</span> <span class="n">proj_parallel</span><span class="p">))</span></pre>
<pre class='cython code score-53 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 541, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 541, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_16))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_16);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_16);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_16, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_16)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_normal_vector), ((PyObject *)__pyx_v_proj_parallel)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_16, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_16)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_normal_vector), ((PyObject *)__pyx_v_proj_parallel)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_16, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 541, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_9) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_normal_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_normal_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_4, ((PyObject *)__pyx_v_normal_vector));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_proj_parallel));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_proj_parallel));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_4, ((PyObject *)__pyx_v_proj_parallel));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_16, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  __pyx_t_14 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_14 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 541, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0542</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0543</span>:     <span class="c"># Angle for the precessed position</span></pre>
<pre class="cython line score-96" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0544</span>:     <span class="n">angle2</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">transformed_normal</span><span class="p">,</span> <span class="n">proj_parallel_precessed</span><span class="p">),</span> <span class="n">transformed_vector</span><span class="p">),</span></pre>
<pre class='cython code score-96 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_16, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_16, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_cross);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_transformed_normal), ((PyObject *)__pyx_v_proj_parallel_precessed)};
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_transformed_normal), ((PyObject *)__pyx_v_proj_parallel_precessed)};
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  } else
  #endif
  {
    __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    if (__pyx_t_9) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_transformed_normal));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_transformed_normal));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0+__pyx_t_4, ((PyObject *)__pyx_v_transformed_normal));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_proj_parallel_precessed));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_proj_parallel_precessed));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 1+__pyx_t_4, ((PyObject *)__pyx_v_proj_parallel_precessed));
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_17, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_16, ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_16, ((PyObject *)__pyx_v_transformed_vector)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  } else
  #endif
  {
    __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    if (__pyx_t_10) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_10); __pyx_t_10 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0+__pyx_t_4, __pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_transformed_vector));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 1+__pyx_t_4, ((PyObject *)__pyx_v_transformed_vector));
    __pyx_t_16 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_17, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_14 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_14 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_v_angle2 = atan2(__pyx_t_14, __pyx_t_13);
</pre><pre class="cython line score-53" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0545</span>:                    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">transformed_normal</span><span class="p">,</span> <span class="n">proj_parallel_precessed</span><span class="p">))</span></pre>
<pre class='cython code score-53 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_transformed_normal), ((PyObject *)__pyx_v_proj_parallel_precessed)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_17)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, ((PyObject *)__pyx_v_transformed_normal), ((PyObject *)__pyx_v_proj_parallel_precessed)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_17, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  } else
  #endif
  {
    __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    if (__pyx_t_8) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_transformed_normal));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_transformed_normal));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0+__pyx_t_4, ((PyObject *)__pyx_v_transformed_normal));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_proj_parallel_precessed));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_proj_parallel_precessed));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1+__pyx_t_4, ((PyObject *)__pyx_v_proj_parallel_precessed));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_16, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0546</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0547</span>:     <span class="c"># Calculate the change in angle</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0548</span>:     <span class="n">rotation_change</span> <span class="o">=</span> <span class="n">angle2</span> <span class="o">-</span> <span class="n">angle1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_rotation_change = (__pyx_v_angle2 - __pyx_v_angle1);
</pre><pre class="cython line score-0">&#xA0;<span class="">0549</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0550</span>:     <span class="c"># Apply the rotation change to the initial rotation angle</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0551</span>:     <span class="n">new_rot_angle</span> <span class="o">=</span> <span class="n">rot_angle</span> <span class="o">+</span> <span class="n">rotation_change</span></pre>
<pre class='cython code score-0 '>  __pyx_v_new_rot_angle = (__pyx_v_rot_angle + __pyx_v_rotation_change);
</pre><pre class="cython line score-0">&#xA0;<span class="">0552</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0553</span>:     <span class="c"># Normalize the new rotation angle to be between -pi and pi</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0554</span>:     <span class="n">new_rot_angle</span> <span class="o">=</span> <span class="n">fmod</span><span class="p">(</span><span class="n">new_rot_angle</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">,</span> <span class="mf">2</span><span class="o">*</span><span class="n">M_PI</span><span class="p">)</span> <span class="o">-</span> <span class="n">M_PI</span></pre>
<pre class='cython code score-0 '>  __pyx_v_new_rot_angle = (fmod((__pyx_v_new_rot_angle + M_PI), (2.0 * M_PI)) - M_PI);
</pre><pre class="cython line score-0">&#xA0;<span class="">0555</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0556</span>:     <span class="c"># print(&quot;Rotation change due to precession: {} arcmin&quot;.format(degrees(rotation_change) * 60))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0557</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0558</span>:     <span class="k">return</span> <span class="n">ra_precessed</span><span class="p">,</span> <span class="n">dec_precessed</span><span class="p">,</span> <span class="n">new_rot_angle</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2.f0 = __pyx_v_ra_precessed;
  __pyx_t_2.f1 = __pyx_v_dec_precessed;
  __pyx_t_2.f2 = __pyx_v_new_rot_angle;
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0559</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0560</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0561</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0562</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0563</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">refractionApparentToTrue</span><span class="p">(</span><span class="n">double</span> <span class="n">elev</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static double __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionApparentToTrue(double __pyx_v_elev) {
  double __pyx_v_refraction;
  double __pyx_v_elev_calc;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("refractionApparentToTrue", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0564</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Correct the apparent elevation of a star for refraction to true elevation. The temperature and air</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0565</span>: <span class="sd">        pressure are assumed to be unknown. </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0566</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0567</span>: <span class="sd">        Source: Explanatory Supplement to the Astronomical Almanac (1992), p. 144.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0568</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0569</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0570</span>: <span class="sd">        elev: [float] Apparent elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0571</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0572</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0573</span>: <span class="sd">        [float] True elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0574</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0575</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0576</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0577</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">refraction</span><span class="p">,</span> <span class="nf">elev_calc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0578</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0579</span>:     <span class="c"># Don&#39;t apply refraction for elevations below -0.5 deg</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0580</span>:     <span class="k">if</span> <span class="n">elev</span> <span class="o">&lt;=</span> <span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_elev &lt;= __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(-0.5)) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0581</span>:         <span class="n">elev_calc</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_elev_calc = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(-0.5);
</pre><pre class="cython line score-0">&#xA0;<span class="">0582</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0583</span>:         <span class="n">elev_calc</span> <span class="o">=</span> <span class="n">elev</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_elev_calc = __pyx_v_elev;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0584</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0585</span>:     <span class="c"># Refraction in radians</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0586</span>:     <span class="n">refraction</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">60</span><span class="o">*</span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">elev_calc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">7.31</span><span class="o">/</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">elev_calc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">4.4</span><span class="p">)))))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_refraction = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((1.0 / (60.0 * tan(__pyx_f_3RMS_10Astrometry_11CyFunctions_radians((__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_elev_calc) + (7.31 / (__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_elev_calc) + 4.4))))))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0587</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0588</span>:     <span class="c"># Correct the elevation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0589</span>:     <span class="k">return</span> <span class="n">elev</span> <span class="o">-</span> <span class="n">refraction</span></pre>
<pre class='cython code score-0 '>  __pyx_r = (__pyx_v_elev - __pyx_v_refraction);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0590</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0591</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0592</span>: </pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0593</span>: <span class="k">cpdef</span> <span class="kt">double</span> <span class="nf">pyRefractionApparentToTrue</span><span class="p">(</span><span class="n">double</span> <span class="n">elev</span><span class="p">):</span></pre>
<pre class='cython code score-21 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_11pyRefractionApparentToTrue(PyObject *__pyx_self, PyObject *__pyx_arg_elev); /*proto*/
static double __pyx_f_3RMS_10Astrometry_11CyFunctions_pyRefractionApparentToTrue(double __pyx_v_elev, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pyRefractionApparentToTrue", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_11pyRefractionApparentToTrue(PyObject *__pyx_self, PyObject *__pyx_arg_elev); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_10pyRefractionApparentToTrue[] = " Python version of the refraction correction (apparent to true).\n\n    Arguments:\n        elev: [float] Apparent elevation (radians).\n\n    Return:\n        [float] True elevation (radians).\n\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_11pyRefractionApparentToTrue(PyObject *__pyx_self, PyObject *__pyx_arg_elev) {
  double __pyx_v_elev;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pyRefractionApparentToTrue (wrapper)", 0);
  assert(__pyx_arg_elev); {
    __pyx_v_elev = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_arg_elev); if (unlikely((__pyx_v_elev == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 593, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.pyRefractionApparentToTrue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_10pyRefractionApparentToTrue(__pyx_self, ((double)__pyx_v_elev));
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_10pyRefractionApparentToTrue(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_elev) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pyRefractionApparentToTrue", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_pyRefractionApparentToTrue(__pyx_v_elev, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 593, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.pyRefractionApparentToTrue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0594</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Python version of the refraction correction (apparent to true).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0595</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0596</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0597</span>: <span class="sd">        elev: [float] Apparent elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0598</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0599</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0600</span>: <span class="sd">        [float] True elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0601</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0602</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0603</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0604</span>:     <span class="k">return</span> <span class="n">refractionApparentToTrue</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionApparentToTrue(__pyx_v_elev);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0605</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0606</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0607</span>: </pre>
<pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0608</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">eqRefractionApparentToTrue</span><span class="p">(</span><span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_13eqRefractionApparentToTrue(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_eqRefractionApparentToTrue(double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_azim;
  double __pyx_v_alt;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("eqRefractionApparentToTrue", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_13eqRefractionApparentToTrue(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_12eqRefractionApparentToTrue[] = " Correct the equatorial coordinates for refraction. The correction is done from apparent to true\n        coordinates.\n    \n    Arguments:\n        ra: [float] J2000 right ascension in radians.\n        dec: [float] J2000 declination in radians.\n        jd: [float] Julian date.\n        lat: [float] latitude in radians.\n        lon: [float] longitude in radians.\n\n    Return:\n        (ra, dec):\n            - ra: [float] Refraction corrected (true) right ascension in radians.\n            - dec: [float] Refraction corrected (true) declination in radians.\n\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_13eqRefractionApparentToTrue(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("eqRefractionApparentToTrue (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra,&amp;__pyx_n_s_dec,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionApparentToTrue", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionApparentToTrue", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionApparentToTrue", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionApparentToTrue", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "eqRefractionApparentToTrue") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_ra = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_ra == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
    __pyx_v_dec = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dec == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionApparentToTrue", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 608, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.eqRefractionApparentToTrue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_12eqRefractionApparentToTrue(__pyx_self, __pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_12eqRefractionApparentToTrue(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("eqRefractionApparentToTrue", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_eqRefractionApparentToTrue(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.eqRefractionApparentToTrue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0609</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Correct the equatorial coordinates for refraction. The correction is done from apparent to true</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0610</span>: <span class="sd">        coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0611</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0612</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0613</span>: <span class="sd">        ra: [float] J2000 right ascension in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0614</span>: <span class="sd">        dec: [float] J2000 declination in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0615</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0616</span>: <span class="sd">        lat: [float] latitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0617</span>: <span class="sd">        lon: [float] longitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0618</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0619</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0620</span>: <span class="sd">        (ra, dec):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0621</span>: <span class="sd">            - ra: [float] Refraction corrected (true) right ascension in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0622</span>: <span class="sd">            - dec: [float] Refraction corrected (true) declination in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0623</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0624</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0625</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0626</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">azim</span><span class="p">,</span> <span class="nf">alt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0627</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0628</span>:     <span class="c"># Precess RA/Dec from J2000 to the epoch of date</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0629</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">equatorialCoordPrecession</span><span class="p">(</span><span class="n">J2000_DAYS</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(__pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS, __pyx_v_jd, __pyx_v_ra, __pyx_v_dec, 0);
  __pyx_t_2 = __pyx_t_1.f0;
  __pyx_t_3 = __pyx_t_1.f1;
  __pyx_v_ra = __pyx_t_2;
  __pyx_v_dec = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0630</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0631</span>:     <span class="c"># Convert coordinates to alt/az</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0632</span>:     <span class="n">azim</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">cyraDec2AltAz</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyraDec2AltAz(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0);
  __pyx_t_3 = __pyx_t_1.f0;
  __pyx_t_2 = __pyx_t_1.f1;
  __pyx_v_azim = __pyx_t_3;
  __pyx_v_alt = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">0633</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0634</span>:     <span class="c"># Correct the elevation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0635</span>:     <span class="n">alt</span> <span class="o">=</span> <span class="n">refractionApparentToTrue</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_alt = __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionApparentToTrue(__pyx_v_alt);
</pre><pre class="cython line score-0">&#xA0;<span class="">0636</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0637</span>:     <span class="c"># Convert back to equatorial</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0638</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">cyaltAz2RADec</span><span class="p">(</span><span class="n">azim</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyaltAz2RADec(__pyx_v_azim, __pyx_v_alt, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0);
  __pyx_t_2 = __pyx_t_1.f0;
  __pyx_t_3 = __pyx_t_1.f1;
  __pyx_v_ra = __pyx_t_2;
  __pyx_v_dec = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0639</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0640</span>:     <span class="c"># Precess RA/Dec from the epoch of date to J2000</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0641</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">equatorialCoordPrecession</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">J2000_DAYS</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(__pyx_v_jd, __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS, __pyx_v_ra, __pyx_v_dec, 0);
  __pyx_t_3 = __pyx_t_1.f0;
  __pyx_t_2 = __pyx_t_1.f1;
  __pyx_v_ra = __pyx_t_3;
  __pyx_v_dec = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">0642</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0643</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0644</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1.f0 = __pyx_v_ra;
  __pyx_t_1.f1 = __pyx_v_dec;
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0645</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0646</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0647</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0648</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0649</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">refractionTrueToApparent</span><span class="p">(</span><span class="n">double</span> <span class="n">elev</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static double __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionTrueToApparent(double __pyx_v_elev) {
  double __pyx_v_refraction;
  double __pyx_v_elev_calc;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("refractionTrueToApparent", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0650</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Correct the true elevation of a star for refraction to apparent elevation. The temperature and air</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0651</span>: <span class="sd">        pressure are assumed to be unknown. </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0652</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0653</span>: <span class="sd">        Source: https://en.wikipedia.org/wiki/Atmospheric_refraction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0654</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0655</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0656</span>: <span class="sd">        elev: [float] Apparent elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0657</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0658</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0659</span>: <span class="sd">        [float] True elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0660</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0661</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0662</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0663</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">refraction</span><span class="p">,</span> <span class="nf">elev_calc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0664</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0665</span>:     <span class="c"># Don&#39;t apply refraction for elevation below -0.5 deg</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0666</span>:     <span class="k">if</span> <span class="n">elev</span> <span class="o">&lt;=</span> <span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_elev &lt;= __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(-0.5)) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0667</span>:         <span class="n">elev_calc</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_elev_calc = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(-0.5);
</pre><pre class="cython line score-0">&#xA0;<span class="">0668</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0669</span>:         <span class="n">elev_calc</span> <span class="o">=</span> <span class="n">elev</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_elev_calc = __pyx_v_elev;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0670</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0671</span>:     <span class="c"># Refraction in radians</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0672</span>:     <span class="n">refraction</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">1.02</span><span class="o">/</span><span class="p">(</span><span class="mf">60</span><span class="o">*</span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">elev_calc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">10.3</span><span class="o">/</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">elev_calc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">5.11</span><span class="p">)))))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_refraction = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((1.02 / (60.0 * tan(__pyx_f_3RMS_10Astrometry_11CyFunctions_radians((__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_elev_calc) + (10.3 / (__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_elev_calc) + 5.11))))))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0673</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0674</span>:     <span class="c"># Apply the refraction</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0675</span>:     <span class="k">return</span> <span class="n">elev</span> <span class="o">+</span> <span class="n">refraction</span></pre>
<pre class='cython code score-0 '>  __pyx_r = (__pyx_v_elev + __pyx_v_refraction);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0676</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0677</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0678</span>: </pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0679</span>: <span class="k">cpdef</span> <span class="kt">double</span> <span class="nf">pyRefractionTrueToApparent</span><span class="p">(</span><span class="n">double</span> <span class="n">elev</span><span class="p">):</span></pre>
<pre class='cython code score-21 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_15pyRefractionTrueToApparent(PyObject *__pyx_self, PyObject *__pyx_arg_elev); /*proto*/
static double __pyx_f_3RMS_10Astrometry_11CyFunctions_pyRefractionTrueToApparent(double __pyx_v_elev, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pyRefractionTrueToApparent", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_15pyRefractionTrueToApparent(PyObject *__pyx_self, PyObject *__pyx_arg_elev); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_14pyRefractionTrueToApparent[] = " Python version of the refraction correction (true to apparent).\n\n    Arguments:\n        elev: [float] Apparent elevation (radians).\n\n    Return:\n        [float] True elevation (radians).\n\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_15pyRefractionTrueToApparent(PyObject *__pyx_self, PyObject *__pyx_arg_elev) {
  double __pyx_v_elev;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pyRefractionTrueToApparent (wrapper)", 0);
  assert(__pyx_arg_elev); {
    __pyx_v_elev = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_arg_elev); if (unlikely((__pyx_v_elev == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 679, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.pyRefractionTrueToApparent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_14pyRefractionTrueToApparent(__pyx_self, ((double)__pyx_v_elev));
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_14pyRefractionTrueToApparent(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_elev) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pyRefractionTrueToApparent", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_pyRefractionTrueToApparent(__pyx_v_elev, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 679, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.pyRefractionTrueToApparent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0680</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Python version of the refraction correction (true to apparent).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0681</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0682</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0683</span>: <span class="sd">        elev: [float] Apparent elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0684</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0685</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0686</span>: <span class="sd">        [float] True elevation (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0687</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0688</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0689</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0690</span>:     <span class="k">return</span> <span class="n">refractionTrueToApparent</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionTrueToApparent(__pyx_v_elev);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0691</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0692</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0693</span>: </pre>
<pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0694</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">eqRefractionTrueToApparent</span><span class="p">(</span><span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_17eqRefractionTrueToApparent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_eqRefractionTrueToApparent(double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_azim;
  double __pyx_v_alt;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("eqRefractionTrueToApparent", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_17eqRefractionTrueToApparent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_16eqRefractionTrueToApparent[] = " Correct the equatorial coordinates for refraction. The correction is done from true to apparent\n        coordinates.\n    \n    Arguments:\n        ra: [float] J2000 Right ascension in radians.\n        dec: [float] J2000 Declination in radians.\n        jd: [float] Julian date.\n        lat: [float] Latitude in radians.\n        lon: [float] Longitude in radians.\n\n    Return:\n        (ra, dec):\n            - ra: [float] Apparent right ascension in radians.\n            - dec: [float] Apparent declination in radians.\n\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_17eqRefractionTrueToApparent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("eqRefractionTrueToApparent (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra,&amp;__pyx_n_s_dec,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionTrueToApparent", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionTrueToApparent", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionTrueToApparent", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionTrueToApparent", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "eqRefractionTrueToApparent") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_ra = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_ra == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
    __pyx_v_dec = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dec == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("eqRefractionTrueToApparent", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.eqRefractionTrueToApparent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_16eqRefractionTrueToApparent(__pyx_self, __pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_16eqRefractionTrueToApparent(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("eqRefractionTrueToApparent", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_eqRefractionTrueToApparent(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 694, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.eqRefractionTrueToApparent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0695</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Correct the equatorial coordinates for refraction. The correction is done from true to apparent</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0696</span>: <span class="sd">        coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0697</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0698</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0699</span>: <span class="sd">        ra: [float] J2000 Right ascension in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0700</span>: <span class="sd">        dec: [float] J2000 Declination in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0701</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0702</span>: <span class="sd">        lat: [float] Latitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0703</span>: <span class="sd">        lon: [float] Longitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0704</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0705</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0706</span>: <span class="sd">        (ra, dec):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0707</span>: <span class="sd">            - ra: [float] Apparent right ascension in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0708</span>: <span class="sd">            - dec: [float] Apparent declination in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0709</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0710</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0711</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0712</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">azim</span><span class="p">,</span> <span class="nf">alt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0713</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0714</span>:     <span class="c"># Precess RA/Dec from J2000 to the epoch of date</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0715</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">equatorialCoordPrecession</span><span class="p">(</span><span class="n">J2000_DAYS</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(__pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS, __pyx_v_jd, __pyx_v_ra, __pyx_v_dec, 0);
  __pyx_t_2 = __pyx_t_1.f0;
  __pyx_t_3 = __pyx_t_1.f1;
  __pyx_v_ra = __pyx_t_2;
  __pyx_v_dec = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0716</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0717</span>:     <span class="c"># Convert coordinates to alt/az</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0718</span>:     <span class="n">azim</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">cyraDec2AltAz</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyraDec2AltAz(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0);
  __pyx_t_3 = __pyx_t_1.f0;
  __pyx_t_2 = __pyx_t_1.f1;
  __pyx_v_azim = __pyx_t_3;
  __pyx_v_alt = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">0719</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0720</span>:     <span class="c"># Correct the elevation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0721</span>:     <span class="n">alt</span> <span class="o">=</span> <span class="n">refractionTrueToApparent</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_alt = __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionTrueToApparent(__pyx_v_alt);
</pre><pre class="cython line score-0">&#xA0;<span class="">0722</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0723</span>:     <span class="c"># Convert back to equatorial</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0724</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">cyaltAz2RADec</span><span class="p">(</span><span class="n">azim</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyaltAz2RADec(__pyx_v_azim, __pyx_v_alt, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0);
  __pyx_t_2 = __pyx_t_1.f0;
  __pyx_t_3 = __pyx_t_1.f1;
  __pyx_v_ra = __pyx_t_2;
  __pyx_v_dec = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0725</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0726</span>:     <span class="c"># Precess RA/Dec from the epoch of date to J2000</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0727</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">equatorialCoordPrecession</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">J2000_DAYS</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(__pyx_v_jd, __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS, __pyx_v_ra, __pyx_v_dec, 0);
  __pyx_t_3 = __pyx_t_1.f0;
  __pyx_t_2 = __pyx_t_1.f1;
  __pyx_v_ra = __pyx_t_3;
  __pyx_v_dec = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">0728</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0729</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0730</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1.f0 = __pyx_v_ra;
  __pyx_t_1.f1 = __pyx_v_dec;
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0731</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0732</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0733</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0734</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0735</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">cyraDec2AltAz</span><span class="p">(</span><span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_19cyraDec2AltAz(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_cyraDec2AltAz(double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_lst;
  double __pyx_v_ha;
  double __pyx_v_azim;
  double __pyx_v_sin_elev;
  double __pyx_v_elev;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyraDec2AltAz", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_19cyraDec2AltAz(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_18cyraDec2AltAz[] = " Convert right ascension and declination to azimuth (+East of due North) and altitude. Same epoch is\n        assumed, no correction for refraction is done.\n\n    Arguments:\n        ra: [float] Right ascension in radians.\n        dec: [float] Declination in radians.\n        jd: [float] Julian date.\n        lat: [float] Latitude in radians.\n        lon: [float] Longitude in radians.\n\n    Return:\n        (azim, elev): [tuple]\n            azim: [float] Azimuth (+east of due north) in radians.\n            elev: [float] Elevation above horizon in radians.\n\n        ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_19cyraDec2AltAz(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyraDec2AltAz (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra,&amp;__pyx_n_s_dec,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDec2AltAz", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDec2AltAz", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDec2AltAz", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDec2AltAz", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyraDec2AltAz") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_ra = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_ra == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
    __pyx_v_dec = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dec == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDec2AltAz", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 735, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyraDec2AltAz", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_18cyraDec2AltAz(__pyx_self, __pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_18cyraDec2AltAz(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyraDec2AltAz", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_cyraDec2AltAz(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 735, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyraDec2AltAz", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0736</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert right ascension and declination to azimuth (+East of due North) and altitude. Same epoch is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0737</span>: <span class="sd">        assumed, no correction for refraction is done.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0738</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0739</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0740</span>: <span class="sd">        ra: [float] Right ascension in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0741</span>: <span class="sd">        dec: [float] Declination in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0742</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0743</span>: <span class="sd">        lat: [float] Latitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0744</span>: <span class="sd">        lon: [float] Longitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0745</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0746</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0747</span>: <span class="sd">        (azim, elev): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0748</span>: <span class="sd">            azim: [float] Azimuth (+east of due north) in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0749</span>: <span class="sd">            elev: [float] Elevation above horizon in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0750</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0751</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0752</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0753</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">lst</span><span class="p">,</span> <span class="nf">ha</span><span class="p">,</span> <span class="nf">azim</span><span class="p">,</span> <span class="nf">sin_elev</span><span class="p">,</span> <span class="nf">elev</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0754</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0755</span>:     <span class="c"># Calculate Local Sidereal Time</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0756</span>:     <span class="n">lst</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">cyjd2LST</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">degrees</span><span class="p">(</span><span class="n">lon</span><span class="p">)))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_lst = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_f_3RMS_10Astrometry_11CyFunctions_cyjd2LST(__pyx_v_jd, __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_lon)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0757</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0758</span>:     <span class="c"># Calculate the hour angle</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0759</span>:     <span class="n">ha</span> <span class="o">=</span> <span class="n">lst</span> <span class="o">-</span> <span class="n">ra</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ha = (__pyx_v_lst - __pyx_v_ra);
</pre><pre class="cython line score-0">&#xA0;<span class="">0760</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0761</span>:     <span class="c"># Constrain the hour angle to [-pi, pi] range</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0762</span>:     <span class="n">ha</span> <span class="o">=</span> <span class="p">(</span><span class="n">ha</span> <span class="o">+</span> <span class="n">pi</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">pi</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ha = (fmod((__pyx_v_ha + __pyx_v_3RMS_10Astrometry_11CyFunctions_pi), (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi)) - __pyx_v_3RMS_10Astrometry_11CyFunctions_pi);
</pre><pre class="cython line score-0">&#xA0;<span class="">0763</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0764</span>:     <span class="c"># Calculate the azimuth</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0765</span>:     <span class="n">azim</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">+</span> <span class="n">atan2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">ha</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="n">tan</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_azim = (__pyx_v_3RMS_10Astrometry_11CyFunctions_pi + atan2(sin(__pyx_v_ha), ((cos(__pyx_v_ha) * sin(__pyx_v_lat)) - (tan(__pyx_v_dec) * cos(__pyx_v_lat)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0766</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0767</span>:     <span class="c"># Calculate the sine of elevation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0768</span>:     <span class="n">sin_elev</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sin_elev = ((sin(__pyx_v_lat) * sin(__pyx_v_dec)) + ((cos(__pyx_v_lat) * cos(__pyx_v_dec)) * cos(__pyx_v_ha)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0769</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0770</span>:     <span class="c"># Wrap the sine of elevation in the [-1, +1] range</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0771</span>:     <span class="n">sin_elev</span> <span class="o">=</span> <span class="p">(</span><span class="n">sin_elev</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span><span class="o">%</span><span class="mf">2</span> <span class="o">-</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sin_elev = (fmod((__pyx_v_sin_elev + 1.0), 2.0) - 1.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0772</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0773</span>:     <span class="n">elev</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="n">sin_elev</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_elev = asin(__pyx_v_sin_elev);
</pre><pre class="cython line score-0">&#xA0;<span class="">0774</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0775</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1.f0 = __pyx_v_azim;
  __pyx_t_1.f1 = __pyx_v_elev;
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0776</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0777</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0778</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0779</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">cyTrueRaDec2ApparentAltAz</span><span class="p">(</span><span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-8 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_21cyTrueRaDec2ApparentAltAz(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_cyTrueRaDec2ApparentAltAz(double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_3RMS_10Astrometry_11CyFunctions_cyTrueRaDec2ApparentAltAz *__pyx_optional_args) {
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("RMS.Astrometry.CyFunctions.cyTrueRaDec2ApparentAltAz", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_21cyTrueRaDec2ApparentAltAz(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_20cyTrueRaDec2ApparentAltAz[] = " Convert the true right ascension and declination in J2000 to azimuth (+East of due North) and \n        altitude in the epoch of date. The correction for refraction is performed.\n\n    Arguments:\n        ra: [float] Right ascension in radians (J2000).\n        dec: [float] Declination in radians (J2000).\n        jd: [float] Julian date.\n        lat: [float] Latitude in radians.\n        lon: [float] Longitude in radians.\n\n    Keyword arguments:\n        refraction: [bool] Apply refraction correction. True by default.\n\n    Return:\n        (azim, elev): [tuple]\n            azim: [float] Azimuth (+east of due north) in radians (epoch of date).\n            elev: [float] Elevation above horizon in radians (epoch of date).\n\n        ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_21cyTrueRaDec2ApparentAltAz(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyBoolObject *__pyx_v_refraction = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyTrueRaDec2ApparentAltAz (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra,&amp;__pyx_n_s_dec,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,&amp;__pyx_n_s_refraction,0};
    PyObject* values[6] = {0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_20cyTrueRaDec2ApparentAltAz(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra, double __pyx_v_dec, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, PyBoolObject *__pyx_v_refraction) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyTrueRaDec2ApparentAltAz", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.refraction = __pyx_v_refraction;
  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyTrueRaDec2ApparentAltAz(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0, &amp;__pyx_t_2); 
  __pyx_t_3 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 779, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyTrueRaDec2ApparentAltAz", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_3RMS_10Astrometry_11CyFunctions_cyTrueRaDec2ApparentAltAz {
  int __pyx_n;
  PyBoolObject *refraction;
};
</pre><pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0780</span>:     <span class="nb">bool</span> <span class="n">refraction</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>  PyBoolObject *__pyx_v_refraction = ((PyBoolObject *)Py_True);
  double __pyx_v_azim;
  double __pyx_v_elev;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyTrueRaDec2ApparentAltAz", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_refraction = __pyx_optional_args-&gt;refraction;
    }
  }
/* … */
    values[5] = (PyObject *)((PyBoolObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz", 0, 5, 6, 1); <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz", 0, 5, 6, 2); <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz", 0, 5, 6, 3); <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz", 0, 5, 6, 4); <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_refraction);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyTrueRaDec2ApparentAltAz") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ra = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_ra == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
    __pyx_v_dec = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dec == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
    __pyx_v_refraction = ((PyBoolObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 779, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyTrueRaDec2ApparentAltAz", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_refraction), __pyx_ptype_7cpython_4bool_bool, 1, "refraction", 0))) <span class='error_goto'>__PYX_ERR(0, 780, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_20cyTrueRaDec2ApparentAltAz(__pyx_self, __pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, __pyx_v_refraction);
</pre><pre class="cython line score-0">&#xA0;<span class="">0781</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert the true right ascension and declination in J2000 to azimuth (+East of due North) and </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0782</span>: <span class="sd">        altitude in the epoch of date. The correction for refraction is performed.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0783</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0784</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0785</span>: <span class="sd">        ra: [float] Right ascension in radians (J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0786</span>: <span class="sd">        dec: [float] Declination in radians (J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0787</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0788</span>: <span class="sd">        lat: [float] Latitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0789</span>: <span class="sd">        lon: [float] Longitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0790</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0791</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0792</span>: <span class="sd">        refraction: [bool] Apply refraction correction. True by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0793</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0794</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0795</span>: <span class="sd">        (azim, elev): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0796</span>: <span class="sd">            azim: [float] Azimuth (+east of due north) in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0797</span>: <span class="sd">            elev: [float] Elevation above horizon in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0798</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0799</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0800</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0801</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">azim</span><span class="p">,</span> <span class="nf">elev</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0802</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0803</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0804</span>:     <span class="c"># Precess RA/Dec to the epoch of date</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0805</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">equatorialCoordPrecession</span><span class="p">(</span><span class="n">J2000_DAYS</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(__pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS, __pyx_v_jd, __pyx_v_ra, __pyx_v_dec, 0);
  __pyx_t_2 = __pyx_t_1.f0;
  __pyx_t_3 = __pyx_t_1.f1;
  __pyx_v_ra = __pyx_t_2;
  __pyx_v_dec = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0806</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0807</span>:     <span class="c"># Convert to alt/az</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0808</span>:     <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">cyraDec2AltAz</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyraDec2AltAz(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0);
  __pyx_t_3 = __pyx_t_1.f0;
  __pyx_t_2 = __pyx_t_1.f1;
  __pyx_v_azim = __pyx_t_3;
  __pyx_v_elev = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">0809</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0810</span>:     <span class="c"># Correct elevation for refraction</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0811</span>:     <span class="k">if</span> <span class="n">refraction</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_refraction)); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L1_error)</span>
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0812</span>:         <span class="n">elev</span> <span class="o">=</span> <span class="n">refractionTrueToApparent</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_elev = __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionTrueToApparent(__pyx_v_elev);
</pre><pre class="cython line score-0">&#xA0;<span class="">0813</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0814</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0815</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1.f0 = __pyx_v_azim;
  __pyx_t_1.f1 = __pyx_v_elev;
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0816</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0817</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0818</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0819</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0820</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-50" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0821</span>: <span class="k">def</span> <span class="nf">cyTrueRaDec2ApparentAltAz_vect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">ra_arr</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-50 '>/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_23cyTrueRaDec2ApparentAltAz_vect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_22cyTrueRaDec2ApparentAltAz_vect[] = " Convert the true right ascension and declination in J2000 to azimuth (+East of due North) and \n        altitude in the epoch of date. The correction for refraction is performed.\n    Arguments:\n        ra_arr: [ndarray] Right ascension in radians (J2000).\n        dec:_arr [ndarray] Declination in radians (J2000).\n        jd_arr: [ndarray] Julian date.\n        lat: [float] Latitude in radians.\n        lon: [float] Longitude in radians.\n    Keyword arguments:\n        refraction: [bool] Apply refraction correction. True by default.\n    Return:\n        (azim, elev): [tuple]\n            azim: [ndarray] Azimuth (+east of due north) in radians (epoch of date).\n            elev: [ndarray] Elevation above horizon in radians (epoch of date).\n        ";
static PyMethodDef __pyx_mdef_3RMS_10Astrometry_11CyFunctions_23cyTrueRaDec2ApparentAltAz_vect = {"cyTrueRaDec2ApparentAltAz_vect", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_3RMS_10Astrometry_11CyFunctions_23cyTrueRaDec2ApparentAltAz_vect, METH_VARARGS|METH_KEYWORDS, __pyx_doc_3RMS_10Astrometry_11CyFunctions_22cyTrueRaDec2ApparentAltAz_vect};
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_23cyTrueRaDec2ApparentAltAz_vect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_ra_arr = 0;
  PyArrayObject *__pyx_v_dec_arr = 0;
  PyArrayObject *__pyx_v_jd_arr = 0;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyBoolObject *__pyx_v_refraction = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyTrueRaDec2ApparentAltAz_vect (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra_arr,&amp;__pyx_n_s_dec_arr,&amp;__pyx_n_s_jd_arr,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,&amp;__pyx_n_s_refraction,0};
    PyObject* values[6] = {0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_22cyTrueRaDec2ApparentAltAz_vect(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_ra_arr, PyArrayObject *__pyx_v_dec_arr, PyArrayObject *__pyx_v_jd_arr, double __pyx_v_lat, double __pyx_v_lon, PyBoolObject *__pyx_v_refraction) {
  int __pyx_v_i;
  double __pyx_v_azim;
  double __pyx_v_elev;
  PyArrayObject *__pyx_v_azim_arr = 0;
  PyArrayObject *__pyx_v_elev_arr = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_azim_arr;
  __Pyx_Buffer __pyx_pybuffer_azim_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dec_arr;
  __Pyx_Buffer __pyx_pybuffer_dec_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_elev_arr;
  __Pyx_Buffer __pyx_pybuffer_elev_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_jd_arr;
  __Pyx_Buffer __pyx_pybuffer_jd_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ra_arr;
  __Pyx_Buffer __pyx_pybuffer_ra_arr;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyTrueRaDec2ApparentAltAz_vect", 0);
  __pyx_pybuffer_azim_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_azim_arr.refcount = 0;
  __pyx_pybuffernd_azim_arr.data = NULL;
  __pyx_pybuffernd_azim_arr.rcbuffer = &amp;__pyx_pybuffer_azim_arr;
  __pyx_pybuffer_elev_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_elev_arr.refcount = 0;
  __pyx_pybuffernd_elev_arr.data = NULL;
  __pyx_pybuffernd_elev_arr.rcbuffer = &amp;__pyx_pybuffer_elev_arr;
  __pyx_pybuffer_ra_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_ra_arr.refcount = 0;
  __pyx_pybuffernd_ra_arr.data = NULL;
  __pyx_pybuffernd_ra_arr.rcbuffer = &amp;__pyx_pybuffer_ra_arr;
  __pyx_pybuffer_dec_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_dec_arr.refcount = 0;
  __pyx_pybuffernd_dec_arr.data = NULL;
  __pyx_pybuffernd_dec_arr.rcbuffer = &amp;__pyx_pybuffer_dec_arr;
  __pyx_pybuffer_jd_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_jd_arr.refcount = 0;
  __pyx_pybuffernd_jd_arr.data = NULL;
  __pyx_pybuffernd_jd_arr.rcbuffer = &amp;__pyx_pybuffer_jd_arr;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_ra_arr, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_ra_arr.diminfo[0].strides = __pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ra_arr.diminfo[0].shape = __pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_dec_arr, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_dec_arr.diminfo[0].strides = __pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_dec_arr.diminfo[0].shape = __pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_jd_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_jd_arr, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_jd_arr.diminfo[0].strides = __pyx_pybuffernd_jd_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_jd_arr.diminfo[0].shape = __pyx_pybuffernd_jd_arr.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_jd_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyTrueRaDec2ApparentAltAz_vect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_jd_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_azim_arr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_elev_arr);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__10 = <span class='py_c_api'>PyTuple_Pack</span>(11, __pyx_n_s_ra_arr, __pyx_n_s_dec_arr, __pyx_n_s_jd_arr, __pyx_n_s_lat, __pyx_n_s_lon, __pyx_n_s_refraction, __pyx_n_s_i, __pyx_n_s_azim, __pyx_n_s_elev, __pyx_n_s_azim_arr, __pyx_n_s_elev_arr);<span class='error_goto'> if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 821, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__10);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3RMS_10Astrometry_11CyFunctions_23cyTrueRaDec2ApparentAltAz_vect, NULL, __pyx_n_s_RMS_Astrometry_CyFunctions);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 821, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_cyTrueRaDec2ApparentAltAz_vect, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__11 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__10, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_RMS_Astrometry_CyFunctions_pyx, __pyx_n_s_cyTrueRaDec2ApparentAltAz_vect, 821, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 821, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0822</span>:     <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">dec_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">jd_arr</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class="cython line score-74" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0823</span>:     <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">refraction</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-74 '>    values[5] = (PyObject *)((PyBoolObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra_arr)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec_arr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz_vect", 0, 5, 6, 1); <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd_arr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz_vect", 0, 5, 6, 2); <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz_vect", 0, 5, 6, 3); <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz_vect", 0, 5, 6, 4); <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_refraction);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyTrueRaDec2ApparentAltAz_vect") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ra_arr = ((PyArrayObject *)values[0]);
    __pyx_v_dec_arr = ((PyArrayObject *)values[1]);
    __pyx_v_jd_arr = ((PyArrayObject *)values[2]);
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 823, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 823, __pyx_L3_error)</span>
    __pyx_v_refraction = ((PyBoolObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyTrueRaDec2ApparentAltAz_vect", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyTrueRaDec2ApparentAltAz_vect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_ra_arr), __pyx_ptype_5numpy_ndarray, 1, "ra_arr", 0))) <span class='error_goto'>__PYX_ERR(0, 821, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_dec_arr), __pyx_ptype_5numpy_ndarray, 1, "dec_arr", 0))) <span class='error_goto'>__PYX_ERR(0, 822, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_jd_arr), __pyx_ptype_5numpy_ndarray, 1, "jd_arr", 0))) <span class='error_goto'>__PYX_ERR(0, 822, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_refraction), __pyx_ptype_7cpython_4bool_bool, 1, "refraction", 0))) <span class='error_goto'>__PYX_ERR(0, 823, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_22cyTrueRaDec2ApparentAltAz_vect(__pyx_self, __pyx_v_ra_arr, __pyx_v_dec_arr, __pyx_v_jd_arr, __pyx_v_lat, __pyx_v_lon, __pyx_v_refraction);
</pre><pre class="cython line score-0">&#xA0;<span class="">0824</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert the true right ascension and declination in J2000 to azimuth (+East of due North) and </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0825</span>: <span class="sd">        altitude in the epoch of date. The correction for refraction is performed.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0826</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0827</span>: <span class="sd">        ra_arr: [ndarray] Right ascension in radians (J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0828</span>: <span class="sd">        dec:_arr [ndarray] Declination in radians (J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0829</span>: <span class="sd">        jd_arr: [ndarray] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0830</span>: <span class="sd">        lat: [float] Latitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0831</span>: <span class="sd">        lon: [float] Longitude in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0832</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0833</span>: <span class="sd">        refraction: [bool] Apply refraction correction. True by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0834</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0835</span>: <span class="sd">        (azim, elev): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0836</span>: <span class="sd">            azim: [ndarray] Azimuth (+east of due north) in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0837</span>: <span class="sd">            elev: [ndarray] Elevation above horizon in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0838</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0839</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0840</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0841</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">azim</span><span class="p">,</span> <span class="nf">elev</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0842</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">azim_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ra_arr</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 842, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 842, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_ra_arr)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_ra_arr));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 842, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 842, __pyx_L1_error)</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_azim_arr = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 842, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_azim_arr.diminfo[0].strides = __pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_azim_arr.diminfo[0].shape = __pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_azim_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0843</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">elev_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ra_arr</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 843, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 843, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_v_ra_arr)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_ra_arr));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 843, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 843, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_elev_arr = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 843, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_elev_arr.diminfo[0].strides = __pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_elev_arr.diminfo[0].shape = __pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_elev_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0844</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0845</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0846</span>:     <span class="c"># Convert all entries</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0847</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ra_arr</span><span class="p">)):</span></pre>
<pre class='cython code score-5 '>  __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_ra_arr));<span class='error_goto'> if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 847, __pyx_L1_error)</span>
  __pyx_t_7 = __pyx_t_6;
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">0848</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0849</span>:         <span class="c"># Compute alt/az</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0850</span>:         <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">cyTrueRaDec2ApparentAltAz</span><span class="p">(</span><span class="n">ra_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dec_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">jd_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = __pyx_v_i;
    __pyx_t_11 = __pyx_v_i;
/* … */
    __pyx_t_13.__pyx_n = 1;
    __pyx_t_13.refraction = __pyx_v_refraction;
    __pyx_t_12 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyTrueRaDec2ApparentAltAz((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_ra_arr.diminfo[0].strides)), (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_dec_arr.diminfo[0].strides)), (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_jd_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_jd_arr.diminfo[0].strides)), __pyx_v_lat, __pyx_v_lon, 0, &amp;__pyx_t_13); 
/* … */
    __pyx_t_14 = __pyx_t_12.f0;
    __pyx_t_15 = __pyx_t_12.f1;
    __pyx_v_azim = __pyx_t_14;
    __pyx_v_elev = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">0851</span>:             <span class="n">refraction</span><span class="o">=</span><span class="n">refraction</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0852</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0853</span>:         <span class="c"># Assign alt/az to array</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0854</span>:         <span class="n">azim_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">azim</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_azim_arr.diminfo[0].strides) = __pyx_v_azim;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0855</span>:         <span class="n">elev_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">elev</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_elev_arr.diminfo[0].strides) = __pyx_v_elev;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0856</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0857</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0858</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">azim_arr</span><span class="p">,</span> <span class="n">elev_arr</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 858, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_azim_arr));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_azim_arr));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_azim_arr));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_elev_arr));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_elev_arr));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_elev_arr));
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0859</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0860</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0861</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0862</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0863</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0864</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">cyaltAz2RADec</span><span class="p">(</span><span class="n">double</span> <span class="n">azim</span><span class="p">,</span> <span class="n">double</span> <span class="n">elev</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_25cyaltAz2RADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_cyaltAz2RADec(double __pyx_v_azim, double __pyx_v_elev, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_lst;
  double __pyx_v_ha;
  double __pyx_v_ra;
  double __pyx_v_dec;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyaltAz2RADec", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_25cyaltAz2RADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_24cyaltAz2RADec[] = " Convert azimuth and altitude in a given time and position on Earth to right ascension and \n        declination. \n\n    Arguments:\n        azim: [float] Azimuth (+east of due north) in radians.\n        elev: [float] Elevation above horizon in radians.\n        jd: [float] Julian date.\n        lat: [float] Latitude of the observer in radians.\n        lon: [float] Longitude of the observer in radians.\n\n    Return:\n        (RA, dec): [tuple]\n            RA: [float] Right ascension (radians).\n            dec: [float] Declination (radians).\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_25cyaltAz2RADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_azim;
  double __pyx_v_elev;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyaltAz2RADec (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_azim,&amp;__pyx_n_s_elev,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_azim)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_elev)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyaltAz2RADec", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyaltAz2RADec", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyaltAz2RADec", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyaltAz2RADec", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyaltAz2RADec") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_azim = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_azim == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
    __pyx_v_elev = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_elev == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyaltAz2RADec", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyaltAz2RADec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_24cyaltAz2RADec(__pyx_self, __pyx_v_azim, __pyx_v_elev, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_24cyaltAz2RADec(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_azim, double __pyx_v_elev, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyaltAz2RADec", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_cyaltAz2RADec(__pyx_v_azim, __pyx_v_elev, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 864, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyaltAz2RADec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0865</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert azimuth and altitude in a given time and position on Earth to right ascension and </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0866</span>: <span class="sd">        declination. </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0867</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0868</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0869</span>: <span class="sd">        azim: [float] Azimuth (+east of due north) in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0870</span>: <span class="sd">        elev: [float] Elevation above horizon in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0871</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0872</span>: <span class="sd">        lat: [float] Latitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0873</span>: <span class="sd">        lon: [float] Longitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0874</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0875</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0876</span>: <span class="sd">        (RA, dec): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0877</span>: <span class="sd">            RA: [float] Right ascension (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0878</span>: <span class="sd">            dec: [float] Declination (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0879</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0880</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0881</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0882</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">lst</span><span class="p">,</span> <span class="nf">ha</span><span class="p">,</span> <span class="nf">ra</span><span class="p">,</span> <span class="nf">dec</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0883</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0884</span>:     <span class="c"># Calculate Local Sidereal Time</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0885</span>:     <span class="n">lst</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">cyjd2LST</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">degrees</span><span class="p">(</span><span class="n">lon</span><span class="p">)))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_lst = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_f_3RMS_10Astrometry_11CyFunctions_cyjd2LST(__pyx_v_jd, __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_lon)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0886</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0887</span>:     <span class="c"># Calculate hour angle</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0888</span>:     <span class="n">ha</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">azim</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">azim</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ha = atan2((-sin(__pyx_v_azim)), ((tan(__pyx_v_elev) * cos(__pyx_v_lat)) - (cos(__pyx_v_azim) * sin(__pyx_v_lat))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0889</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0890</span>:     <span class="c"># Calculate right ascension</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0891</span>:     <span class="n">ra</span> <span class="o">=</span> <span class="p">(</span><span class="n">lst</span> <span class="o">-</span> <span class="n">ha</span> <span class="o">+</span> <span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ra = fmod(((__pyx_v_lst - __pyx_v_ha) + (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi)), (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi));
</pre><pre class="cython line score-0">&#xA0;<span class="">0892</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0893</span>:     <span class="c"># Calculate declination</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0894</span>:     <span class="n">dec</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">azim</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dec = asin(((sin(__pyx_v_lat) * sin(__pyx_v_elev)) + ((cos(__pyx_v_lat) * cos(__pyx_v_elev)) * cos(__pyx_v_azim))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0895</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0896</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1.f0 = __pyx_v_ra;
  __pyx_t_1.f1 = __pyx_v_dec;
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0897</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0898</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0899</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0900</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">cyApparentAltAz2TrueRADec</span><span class="p">(</span><span class="n">double</span> <span class="n">azim</span><span class="p">,</span> <span class="n">double</span> <span class="n">elev</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-8 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_27cyApparentAltAz2TrueRADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_cyApparentAltAz2TrueRADec(double __pyx_v_azim, double __pyx_v_elev, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_3RMS_10Astrometry_11CyFunctions_cyApparentAltAz2TrueRADec *__pyx_optional_args) {
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("RMS.Astrometry.CyFunctions.cyApparentAltAz2TrueRADec", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_27cyApparentAltAz2TrueRADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_26cyApparentAltAz2TrueRADec[] = " Convert the apparent azimuth and altitude in the epoch of date to true (refraction corrected) right \n        ascension and declination in J2000.\n\n    Arguments:\n        azim: [float] Azimuth (+East of due North) in radians (epoch of date).\n        elev: [float] Elevation above horizon in radians (epoch of date).\n        jd: [float] Julian date.\n        lat: [float] Latitude of the observer in radians.\n        lon: [float] Longitude of the observer in radians.\n\n    Keyword arguments:\n        refraction: [bool] Apply refraction correction. True by default.\n\n    Return:\n        (ra, dec): [tuple]\n            ra: [float] Right ascension (radians, J2000).\n            dec: [float] Declination (radians, J2000).\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_27cyApparentAltAz2TrueRADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_azim;
  double __pyx_v_elev;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyBoolObject *__pyx_v_refraction = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyApparentAltAz2TrueRADec (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_azim,&amp;__pyx_n_s_elev,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,&amp;__pyx_n_s_refraction,0};
    PyObject* values[6] = {0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_26cyApparentAltAz2TrueRADec(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_azim, double __pyx_v_elev, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, PyBoolObject *__pyx_v_refraction) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyApparentAltAz2TrueRADec", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.refraction = __pyx_v_refraction;
  __pyx_t_1 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyApparentAltAz2TrueRADec(__pyx_v_azim, __pyx_v_elev, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0, &amp;__pyx_t_2); 
  __pyx_t_3 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 900, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyApparentAltAz2TrueRADec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_opt_args_3RMS_10Astrometry_11CyFunctions_cyApparentAltAz2TrueRADec {
  int __pyx_n;
  PyBoolObject *refraction;
};
</pre><pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0901</span>:     <span class="nb">bool</span> <span class="n">refraction</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>  PyBoolObject *__pyx_v_refraction = ((PyBoolObject *)Py_True);
  double __pyx_v_ra;
  double __pyx_v_dec;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyApparentAltAz2TrueRADec", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_refraction = __pyx_optional_args-&gt;refraction;
    }
  }
/* … */
    values[5] = (PyObject *)((PyBoolObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_azim)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_elev)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec", 0, 5, 6, 1); <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec", 0, 5, 6, 2); <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec", 0, 5, 6, 3); <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec", 0, 5, 6, 4); <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_refraction);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyApparentAltAz2TrueRADec") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_azim = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_azim == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
    __pyx_v_elev = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_elev == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
    __pyx_v_refraction = ((PyBoolObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyApparentAltAz2TrueRADec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_refraction), __pyx_ptype_7cpython_4bool_bool, 1, "refraction", 0))) <span class='error_goto'>__PYX_ERR(0, 901, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_26cyApparentAltAz2TrueRADec(__pyx_self, __pyx_v_azim, __pyx_v_elev, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, __pyx_v_refraction);
</pre><pre class="cython line score-0">&#xA0;<span class="">0902</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert the apparent azimuth and altitude in the epoch of date to true (refraction corrected) right </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0903</span>: <span class="sd">        ascension and declination in J2000.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0904</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0905</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0906</span>: <span class="sd">        azim: [float] Azimuth (+East of due North) in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0907</span>: <span class="sd">        elev: [float] Elevation above horizon in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0908</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0909</span>: <span class="sd">        lat: [float] Latitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0910</span>: <span class="sd">        lon: [float] Longitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0911</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0912</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0913</span>: <span class="sd">        refraction: [bool] Apply refraction correction. True by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0914</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0915</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0916</span>: <span class="sd">        (ra, dec): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0917</span>: <span class="sd">            ra: [float] Right ascension (radians, J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0918</span>: <span class="sd">            dec: [float] Declination (radians, J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0919</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0920</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0921</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0922</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ra</span><span class="p">,</span> <span class="nf">dec</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0923</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0924</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0925</span>:     <span class="c"># Correct elevation for refraction</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0926</span>:     <span class="k">if</span> <span class="n">refraction</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_refraction)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 926, __pyx_L1_error)</span>
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0927</span>:         <span class="n">elev</span> <span class="o">=</span> <span class="n">refractionApparentToTrue</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_elev = __pyx_f_3RMS_10Astrometry_11CyFunctions_refractionApparentToTrue(__pyx_v_elev);
</pre><pre class="cython line score-0">&#xA0;<span class="">0928</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0929</span>:     <span class="c"># Convert to RA/Dec (true, epoch of date)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0930</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">cyaltAz2RADec</span><span class="p">(</span><span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyaltAz2RADec(__pyx_v_azim, __pyx_v_elev, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0);
  __pyx_t_3 = __pyx_t_2.f0;
  __pyx_t_4 = __pyx_t_2.f1;
  __pyx_v_ra = __pyx_t_3;
  __pyx_v_dec = __pyx_t_4;
</pre><pre class="cython line score-0">&#xA0;<span class="">0931</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0932</span>:     <span class="c"># Precess RA/Dec to J2000</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0933</span>:     <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">equatorialCoordPrecession</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">J2000_DAYS</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordPrecession(__pyx_v_jd, __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS, __pyx_v_ra, __pyx_v_dec, 0);
  __pyx_t_4 = __pyx_t_2.f0;
  __pyx_t_3 = __pyx_t_2.f1;
  __pyx_v_ra = __pyx_t_4;
  __pyx_v_dec = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0934</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0935</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0936</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2.f0 = __pyx_v_ra;
  __pyx_t_2.f1 = __pyx_v_dec;
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0937</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0938</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0939</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0940</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0941</span>: <span class="k">def</span> <span class="nf">cyApparentAltAz2TrueRADec_vect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">azim_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">elev_arr</span><span class="p">,</span></pre>
<pre class='cython code score-44 '>/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_29cyApparentAltAz2TrueRADec_vect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_28cyApparentAltAz2TrueRADec_vect[] = " Convert the apparent azimuth and altitude in the epoch of date to true (refraction corrected) right \n        ascension and declination in J2000.\n    Arguments:\n        azim_arr: [float] Azimuth (+East of due North) in radians (epoch of date).\n        elev_arr: [float] Elevation above horizon in radians (epoch of date).\n        jd: [float] Julian date.\n        lat: [float] Latitude of the observer in radians.\n        lon: [float] Longitude of the observer in radians.\n    Keyword arguments:\n        refraction: [bool] Apply refraction correction. True by default.\n    Return:\n        (ra_arr, dec_arr): [tuple]\n            ra: [float] Right ascension (radians, J2000).\n            dec: [float] Declination (radians, J2000).\n    ";
static PyMethodDef __pyx_mdef_3RMS_10Astrometry_11CyFunctions_29cyApparentAltAz2TrueRADec_vect = {"cyApparentAltAz2TrueRADec_vect", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_3RMS_10Astrometry_11CyFunctions_29cyApparentAltAz2TrueRADec_vect, METH_VARARGS|METH_KEYWORDS, __pyx_doc_3RMS_10Astrometry_11CyFunctions_28cyApparentAltAz2TrueRADec_vect};
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_29cyApparentAltAz2TrueRADec_vect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_azim_arr = 0;
  PyArrayObject *__pyx_v_elev_arr = 0;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  PyBoolObject *__pyx_v_refraction = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyApparentAltAz2TrueRADec_vect (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_azim_arr,&amp;__pyx_n_s_elev_arr,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,&amp;__pyx_n_s_refraction,0};
    PyObject* values[6] = {0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_28cyApparentAltAz2TrueRADec_vect(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_azim_arr, PyArrayObject *__pyx_v_elev_arr, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, PyBoolObject *__pyx_v_refraction) {
  int __pyx_v_i;
  double __pyx_v_ra;
  double __pyx_v_dec;
  PyArrayObject *__pyx_v_ra_arr = 0;
  PyArrayObject *__pyx_v_dec_arr = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_azim_arr;
  __Pyx_Buffer __pyx_pybuffer_azim_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dec_arr;
  __Pyx_Buffer __pyx_pybuffer_dec_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_elev_arr;
  __Pyx_Buffer __pyx_pybuffer_elev_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ra_arr;
  __Pyx_Buffer __pyx_pybuffer_ra_arr;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyApparentAltAz2TrueRADec_vect", 0);
  __pyx_pybuffer_ra_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_ra_arr.refcount = 0;
  __pyx_pybuffernd_ra_arr.data = NULL;
  __pyx_pybuffernd_ra_arr.rcbuffer = &amp;__pyx_pybuffer_ra_arr;
  __pyx_pybuffer_dec_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_dec_arr.refcount = 0;
  __pyx_pybuffernd_dec_arr.data = NULL;
  __pyx_pybuffernd_dec_arr.rcbuffer = &amp;__pyx_pybuffer_dec_arr;
  __pyx_pybuffer_azim_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_azim_arr.refcount = 0;
  __pyx_pybuffernd_azim_arr.data = NULL;
  __pyx_pybuffernd_azim_arr.rcbuffer = &amp;__pyx_pybuffer_azim_arr;
  __pyx_pybuffer_elev_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_elev_arr.refcount = 0;
  __pyx_pybuffernd_elev_arr.data = NULL;
  __pyx_pybuffernd_elev_arr.rcbuffer = &amp;__pyx_pybuffer_elev_arr;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_azim_arr, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_azim_arr.diminfo[0].strides = __pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_azim_arr.diminfo[0].shape = __pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_elev_arr, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_elev_arr.diminfo[0].strides = __pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_elev_arr.diminfo[0].shape = __pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyApparentAltAz2TrueRADec_vect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ra_arr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_dec_arr);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__12 = <span class='py_c_api'>PyTuple_Pack</span>(11, __pyx_n_s_azim_arr, __pyx_n_s_elev_arr, __pyx_n_s_jd, __pyx_n_s_lat, __pyx_n_s_lon, __pyx_n_s_refraction, __pyx_n_s_i, __pyx_n_s_ra, __pyx_n_s_dec, __pyx_n_s_ra_arr, __pyx_n_s_dec_arr);<span class='error_goto'> if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 941, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__12);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3RMS_10Astrometry_11CyFunctions_29cyApparentAltAz2TrueRADec_vect, NULL, __pyx_n_s_RMS_Astrometry_CyFunctions);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 941, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_cyApparentAltAz2TrueRADec_vect, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__13 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_RMS_Astrometry_CyFunctions_pyx, __pyx_n_s_cyApparentAltAz2TrueRADec_vect, 941, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 941, __pyx_L1_error)</span>
</pre><pre class="cython line score-82" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0942</span>:     <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">refraction</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-82 '>    values[5] = (PyObject *)((PyBoolObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_azim_arr)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_elev_arr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec_vect", 0, 5, 6, 1); <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec_vect", 0, 5, 6, 2); <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec_vect", 0, 5, 6, 3); <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec_vect", 0, 5, 6, 4); <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_refraction);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyApparentAltAz2TrueRADec_vect") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_azim_arr = ((PyArrayObject *)values[0]);
    __pyx_v_elev_arr = ((PyArrayObject *)values[1]);
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 942, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 942, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 942, __pyx_L3_error)</span>
    __pyx_v_refraction = ((PyBoolObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyApparentAltAz2TrueRADec_vect", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyApparentAltAz2TrueRADec_vect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_azim_arr), __pyx_ptype_5numpy_ndarray, 1, "azim_arr", 0))) <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_elev_arr), __pyx_ptype_5numpy_ndarray, 1, "elev_arr", 0))) <span class='error_goto'>__PYX_ERR(0, 941, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_refraction), __pyx_ptype_7cpython_4bool_bool, 1, "refraction", 0))) <span class='error_goto'>__PYX_ERR(0, 942, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_28cyApparentAltAz2TrueRADec_vect(__pyx_self, __pyx_v_azim_arr, __pyx_v_elev_arr, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, __pyx_v_refraction);
</pre><pre class="cython line score-0">&#xA0;<span class="">0943</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert the apparent azimuth and altitude in the epoch of date to true (refraction corrected) right </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0944</span>: <span class="sd">        ascension and declination in J2000.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0945</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0946</span>: <span class="sd">        azim_arr: [float] Azimuth (+East of due North) in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0947</span>: <span class="sd">        elev_arr: [float] Elevation above horizon in radians (epoch of date).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0948</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0949</span>: <span class="sd">        lat: [float] Latitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0950</span>: <span class="sd">        lon: [float] Longitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0951</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0952</span>: <span class="sd">        refraction: [bool] Apply refraction correction. True by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0953</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0954</span>: <span class="sd">        (ra_arr, dec_arr): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0955</span>: <span class="sd">            ra: [float] Right ascension (radians, J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0956</span>: <span class="sd">            dec: [float] Declination (radians, J2000).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0957</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0958</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0959</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0960</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ra</span><span class="p">,</span> <span class="nf">dec</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0961</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">ra_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">azim_arr</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 961, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 961, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_azim_arr)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_azim_arr));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 961, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 961, __pyx_L1_error)</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_ra_arr = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 961, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_ra_arr.diminfo[0].strides = __pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ra_arr.diminfo[0].shape = __pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_ra_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0962</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">dec_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">azim_arr</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 962, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 962, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_v_azim_arr)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_azim_arr));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 962, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 962, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_dec_arr = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 962, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_dec_arr.diminfo[0].strides = __pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_dec_arr.diminfo[0].shape = __pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_dec_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0963</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0964</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0965</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">azim_arr</span><span class="p">)):</span></pre>
<pre class='cython code score-5 '>  __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_azim_arr));<span class='error_goto'> if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 965, __pyx_L1_error)</span>
  __pyx_t_7 = __pyx_t_6;
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">0966</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0967</span>:         <span class="c"># Compute RA/Dec</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0968</span>:         <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">cyApparentAltAz2TrueRADec</span><span class="p">(</span><span class="n">azim_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">elev_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = __pyx_v_i;
/* … */
    __pyx_t_12.__pyx_n = 1;
    __pyx_t_12.refraction = __pyx_v_refraction;
    __pyx_t_11 = __pyx_f_3RMS_10Astrometry_11CyFunctions_cyApparentAltAz2TrueRADec((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_azim_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_azim_arr.diminfo[0].strides)), (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_elev_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_elev_arr.diminfo[0].strides)), __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0, &amp;__pyx_t_12); 
/* … */
    __pyx_t_13 = __pyx_t_11.f0;
    __pyx_t_14 = __pyx_t_11.f1;
    __pyx_v_ra = __pyx_t_13;
    __pyx_v_dec = __pyx_t_14;
</pre><pre class="cython line score-0">&#xA0;<span class="">0969</span>:             <span class="n">refraction</span><span class="o">=</span><span class="n">refraction</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0970</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0971</span>:         <span class="n">ra_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ra</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_ra_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_ra_arr.diminfo[0].strides) = __pyx_v_ra;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0972</span>:         <span class="n">dec_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dec</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_dec_arr.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_dec_arr.diminfo[0].strides) = __pyx_v_dec;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0973</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0974</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0975</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">ra_arr</span><span class="p">,</span> <span class="n">dec_arr</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 975, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_ra_arr));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_ra_arr));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_ra_arr));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_dec_arr));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_dec_arr));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_dec_arr));
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0976</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0977</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0978</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0979</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0980</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0981</span>: <span class="k">cpdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="kt">np</span>.<span class="nf">float64_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">raDecToCartesian</span><span class="p">(</span><span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec</span><span class="p">):</span></pre>
<pre class='cython code score-55 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_31raDecToCartesian(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyArrayObject *__pyx_f_3RMS_10Astrometry_11CyFunctions_raDecToCartesian(double __pyx_v_ra, double __pyx_v_dec, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("raDecToCartesian", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.raDecToCartesian", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_31raDecToCartesian(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_30raDecToCartesian[] = " Convert RA, Dec to Cartesian coordinates.\n    \n    Arguments:\n        ra: [double] Right ascension in radians.\n        dec: [double] Declination in radians.\n\n    Return:\n        [np.ndarray] A 3D vector [x, y, z] representing the position in Cartesian coordinates.\n            The vector is normalized (unit vector).\n\n    Notes:\n        The coordinate system follows the convention:\n        x-axis points to RA = 0, Dec = 0\n        y-axis points to RA = 90\302\260, Dec = 0\n        z-axis points to the North Celestial Pole (Dec = 90\302\260)\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_31raDecToCartesian(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_ra;
  double __pyx_v_dec;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("raDecToCartesian (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra,&amp;__pyx_n_s_dec,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("raDecToCartesian", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 981, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "raDecToCartesian") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 981, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_ra = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_ra == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 981, __pyx_L3_error)</span>
    __pyx_v_dec = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dec == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 981, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("raDecToCartesian", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 981, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.raDecToCartesian", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_30raDecToCartesian(__pyx_self, __pyx_v_ra, __pyx_v_dec);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_30raDecToCartesian(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra, double __pyx_v_dec) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("raDecToCartesian", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = ((PyObject *)__pyx_f_3RMS_10Astrometry_11CyFunctions_raDecToCartesian(__pyx_v_ra, __pyx_v_dec, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 981, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.raDecToCartesian", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0982</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert RA, Dec to Cartesian coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0983</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0984</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0985</span>: <span class="sd">        ra: [double] Right ascension in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0986</span>: <span class="sd">        dec: [double] Declination in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0987</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0988</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0989</span>: <span class="sd">        [np.ndarray] A 3D vector [x, y, z] representing the position in Cartesian coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0990</span>: <span class="sd">            The vector is normalized (unit vector).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0991</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0992</span>: <span class="sd">    Notes:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0993</span>: <span class="sd">        The coordinate system follows the convention:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0994</span>: <span class="sd">        x-axis points to RA = 0, Dec = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0995</span>: <span class="sd">        y-axis points to RA = 90°, Dec = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0996</span>: <span class="sd">        z-axis points to the North Celestial Pole (Dec = 90°)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0997</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0998</span>:     <span class="k">cdef</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0999</span>:         <span class="n">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_x = (cos(__pyx_v_dec) * cos(__pyx_v_ra));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1000</span>:         <span class="n">double</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_y = (cos(__pyx_v_dec) * sin(__pyx_v_ra));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1001</span>:         <span class="n">double</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_z = sin(__pyx_v_dec);
</pre><pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1002</span>:     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></pre>
<pre class='cython code score-55 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1002, __pyx_L1_error)</span>
  __pyx_r = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1004</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1005</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1006</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1007</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1008</span>: <span class="k">cpdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">cartesianToRaDec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">vec</span><span class="p">):</span></pre>
<pre class='cython code score-30 '>static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_33cartesianToRaDec(PyObject *__pyx_self, PyObject *__pyx_v_vec); /*proto*/
static __pyx_ctuple_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_cartesianToRaDec(PyArrayObject *__pyx_v_vec, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  double __pyx_v_distance;
  double __pyx_v_ra;
  double __pyx_v_dec;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_vec;
  __Pyx_Buffer __pyx_pybuffer_vec;
  __pyx_ctuple_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cartesianToRaDec", 0);
  __pyx_pybuffer_vec.pybuffer.buf = NULL;
  __pyx_pybuffer_vec.refcount = 0;
  __pyx_pybuffernd_vec.data = NULL;
  __pyx_pybuffernd_vec.rcbuffer = &amp;__pyx_pybuffer_vec;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_vec, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1008, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_vec.diminfo[0].strides = __pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_vec.diminfo[0].shape = __pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("RMS.Astrometry.CyFunctions.cartesianToRaDec", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_33cartesianToRaDec(PyObject *__pyx_self, PyObject *__pyx_v_vec); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_32cartesianToRaDec[] = " Convert Cartesian coordinates to RA, Dec.\n\n    Arguments:\n        vec: [np.ndarray] A 3D vector [x, y, z] representing the position in Cartesian coordinates.\n\n    Return:\n        (ra, dec): [tuple]\n            ra: [double] Right ascension in radians, range [0, 2\317\200).\n            dec: [double] Declination in radians, range [-\317\200/2, \317\200/2].\n\n    Notes:\n        - The function returns (0, 0) if the input vector is [0, 0, 0] to avoid division by zero.\n        - The returned RA is normalized to be within [0, 2\317\200).\n        - The coordinate system assumes:\n          x-axis points to RA = 0, Dec = 0\n          y-axis points to RA = 90\302\260, Dec = 0\n          z-axis points to the North Celestial Pole (Dec = 90\302\260)\n    ";
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_33cartesianToRaDec(PyObject *__pyx_self, PyObject *__pyx_v_vec) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cartesianToRaDec (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_vec), __pyx_ptype_5numpy_ndarray, 1, "vec", 0))) <span class='error_goto'>__PYX_ERR(0, 1008, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_32cartesianToRaDec(__pyx_self, ((PyArrayObject *)__pyx_v_vec));
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_32cartesianToRaDec(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_vec) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_vec;
  __Pyx_Buffer __pyx_pybuffer_vec;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cartesianToRaDec", 0);
  __pyx_pybuffer_vec.pybuffer.buf = NULL;
  __pyx_pybuffer_vec.refcount = 0;
  __pyx_pybuffernd_vec.data = NULL;
  __pyx_pybuffernd_vec.rcbuffer = &amp;__pyx_pybuffer_vec;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_vec, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1008, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_vec.diminfo[0].strides = __pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_vec.diminfo[0].shape = __pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer.shape[0];
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_f_3RMS_10Astrometry_11CyFunctions_cartesianToRaDec(__pyx_v_vec, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1008, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cartesianToRaDec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1009</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert Cartesian coordinates to RA, Dec.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1010</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1011</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1012</span>: <span class="sd">        vec: [np.ndarray] A 3D vector [x, y, z] representing the position in Cartesian coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1013</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1014</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1015</span>: <span class="sd">        (ra, dec): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1016</span>: <span class="sd">            ra: [double] Right ascension in radians, range [0, 2π).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1017</span>: <span class="sd">            dec: [double] Declination in radians, range [-π/2, π/2].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1018</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1019</span>: <span class="sd">    Notes:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1020</span>: <span class="sd">        - The function returns (0, 0) if the input vector is [0, 0, 0] to avoid division by zero.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1021</span>: <span class="sd">        - The returned RA is normalized to be within [0, 2π).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1022</span>: <span class="sd">        - The coordinate system assumes:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1023</span>: <span class="sd">          x-axis points to RA = 0, Dec = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1024</span>: <span class="sd">          y-axis points to RA = 90°, Dec = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1025</span>: <span class="sd">          z-axis points to the North Celestial Pole (Dec = 90°)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1026</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1027</span>:     <span class="k">cdef</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1028</span>:         <span class="n">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_v_x = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer.buf, __pyx_t_1, __pyx_pybuffernd_vec.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1029</span>:         <span class="n">double</span> <span class="n">y</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1;
  __pyx_v_y = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer.buf, __pyx_t_1, __pyx_pybuffernd_vec.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1030</span>:         <span class="n">double</span> <span class="n">z</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 2;
  __pyx_v_z = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_vec.rcbuffer-&gt;pybuffer.buf, __pyx_t_1, __pyx_pybuffernd_vec.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1031</span>:         <span class="n">double</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">hypot</span><span class="p">(</span><span class="n">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_distance = hypot(hypot(__pyx_v_x, __pyx_v_y), __pyx_v_z);
</pre><pre class="cython line score-0">&#xA0;<span class="">1032</span>:         <span class="n">double</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1033</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1034</span>:     <span class="k">if</span> <span class="n">distance</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_distance == 0.0) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1035</span>:         <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_3.f0 = 0.0;
    __pyx_t_3.f1 = 0.0;
    __pyx_r = __pyx_t_3;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1036</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1037</span>:     <span class="n">ra</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ra = atan2(__pyx_v_y, __pyx_v_x);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1038</span>:     <span class="n">dec</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">distance</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  if (unlikely(__pyx_v_distance == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 1038, __pyx_L1_error)</span>
  }
  __pyx_v_dec = asin((__pyx_v_z / __pyx_v_distance));
</pre><pre class="cython line score-0">&#xA0;<span class="">1039</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1040</span>:     <span class="c"># Normalize RA to be within [0, 2π)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1041</span>:     <span class="n">ra</span> <span class="o">=</span> <span class="n">fmod</span><span class="p">(</span><span class="n">ra</span> <span class="o">+</span> <span class="mf">2</span><span class="o">*</span><span class="n">M_PI</span><span class="p">,</span> <span class="mf">2</span><span class="o">*</span><span class="n">M_PI</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ra = fmod((__pyx_v_ra + (2.0 * M_PI)), (2.0 * M_PI));
</pre><pre class="cython line score-0">&#xA0;<span class="">1042</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1043</span>:     <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3.f0 = __pyx_v_ra;
  __pyx_t_3.f1 = __pyx_v_dec;
  __pyx_r = __pyx_t_3;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1044</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1045</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1046</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1047</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1048</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1049</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1050</span>: <span class="k">def</span> <span class="nf">cyraDecToXY</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">ra_data</span><span class="p">,</span></pre>
<pre class='cython code score-56 '>/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_35cyraDecToXY(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_34cyraDecToXY[] = " Convert RA, Dec to distortion corrected image coordinates. \n\n    Arguments:\n        RA_data: [ndarray] Array of right ascensions (degrees).\n        dec_data: [ndarray] Array of declinations (degrees).\n        jd: [float] Julian date.\n        lat: [float] Latitude of station in degrees.\n        lon: [float] Longitude of station in degrees.\n        x_res: [int] X resolution of the camera.\n        y_res: [int] Y resolution of the camera.\n        h0: [float] Reference hour angle (deg).\n        jd_ref: [float] Reference Julian date of plate solution.\n        ra_ref: [float] Reference right ascension of the image centre (degrees).\n        dec_ref: [float] Reference declination of the image centre (degrees).\n        pos_angle_ref: [float] Rotation from the celestial meridian (degrees).\n        pix_scale: [float] Image scale (px/deg).\n        x_poly_rev: [ndarray float] Distortion polynomial in X direction for reverse mapping.\n        y_poly_rev: [ndarray float] Distortion polynomial in Y direction for reverse mapping.\n        dist_type: [str] Distortion type. Can be: poly3+radial, radial3, radial4, or radial5.\n        \n    Keyword arguments:\n        refraction: [bool] Apply refraction correction. True by default.\n        equal_aspect: [bool] Force the X/Y aspect ratio to be equal. Used only for radial distortion.             False by default.\n        force_distortion_centre: [bool] Force the distortion centre to the image centre. False by default.\n        asymmetry_corr: [bool] Correct the distortion for asymmetry. Only for radial distortion. True by\n            default.\n    \n    Return:\n        (x, y): [tuple of ndarrays] Image X and Y coordinates.\n    ";
static PyMethodDef __pyx_mdef_3RMS_10Astrometry_11CyFunctions_35cyraDecToXY = {"cyraDecToXY", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_3RMS_10Astrometry_11CyFunctions_35cyraDecToXY, METH_VARARGS|METH_KEYWORDS, __pyx_doc_3RMS_10Astrometry_11CyFunctions_34cyraDecToXY};
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_35cyraDecToXY(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_ra_data = 0;
  PyArrayObject *__pyx_v_dec_data = 0;
  double __pyx_v_jd;
  double __pyx_v_lat;
  double __pyx_v_lon;
  double __pyx_v_x_res;
  double __pyx_v_y_res;
  double __pyx_v_h0;
  double __pyx_v_jd_ref;
  double __pyx_v_ra_ref;
  double __pyx_v_dec_ref;
  double __pyx_v_pos_angle_ref;
  double __pyx_v_pix_scale;
  PyArrayObject *__pyx_v_x_poly_rev = 0;
  PyArrayObject *__pyx_v_y_poly_rev = 0;
  PyObject *__pyx_v_dist_type = 0;
  PyBoolObject *__pyx_v_refraction = 0;
  PyBoolObject *__pyx_v_equal_aspect = 0;
  PyBoolObject *__pyx_v_force_distortion_centre = 0;
  PyBoolObject *__pyx_v_asymmetry_corr = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyraDecToXY (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ra_data,&amp;__pyx_n_s_dec_data,&amp;__pyx_n_s_jd,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,&amp;__pyx_n_s_x_res,&amp;__pyx_n_s_y_res,&amp;__pyx_n_s_h0,&amp;__pyx_n_s_jd_ref,&amp;__pyx_n_s_ra_ref,&amp;__pyx_n_s_dec_ref,&amp;__pyx_n_s_pos_angle_ref,&amp;__pyx_n_s_pix_scale,&amp;__pyx_n_s_x_poly_rev,&amp;__pyx_n_s_y_poly_rev,&amp;__pyx_n_s_dist_type,&amp;__pyx_n_s_refraction,&amp;__pyx_n_s_equal_aspect,&amp;__pyx_n_s_force_distortion_centre,&amp;__pyx_n_s_asymmetry_corr,0};
    PyObject* values[20] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_34cyraDecToXY(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_ra_data, PyArrayObject *__pyx_v_dec_data, double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, double __pyx_v_x_res, double __pyx_v_y_res, double __pyx_v_h0, double __pyx_v_jd_ref, double __pyx_v_ra_ref, double __pyx_v_dec_ref, double __pyx_v_pos_angle_ref, double __pyx_v_pix_scale, PyArrayObject *__pyx_v_x_poly_rev, PyArrayObject *__pyx_v_y_poly_rev, PyObject *__pyx_v_dist_type, PyBoolObject *__pyx_v_refraction, PyBoolObject *__pyx_v_equal_aspect, PyBoolObject *__pyx_v_force_distortion_centre, PyBoolObject *__pyx_v_asymmetry_corr) {
  int __pyx_v_i;
  double __pyx_v_ra_centre;
  double __pyx_v_dec_centre;
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_radius;
  double __pyx_v_sin_ang;
  double __pyx_v_cos_ang;
  double __pyx_v_theta;
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_r;
  double __pyx_v_dx;
  double __pyx_v_dy;
  double __pyx_v_x_img;
  double __pyx_v_y_img;
  double __pyx_v_r_corr;
  double __pyx_v_r_scale;
  double __pyx_v_x0;
  double __pyx_v_y0;
  double __pyx_v_xy;
  double __pyx_v_a1;
  double __pyx_v_a2;
  double __pyx_v_k1;
  double __pyx_v_k2;
  double __pyx_v_k3;
  double __pyx_v_k4;
  int __pyx_v_index_offset;
  PyArrayObject *__pyx_v_x_array = 0;
  PyArrayObject *__pyx_v_y_array = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dec_data;
  __Pyx_Buffer __pyx_pybuffer_dec_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ra_data;
  __Pyx_Buffer __pyx_pybuffer_ra_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x_array;
  __Pyx_Buffer __pyx_pybuffer_x_array;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x_poly_rev;
  __Pyx_Buffer __pyx_pybuffer_x_poly_rev;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_y_array;
  __Pyx_Buffer __pyx_pybuffer_y_array;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_y_poly_rev;
  __Pyx_Buffer __pyx_pybuffer_y_poly_rev;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyraDecToXY", 0);
  __pyx_pybuffer_x_array.pybuffer.buf = NULL;
  __pyx_pybuffer_x_array.refcount = 0;
  __pyx_pybuffernd_x_array.data = NULL;
  __pyx_pybuffernd_x_array.rcbuffer = &amp;__pyx_pybuffer_x_array;
  __pyx_pybuffer_y_array.pybuffer.buf = NULL;
  __pyx_pybuffer_y_array.refcount = 0;
  __pyx_pybuffernd_y_array.data = NULL;
  __pyx_pybuffernd_y_array.rcbuffer = &amp;__pyx_pybuffer_y_array;
  __pyx_pybuffer_ra_data.pybuffer.buf = NULL;
  __pyx_pybuffer_ra_data.refcount = 0;
  __pyx_pybuffernd_ra_data.data = NULL;
  __pyx_pybuffernd_ra_data.rcbuffer = &amp;__pyx_pybuffer_ra_data;
  __pyx_pybuffer_dec_data.pybuffer.buf = NULL;
  __pyx_pybuffer_dec_data.refcount = 0;
  __pyx_pybuffernd_dec_data.data = NULL;
  __pyx_pybuffernd_dec_data.rcbuffer = &amp;__pyx_pybuffer_dec_data;
  __pyx_pybuffer_x_poly_rev.pybuffer.buf = NULL;
  __pyx_pybuffer_x_poly_rev.refcount = 0;
  __pyx_pybuffernd_x_poly_rev.data = NULL;
  __pyx_pybuffernd_x_poly_rev.rcbuffer = &amp;__pyx_pybuffer_x_poly_rev;
  __pyx_pybuffer_y_poly_rev.pybuffer.buf = NULL;
  __pyx_pybuffer_y_poly_rev.refcount = 0;
  __pyx_pybuffernd_y_poly_rev.data = NULL;
  __pyx_pybuffernd_y_poly_rev.rcbuffer = &amp;__pyx_pybuffer_y_poly_rev;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_ra_data, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_ra_data.diminfo[0].strides = __pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ra_data.diminfo[0].shape = __pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_dec_data, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_dec_data.diminfo[0].strides = __pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_dec_data.diminfo[0].shape = __pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x_poly_rev, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x_poly_rev.diminfo[0].strides = __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x_poly_rev.diminfo[0].shape = __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_y_poly_rev, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_y_poly_rev.diminfo[0].strides = __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_y_poly_rev.diminfo[0].shape = __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_array.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_array.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyraDecToXY", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_array.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_array.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x_array);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_y_array);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__14 = <span class='py_c_api'>PyTuple_Pack</span>(51, __pyx_n_s_ra_data, __pyx_n_s_dec_data, __pyx_n_s_jd, __pyx_n_s_lat, __pyx_n_s_lon, __pyx_n_s_x_res, __pyx_n_s_y_res, __pyx_n_s_h0, __pyx_n_s_jd_ref, __pyx_n_s_ra_ref, __pyx_n_s_dec_ref, __pyx_n_s_pos_angle_ref, __pyx_n_s_pix_scale, __pyx_n_s_x_poly_rev, __pyx_n_s_y_poly_rev, __pyx_n_s_dist_type, __pyx_n_s_refraction, __pyx_n_s_equal_aspect, __pyx_n_s_force_distortion_centre, __pyx_n_s_asymmetry_corr, __pyx_n_s_i, __pyx_n_s_ra_centre, __pyx_n_s_dec_centre, __pyx_n_s_ra, __pyx_n_s_dec, __pyx_n_s_radius, __pyx_n_s_sin_ang, __pyx_n_s_cos_ang, __pyx_n_s_theta, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_r, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_x_img, __pyx_n_s_y_img, __pyx_n_s_r_corr, __pyx_n_s_r_scale, __pyx_n_s_x0, __pyx_n_s_y0, __pyx_n_s_xy, __pyx_n_s_a1, __pyx_n_s_a2, __pyx_n_s_k1, __pyx_n_s_k2, __pyx_n_s_k3, __pyx_n_s_k4, __pyx_n_s_k5, __pyx_n_s_index_offset, __pyx_n_s_x_array, __pyx_n_s_y_array);<span class='error_goto'> if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 1050, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__14);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3RMS_10Astrometry_11CyFunctions_35cyraDecToXY, NULL, __pyx_n_s_RMS_Astrometry_CyFunctions);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_cyraDecToXY, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__15 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(20, 0, 51, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_RMS_Astrometry_CyFunctions_pyx, __pyx_n_s_cyraDecToXY, 1050, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 1050, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1051</span>:     <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">dec_data</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_res</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1052</span>:     <span class="n">double</span> <span class="n">y_res</span><span class="p">,</span> <span class="n">double</span> <span class="n">h0</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">ra_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_angle_ref</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1053</span>:     <span class="n">double</span> <span class="n">pix_scale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x_poly_rev</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1054</span>:     <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">y_poly_rev</span><span class="p">,</span> <span class="nb">str</span> <span class="n">dist_type</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">refraction</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">equal_aspect</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    values[16] = (PyObject *)((PyBoolObject *)Py_True);
    values[17] = (PyObject *)((PyBoolObject *)Py_False);
</pre><pre class="cython line score-252" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1055</span>:     <span class="nb">bool</span> <span class="n">force_distortion_centre</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">asymmetry_corr</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-252 '>    values[18] = (PyObject *)((PyBoolObject *)Py_False);
    values[19] = (PyObject *)((PyBoolObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra_data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec_data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 1); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 2); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 3); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 4); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x_res)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 5); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_y_res)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 6); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_h0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 7); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 8); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 9); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 10); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pos_angle_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 11); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pix_scale)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 12); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x_poly_rev)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 13); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_y_poly_rev)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 14); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dist_type)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, 15); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_refraction);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equal_aspect);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_force_distortion_centre);
          if (value) { values[18] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_asymmetry_corr);
          if (value) { values[19] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyraDecToXY") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ra_data = ((PyArrayObject *)values[0]);
    __pyx_v_dec_data = ((PyArrayObject *)values[1]);
    __pyx_v_jd = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_jd == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1051, __pyx_L3_error)</span>
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1051, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1051, __pyx_L3_error)</span>
    __pyx_v_x_res = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_x_res == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1051, __pyx_L3_error)</span>
    __pyx_v_y_res = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_y_res == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1052, __pyx_L3_error)</span>
    __pyx_v_h0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_h0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1052, __pyx_L3_error)</span>
    __pyx_v_jd_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_jd_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1052, __pyx_L3_error)</span>
    __pyx_v_ra_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_ra_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1052, __pyx_L3_error)</span>
    __pyx_v_dec_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_dec_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1052, __pyx_L3_error)</span>
    __pyx_v_pos_angle_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_pos_angle_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1052, __pyx_L3_error)</span>
    __pyx_v_pix_scale = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_pix_scale == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1053, __pyx_L3_error)</span>
    __pyx_v_x_poly_rev = ((PyArrayObject *)values[13]);
    __pyx_v_y_poly_rev = ((PyArrayObject *)values[14]);
    __pyx_v_dist_type = ((PyObject*)values[15]);
    __pyx_v_refraction = ((PyBoolObject *)values[16]);
    __pyx_v_equal_aspect = ((PyBoolObject *)values[17]);
    __pyx_v_force_distortion_centre = ((PyBoolObject *)values[18]);
    __pyx_v_asymmetry_corr = ((PyBoolObject *)values[19]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyraDecToXY", 0, 16, 20, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyraDecToXY", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_ra_data), __pyx_ptype_5numpy_ndarray, 1, "ra_data", 0))) <span class='error_goto'>__PYX_ERR(0, 1050, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_dec_data), __pyx_ptype_5numpy_ndarray, 1, "dec_data", 0))) <span class='error_goto'>__PYX_ERR(0, 1051, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x_poly_rev), __pyx_ptype_5numpy_ndarray, 1, "x_poly_rev", 0))) <span class='error_goto'>__PYX_ERR(0, 1053, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_y_poly_rev), __pyx_ptype_5numpy_ndarray, 1, "y_poly_rev", 0))) <span class='error_goto'>__PYX_ERR(0, 1054, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_dist_type), (&amp;PyUnicode_Type), 1, "dist_type", 1))) <span class='error_goto'>__PYX_ERR(0, 1054, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_refraction), __pyx_ptype_7cpython_4bool_bool, 1, "refraction", 0))) <span class='error_goto'>__PYX_ERR(0, 1054, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_equal_aspect), __pyx_ptype_7cpython_4bool_bool, 1, "equal_aspect", 0))) <span class='error_goto'>__PYX_ERR(0, 1054, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_force_distortion_centre), __pyx_ptype_7cpython_4bool_bool, 1, "force_distortion_centre", 0))) <span class='error_goto'>__PYX_ERR(0, 1055, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_asymmetry_corr), __pyx_ptype_7cpython_4bool_bool, 1, "asymmetry_corr", 0))) <span class='error_goto'>__PYX_ERR(0, 1055, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_34cyraDecToXY(__pyx_self, __pyx_v_ra_data, __pyx_v_dec_data, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, __pyx_v_x_res, __pyx_v_y_res, __pyx_v_h0, __pyx_v_jd_ref, __pyx_v_ra_ref, __pyx_v_dec_ref, __pyx_v_pos_angle_ref, __pyx_v_pix_scale, __pyx_v_x_poly_rev, __pyx_v_y_poly_rev, __pyx_v_dist_type, __pyx_v_refraction, __pyx_v_equal_aspect, __pyx_v_force_distortion_centre, __pyx_v_asymmetry_corr);
</pre><pre class="cython line score-0">&#xA0;<span class="">1056</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert RA, Dec to distortion corrected image coordinates. </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1057</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1058</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1059</span>: <span class="sd">        RA_data: [ndarray] Array of right ascensions (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1060</span>: <span class="sd">        dec_data: [ndarray] Array of declinations (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1061</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1062</span>: <span class="sd">        lat: [float] Latitude of station in degrees.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1063</span>: <span class="sd">        lon: [float] Longitude of station in degrees.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1064</span>: <span class="sd">        x_res: [int] X resolution of the camera.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1065</span>: <span class="sd">        y_res: [int] Y resolution of the camera.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1066</span>: <span class="sd">        h0: [float] Reference hour angle (deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1067</span>: <span class="sd">        jd_ref: [float] Reference Julian date of plate solution.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1068</span>: <span class="sd">        ra_ref: [float] Reference right ascension of the image centre (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1069</span>: <span class="sd">        dec_ref: [float] Reference declination of the image centre (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1070</span>: <span class="sd">        pos_angle_ref: [float] Rotation from the celestial meridian (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1071</span>: <span class="sd">        pix_scale: [float] Image scale (px/deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1072</span>: <span class="sd">        x_poly_rev: [ndarray float] Distortion polynomial in X direction for reverse mapping.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1073</span>: <span class="sd">        y_poly_rev: [ndarray float] Distortion polynomial in Y direction for reverse mapping.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1074</span>: <span class="sd">        dist_type: [str] Distortion type. Can be: poly3+radial, radial3, radial4, or radial5.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1075</span>: <span class="sd">        </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1076</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1077</span>: <span class="sd">        refraction: [bool] Apply refraction correction. True by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1078</span>: <span class="sd">        equal_aspect: [bool] Force the X/Y aspect ratio to be equal. Used only for radial distortion. \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1079</span>: <span class="sd">            False by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1080</span>: <span class="sd">        force_distortion_centre: [bool] Force the distortion centre to the image centre. False by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1081</span>: <span class="sd">        asymmetry_corr: [bool] Correct the distortion for asymmetry. Only for radial distortion. True by</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1082</span>: <span class="sd">            default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1083</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1084</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1085</span>: <span class="sd">        (x, y): [tuple of ndarrays] Image X and Y coordinates.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1086</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1087</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1088</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1089</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ra_centre</span><span class="p">,</span> <span class="nf">dec_centre</span><span class="p">,</span> <span class="nf">ra</span><span class="p">,</span> <span class="nf">dec</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1090</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">radius</span><span class="p">,</span> <span class="nf">sin_ang</span><span class="p">,</span> <span class="nf">cos_ang</span><span class="p">,</span> <span class="nf">theta</span><span class="p">,</span> <span class="nf">x</span><span class="p">,</span> <span class="nf">y</span><span class="p">,</span> <span class="nf">r</span><span class="p">,</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">x_img</span><span class="p">,</span> <span class="nf">y_img</span><span class="p">,</span> <span class="nf">r_corr</span><span class="p">,</span> <span class="nf">r_scale</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1091</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">x0</span><span class="p">,</span> <span class="nf">y0</span><span class="p">,</span> <span class="nf">xy</span><span class="p">,</span> <span class="nf">a1</span><span class="p">,</span> <span class="nf">a2</span><span class="p">,</span> <span class="nf">k1</span><span class="p">,</span> <span class="nf">k2</span><span class="p">,</span> <span class="nf">k3</span><span class="p">,</span> <span class="nf">k4</span><span class="p">,</span> <span class="nf">k5</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1092</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">index_offset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1093</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1094</span>:     <span class="c"># Init output arrays</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1095</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ra_data</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1095, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1095, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_ra_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_ra_data));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1095, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1095, __pyx_L1_error)</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_x_array = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_x_array.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1095, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_x_array.diminfo[0].strides = __pyx_pybuffernd_x_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x_array.diminfo[0].shape = __pyx_pybuffernd_x_array.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_x_array = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1096</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">y_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ra_data</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1096, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1096, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_v_ra_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_ra_data));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1096, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1096, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_y_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_y_array = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_y_array.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1096, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_y_array.diminfo[0].strides = __pyx_pybuffernd_y_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_y_array.diminfo[0].shape = __pyx_pybuffernd_y_array.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_y_array = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1097</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1098</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1099</span>:     <span class="c"># Correct the pointing for precession (output in radians)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1100</span>:     <span class="n">ra_centre</span><span class="p">,</span> <span class="n">dec_centre</span><span class="p">,</span> <span class="n">pos_angle_ref</span> <span class="o">=</span> <span class="n">pointingCorrection</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7.__pyx_n = 1;
  __pyx_t_7.refraction = __pyx_v_refraction;
  __pyx_t_6 = __pyx_f_3RMS_10Astrometry_11CyFunctions_pointingCorrection(__pyx_v_jd, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lat), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lon), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_h0), __pyx_v_jd_ref, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_ra_ref), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_dec_ref), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_pos_angle_ref), &amp;__pyx_t_7); 
  __pyx_t_8 = __pyx_t_6.f0;
  __pyx_t_9 = __pyx_t_6.f1;
  __pyx_t_10 = __pyx_t_6.f2;
  __pyx_v_ra_centre = __pyx_t_8;
  __pyx_v_dec_centre = __pyx_t_9;
  __pyx_v_pos_angle_ref = __pyx_t_10;
</pre><pre class="cython line score-0">&#xA0;<span class="">1101</span>:             <span class="n">jd</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1102</span>:             <span class="n">radians</span><span class="p">(</span><span class="n">h0</span><span class="p">),</span> <span class="n">jd_ref</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">ra_ref</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">dec_ref</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">pos_angle_ref</span><span class="p">),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1103</span>:             <span class="n">refraction</span><span class="o">=</span><span class="n">refraction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1104</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1105</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1106</span>:     <span class="c"># # Compute the current RA of the FOV centre by adding the difference in between the current and the </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1107</span>:     <span class="c"># #   reference hour angle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1108</span>:     <span class="c"># ra_centre = radians((ra_ref + cyjd2LST(jd, 0) - h0 + 360)%360)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1109</span>:     <span class="c"># dec_centre = radians(dec_ref)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1110</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1111</span>:     <span class="c"># # Correct the reference FOV centre for refraction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1112</span>:     <span class="c"># if refraction:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1113</span>:     <span class="c">#     ra_centre, dec_centre = eqRefractionTrueToApparent(ra_centre, dec_centre, jd, radians(lat), \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1114</span>:     <span class="c">#         radians(lon))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1115</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1116</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1117</span>:     <span class="c"># # Precess the FOV centre and rotation angle to J2000 (otherwise the FOV centre drifts with time)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1118</span>:     <span class="c"># ra_centre_j2000, dec_centre_j2000, pos_angle_ref_corr = equatorialCoordAndRotPrecession(jd, J2000_DAYS,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1119</span>:     <span class="c">#                                                         ra_centre, dec_centre, radians(pos_angle_ref))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1120</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1121</span>:     <span class="c"># # The position angle needs to be corrected for precession, otherwise the FOV rotates with time</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1122</span>:     <span class="c"># # Applying the difference in RA between the current and the reference epoch fixes the position angle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1123</span>:     <span class="c"># pos_angle_ref_corr = degrees(pos_angle_ref_corr)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1125</span>:     <span class="c"># ra_centre = ra_centre_j2000</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1126</span>:     <span class="c"># dec_centre = dec_centre_j2000</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1127</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1128</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1129</span>:     <span class="c"># If the radial distortion is used, unpack radial parameters</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1130</span>:     <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;radial&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>  if (unlikely(__pyx_v_dist_type == Py_None)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "startswith");
    <span class='error_goto'>__PYX_ERR(0, 1130, __pyx_L1_error)</span>
  }
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_n_u_radial, 0, PY_SSIZE_T_MAX, -1);<span class='error_goto'> if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1130, __pyx_L1_error)</span>
  if ((__pyx_t_11 != 0)) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1131</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1132</span>:         <span class="c"># Index offset for reading distortion parameters. May change as equal aspect or asymmetry correction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1133</span>:         <span class="c">#   is toggled on/off</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1134</span>:         <span class="n">index_offset</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_index_offset = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1135</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1136</span>:         <span class="c"># Force the distortion centre to the image centre</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1137</span>:         <span class="k">if</span> <span class="n">force_distortion_centre</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_force_distortion_centre)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1137, __pyx_L1_error)</span>
    if (__pyx_t_11) {
/* … */
      goto __pyx_L4;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1138</span>:             <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_x0 = (0.5 / (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1139</span>:             <span class="n">y0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_y0 = (0.5 / (__pyx_v_y_res / 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1140</span>:             <span class="n">index_offset</span> <span class="o">+=</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_v_index_offset = (__pyx_v_index_offset + 2);
</pre><pre class="cython line score-0">&#xA0;<span class="">1141</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1142</span>:             <span class="c"># Read distortion offsets</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1143</span>:             <span class="n">x0</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_12 = 0;
      __pyx_v_x0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1144</span>:             <span class="n">y0</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_v_y0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
    }
    __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1145</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1146</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1147</span>:         <span class="c"># Normalize offsets</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1148</span>:         <span class="n">x0</span> <span class="o">*=</span> <span class="p">(</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x0 = (__pyx_v_x0 * (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1149</span>:         <span class="n">y0</span> <span class="o">*=</span> <span class="p">(</span><span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y0 = (__pyx_v_y0 * (__pyx_v_y_res / 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1150</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1151</span>:         <span class="c"># Wrap offsets to always be within the image</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1152</span>:         <span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">%</span><span class="n">x_res</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x0 = (((-__pyx_v_x_res) / 2.0) + fmod((__pyx_v_x0 + (__pyx_v_x_res / 2.0)), __pyx_v_x_res));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1153</span>:         <span class="n">y0</span> <span class="o">=</span> <span class="o">-</span><span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">%</span><span class="n">y_res</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y0 = (((-__pyx_v_y_res) / 2.0) + fmod((__pyx_v_y0 + (__pyx_v_y_res / 2.0)), __pyx_v_y_res));
</pre><pre class="cython line score-0">&#xA0;<span class="">1154</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1155</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1156</span>:         <span class="c"># Aspect ratio</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1157</span>:         <span class="k">if</span> <span class="n">equal_aspect</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_equal_aspect)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1157, __pyx_L1_error)</span>
    if (__pyx_t_11) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1158</span>:             <span class="n">xy</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_xy = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1159</span>:             <span class="n">index_offset</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_v_index_offset = (__pyx_v_index_offset + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">1160</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1161</span>:             <span class="n">xy</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">2</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_12 = (2 - __pyx_v_index_offset);
      __pyx_v_xy = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
    }
    __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1162</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1163</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1164</span>:         <span class="c"># Asymmetry correction</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1165</span>:         <span class="k">if</span> <span class="n">asymmetry_corr</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_asymmetry_corr)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1165, __pyx_L1_error)</span>
    if (__pyx_t_11) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1166</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1167</span>:             <span class="c"># Asymmetry amplitude</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1168</span>:             <span class="n">a1</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">3</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (3 - __pyx_v_index_offset);
      __pyx_v_a1 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1169</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1170</span>:             <span class="c"># Asymmetry angle - normalize so full circle fits within 0-1</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1171</span>:             <span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">4</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (4 - __pyx_v_index_offset);
      __pyx_v_a2 = fmod(((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi)), (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi));
</pre><pre class="cython line score-0">&#xA0;<span class="">1172</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1173</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1174</span>:             <span class="n">a1</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_a1 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1175</span>:             <span class="n">a2</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_a2 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1176</span>:             <span class="n">index_offset</span> <span class="o">+=</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_v_index_offset = (__pyx_v_index_offset + 2);
    }
    __pyx_L6:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1177</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1178</span>:         <span class="c"># Distortion coeffs</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1179</span>:         <span class="n">k1</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">5</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = (5 - __pyx_v_index_offset);
    __pyx_v_k1 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1180</span>:         <span class="n">k2</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">6</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = (6 - __pyx_v_index_offset);
    __pyx_v_k2 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1181</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1182</span>:         <span class="k">if</span> <span class="n">x_poly_rev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">7</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (((__pyx_v_x_poly_rev-&gt;dimensions[0]) &gt; (7 - __pyx_v_index_offset)) != 0);
    if (__pyx_t_11) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1183</span>:             <span class="n">k3</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">7</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (7 - __pyx_v_index_offset);
      __pyx_v_k3 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1184</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1185</span>:         <span class="k">if</span> <span class="n">x_poly_rev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">8</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (((__pyx_v_x_poly_rev-&gt;dimensions[0]) &gt; (8 - __pyx_v_index_offset)) != 0);
    if (__pyx_t_11) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1186</span>:             <span class="n">k4</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">8</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (8 - __pyx_v_index_offset);
      __pyx_v_k4 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1187</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1188</span>:         <span class="c"># if x_poly_rev.shape[0] &gt; (9 - index_offset):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1189</span>:         <span class="c">#     k5 = x_poly_rev[9 - index_offset]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1190</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1191</span>:     <span class="c"># If the polynomial distortion was used, unpack the offsets</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1192</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1193</span>:         <span class="n">x0</span> <span class="o">=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_12 = 0;
    __pyx_v_x0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1194</span>:         <span class="n">y0</span> <span class="o">=</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    __pyx_v_y0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides));
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1195</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1196</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1197</span>:     <span class="c"># Convert all equatorial coordinates to image coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1198</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ra_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_13 = (__pyx_v_ra_data-&gt;dimensions[0]);
  __pyx_t_14 = __pyx_t_13;
  for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_14; __pyx_t_15+=1) {
    __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">1199</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1200</span>:         <span class="n">ra</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">ra_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_v_ra = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_ra_data.diminfo[0].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1201</span>:         <span class="n">dec</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">dec_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_v_dec = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_dec_data.diminfo[0].strides)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1202</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1203</span>:         <span class="c">### Gnomonization of star coordinates to image coordinates ###</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1204</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1205</span>:         <span class="c"># Apply refraction</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1206</span>:         <span class="k">if</span> <span class="n">refraction</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_refraction)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1206, __pyx_L1_error)</span>
    if (__pyx_t_11) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1207</span>:             <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">eqRefractionTrueToApparent</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_f_3RMS_10Astrometry_11CyFunctions_eqRefractionTrueToApparent(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lat), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lon), 0);
      __pyx_t_10 = __pyx_t_16.f0;
      __pyx_t_9 = __pyx_t_16.f1;
      __pyx_v_ra = __pyx_t_10;
      __pyx_v_dec = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">1208</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1209</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1210</span>:         <span class="c"># Compute the distance from the FOV centre to the sky coordinate</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1211</span>:         <span class="n">radius</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">angularSeparation</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="n">degrees</span><span class="p">(</span><span class="n">dec</span><span class="p">),</span> <span class="n">degrees</span><span class="p">(</span><span class="n">ra_centre</span><span class="p">),</span> <span class="w">\</span></pre>
<pre class='cython code score-0 '>    __pyx_v_radius = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_f_3RMS_10Astrometry_11CyFunctions_angularSeparation(__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_ra), __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_dec), __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_ra_centre), __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_dec_centre), 0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1212</span>:             <span class="n">degrees</span><span class="p">(</span><span class="n">dec_centre</span><span class="p">)))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1213</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1214</span>:         <span class="c"># Compute theta - the direction angle between the FOV centre, sky coordinate, and the image vertical</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1215</span>:         <span class="n">sin_ang</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span> <span class="o">-</span> <span class="n">ra_centre</span><span class="p">)</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sin_ang = ((cos(__pyx_v_dec) * sin((__pyx_v_ra - __pyx_v_ra_centre))) / sin(__pyx_v_radius));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1216</span>:         <span class="n">cos_ang</span> <span class="o">=</span> <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">dec_centre</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">dec_centre</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_v_cos_ang = ((sin(__pyx_v_dec) - (sin(__pyx_v_dec_centre) * cos(__pyx_v_radius))) / (cos(__pyx_v_dec_centre) * sin(__pyx_v_radius)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1217</span>:         <span class="n">theta</span>   <span class="o">=</span> <span class="o">-</span><span class="n">atan2</span><span class="p">(</span><span class="n">sin_ang</span><span class="p">,</span> <span class="n">cos_ang</span><span class="p">)</span> <span class="o">+</span> <span class="n">pos_angle_ref</span> <span class="o">-</span> <span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_theta = (((-atan2(__pyx_v_sin_ang, __pyx_v_cos_ang)) + __pyx_v_pos_angle_ref) - (__pyx_v_3RMS_10Astrometry_11CyFunctions_pi / 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1218</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1219</span>:         <span class="c"># Calculate the standard coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1220</span>:         <span class="n">x</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">pix_scale</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x = ((__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_radius) * cos(__pyx_v_theta)) * __pyx_v_pix_scale);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1221</span>:         <span class="n">y</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">pix_scale</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y = ((__pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_radius) * sin(__pyx_v_theta)) * __pyx_v_pix_scale);
</pre><pre class="cython line score-0">&#xA0;<span class="">1222</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1223</span>:         <span class="c">### ###</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1224</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1225</span>:         <span class="c"># Set initial distortion values</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1226</span>:         <span class="n">dx</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dx = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1227</span>:         <span class="n">dy</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dy = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1228</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1229</span>:         <span class="c"># Apply 3rd order polynomial + one radial term distortion</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1230</span>:         <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;poly3+radial&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>    if (unlikely(__pyx_v_dist_type == Py_None)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "startswith");
      <span class='error_goto'>__PYX_ERR(0, 1230, __pyx_L1_error)</span>
    }
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_poly3_radial, 0, PY_SSIZE_T_MAX, -1);<span class='error_goto'> if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1230, __pyx_L1_error)</span>
    if ((__pyx_t_11 != 0)) {
/* … */
      goto __pyx_L12;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1231</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1232</span>:             <span class="c"># Compute the radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1233</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = sqrt((pow((__pyx_v_x - __pyx_v_x0), 2.0) + pow((__pyx_v_y - __pyx_v_y0), 2.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1234</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1235</span>:             <span class="c"># Calculate the distortion in X direction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1236</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1237</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1238</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">*</span><span class="n">y</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = 2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1239</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = 3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1240</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = 4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1241</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">5</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_20 = 5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1242</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">6</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_21 = 6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1243</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">7</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">2</span><span class="o">*</span><span class="n">y</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = 7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1244</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">8</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_23 = 8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1245</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">9</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_24 = 9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1246</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">10</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">r</span></pre>
<pre class='cython code score-0 '>      __pyx_t_25 = 10;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1247</span>:                 <span class="o">+</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">11</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">r</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_26 = 11;
      __pyx_v_dx = (((((((((((__pyx_v_x0 + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_x)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_y)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * pow(__pyx_v_x, 2.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_x) * __pyx_v_y)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * pow(__pyx_v_y, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * pow(__pyx_v_x, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * pow(__pyx_v_x, 2.0)) * __pyx_v_y)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_x) * pow(__pyx_v_y, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * pow(__pyx_v_y, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_x) * __pyx_v_r)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_26, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_y) * __pyx_v_r));
</pre><pre class="cython line score-0">&#xA0;<span class="">1248</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1249</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1250</span>:             <span class="c"># Calculate the distortion in Y direction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1251</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1252</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span></pre>
<pre class='cython code score-0 '>      __pyx_t_26 = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1253</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">*</span><span class="n">y</span></pre>
<pre class='cython code score-0 '>      __pyx_t_25 = 2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1254</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_24 = 3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1255</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span></pre>
<pre class='cython code score-0 '>      __pyx_t_23 = 4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1256</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">5</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = 5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1257</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">6</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_21 = 6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1258</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">7</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">2</span><span class="o">*</span><span class="n">y</span></pre>
<pre class='cython code score-0 '>      __pyx_t_20 = 7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1259</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">8</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = 8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1260</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">9</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = 9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1261</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">10</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">r</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = 10;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1262</span>:                 <span class="o">+</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">11</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">r</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 11;
      __pyx_v_dy = (((((((((((__pyx_v_y0 + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_26, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_x)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_y)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * pow(__pyx_v_x, 2.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_x) * __pyx_v_y)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * pow(__pyx_v_y, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * pow(__pyx_v_x, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * pow(__pyx_v_x, 2.0)) * __pyx_v_y)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_x) * pow(__pyx_v_y, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * pow(__pyx_v_y, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_y) * __pyx_v_r)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_x) * __pyx_v_r));
</pre><pre class="cython line score-0">&#xA0;<span class="">1263</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1264</span>:             <span class="c"># If the 3rd order radial term is used, apply it</span></pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1265</span>:             <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;+radial3&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;+radial5&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-14 '>      if (unlikely(__pyx_v_dist_type == Py_None)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "endswith");
        <span class='error_goto'>__PYX_ERR(0, 1265, __pyx_L1_error)</span>
      }
      __pyx_t_27 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_radial3, 0, PY_SSIZE_T_MAX, 1);<span class='error_goto'> if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 1265, __pyx_L1_error)</span>
      if (!(__pyx_t_27 != 0)) {
      } else {
        __pyx_t_11 = (__pyx_t_27 != 0);
        goto __pyx_L14_bool_binop_done;
      }
      if (unlikely(__pyx_v_dist_type == Py_None)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "endswith");
        <span class='error_goto'>__PYX_ERR(0, 1265, __pyx_L1_error)</span>
      }
      __pyx_t_27 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_radial5, 0, PY_SSIZE_T_MAX, 1);<span class='error_goto'> if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 1265, __pyx_L1_error)</span>
      __pyx_t_11 = (__pyx_t_27 != 0);
      __pyx_L14_bool_binop_done:;
      if (__pyx_t_11) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1266</span>:                 <span class="n">dx</span> <span class="o">+=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">12</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 12;
        __pyx_v_dx = (__pyx_v_dx + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_x) * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1267</span>:                 <span class="n">dy</span> <span class="o">+=</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">12</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 12;
        __pyx_v_dy = (__pyx_v_dy + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_y) * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1268</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1269</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1270</span>:             <span class="c"># If the 5th order radial term is used, apply it</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1271</span>:             <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;+radial5&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>      if (unlikely(__pyx_v_dist_type == Py_None)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "endswith");
        <span class='error_goto'>__PYX_ERR(0, 1271, __pyx_L1_error)</span>
      }
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_radial5, 0, PY_SSIZE_T_MAX, 1);<span class='error_goto'> if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1271, __pyx_L1_error)</span>
      if ((__pyx_t_11 != 0)) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1272</span>:                 <span class="n">dx</span> <span class="o">+=</span> <span class="n">x_poly_rev</span><span class="p">[</span><span class="mf">13</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 13;
        __pyx_v_dx = (__pyx_v_dx + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_rev.diminfo[0].strides)) * __pyx_v_x) * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1273</span>:                 <span class="n">dy</span> <span class="o">+=</span> <span class="n">y_poly_rev</span><span class="p">[</span><span class="mf">13</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 13;
        __pyx_v_dy = (__pyx_v_dy + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_rev.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_rev.diminfo[0].strides)) * __pyx_v_y) * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1274</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1275</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1276</span>:         <span class="c"># Apply a radial distortion</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1277</span>:         <span class="k">elif</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;radial&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>    if (unlikely(__pyx_v_dist_type == Py_None)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "startswith");
      <span class='error_goto'>__PYX_ERR(0, 1277, __pyx_L1_error)</span>
    }
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_n_u_radial, 0, PY_SSIZE_T_MAX, -1);<span class='error_goto'> if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1277, __pyx_L1_error)</span>
    if ((__pyx_t_11 != 0)) {
/* … */
    }
    __pyx_L12:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1278</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1279</span>:             <span class="c"># Compute the radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1280</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = sqrt((pow(__pyx_v_x, 2.0) + pow(__pyx_v_y, 2.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1281</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1282</span>:             <span class="c"># Apply the asymmetry correction</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1283</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = ((__pyx_v_r + ((__pyx_v_a1 * __pyx_v_y) * cos(__pyx_v_a2))) - ((__pyx_v_a1 * __pyx_v_x) * sin(__pyx_v_a2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1284</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1285</span>:             <span class="c"># Normalize radius to horizontal size</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1286</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = (__pyx_v_r / (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1287</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1288</span>:             <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r_corr = __pyx_v_r;
</pre><pre class="cython line score-0">&#xA0;<span class="">1289</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1290</span>:             <span class="c"># Apply the 3rd order radial distortion, all powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1291</span>:             <span class="k">if</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial3-all&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_11 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial3_all, Py_EQ)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1291, __pyx_L1_error)</span>
      __pyx_t_27 = (__pyx_t_11 != 0);
      if (__pyx_t_27) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1292</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1293</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1294</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 2.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1295</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1296</span>:             <span class="c"># Apply the 4th order radial distortion, all powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1297</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial4-all&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_27 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial4_all, Py_EQ)); if (unlikely(__pyx_t_27 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1297, __pyx_L1_error)</span>
      __pyx_t_11 = (__pyx_t_27 != 0);
      if (__pyx_t_11) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1298</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1299</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1300</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">4</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = (((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 2.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 4.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1301</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1302</span>:             <span class="c"># Apply the 5th order radial distortion, all powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1303</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial5-all&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_11 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial5_all, Py_EQ)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1303, __pyx_L1_error)</span>
      __pyx_t_27 = (__pyx_t_11 != 0);
      if (__pyx_t_27) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1304</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1305</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1306</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">4</span> <span class="o">+</span> <span class="n">k4</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 2.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 4.0))) + (__pyx_v_k4 * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1307</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1308</span>:             <span class="c"># Apply the 3rd order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1309</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial3-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_27 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial3_odd, Py_EQ)); if (unlikely(__pyx_t_27 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1309, __pyx_L1_error)</span>
      __pyx_t_11 = (__pyx_t_27 != 0);
      if (__pyx_t_11) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1310</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1311</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1312</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = (__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1313</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1314</span>:             <span class="c"># Apply the 5th order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1315</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial5-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_11 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial5_odd, Py_EQ)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1315, __pyx_L1_error)</span>
      __pyx_t_27 = (__pyx_t_11 != 0);
      if (__pyx_t_27) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1316</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1317</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1318</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1319</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1320</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1321</span>:             <span class="c"># Apply the 7th order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1322</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial7-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_27 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial7_odd, Py_EQ)); if (unlikely(__pyx_t_27 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1322, __pyx_L1_error)</span>
      __pyx_t_11 = (__pyx_t_27 != 0);
      if (__pyx_t_11) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1323</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1324</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1325</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">7</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = (((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 5.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 7.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1326</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1327</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1328</span>:             <span class="c"># Apply the 9th order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1329</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial9-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_11 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial9_odd, Py_EQ)); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1329, __pyx_L1_error)</span>
      __pyx_t_27 = (__pyx_t_11 != 0);
      if (__pyx_t_27) {
/* … */
      }
      __pyx_L17:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1330</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1331</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1332</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">7</span> <span class="o">+</span> <span class="n">k4</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">9</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 5.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 7.0))) + (__pyx_v_k4 * pow(__pyx_v_r, 9.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1333</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1334</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1335</span>:             <span class="c"># Compute the scaling term</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1336</span>:             <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_27 = ((__pyx_v_r == 0.0) != 0);
      if (__pyx_t_27) {
/* … */
        goto __pyx_L18;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1337</span>:                 <span class="n">r_scale</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_scale = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1338</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1339</span>:                 <span class="n">r_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_corr</span><span class="o">/</span><span class="n">r</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_r_scale = ((__pyx_v_r_corr / __pyx_v_r) - 1.0);
      }
      __pyx_L18:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1340</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1341</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1342</span>:             <span class="c"># Compute distortion offsets</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1343</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">r_scale</span> <span class="o">-</span> <span class="n">x0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dx = ((__pyx_v_x * __pyx_v_r_scale) - __pyx_v_x0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1344</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">r_scale</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xy</span><span class="p">)</span> <span class="o">-</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xy</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dy = ((((__pyx_v_y * __pyx_v_r_scale) / (1.0 + __pyx_v_xy)) - __pyx_v_y0) + (__pyx_v_y * (1.0 - (1.0 / (1.0 + __pyx_v_xy)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1345</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1346</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1347</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1348</span>:         <span class="c"># Add the distortion</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1349</span>:         <span class="n">x_img</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">dx</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x_img = (__pyx_v_x - __pyx_v_dx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1350</span>:         <span class="n">y_img</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">dy</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y_img = (__pyx_v_y - __pyx_v_dy);
</pre><pre class="cython line score-0">&#xA0;<span class="">1351</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1352</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1353</span>:         <span class="c"># Calculate X image coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1354</span>:         <span class="n">x_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_img</span> <span class="o">+</span> <span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_array.diminfo[0].strides) = (__pyx_v_x_img + (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1355</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1356</span>:         <span class="c"># Calculate Y image coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1357</span>:         <span class="n">y_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_img</span> <span class="o">+</span> <span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_array.diminfo[0].strides) = (__pyx_v_y_img + (__pyx_v_y_res / 2.0));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1358</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1359</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1360</span>:     <span class="k">return</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span></pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1360, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_x_array));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_x_array));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_x_array));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_y_array));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_y_array));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_y_array));
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1361</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1362</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1363</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1364</span>: <span class="k">cdef</span> (<span class="nf">double</span><span class="p">,</span> <span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">pointingCorrection</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>static __pyx_ctuple_double__and_double__and_double __pyx_f_3RMS_10Astrometry_11CyFunctions_pointingCorrection(double __pyx_v_jd, double __pyx_v_lat, double __pyx_v_lon, double __pyx_v_h0, CYTHON_UNUSED double __pyx_v_jd_ref, double __pyx_v_ra_ref, double __pyx_v_dec_ref, double __pyx_v_pos_angle_ref, struct __pyx_opt_args_3RMS_10Astrometry_11CyFunctions_pointingCorrection *__pyx_optional_args) {
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("RMS.Astrometry.CyFunctions.pointingCorrection", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1365</span>:     <span class="n">double</span> <span class="n">jd</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1366</span>:     <span class="n">double</span> <span class="n">h0</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">ra_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_angle_ref</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1367</span>:     <span class="nb">bool</span> <span class="n">refraction</span><span class="o">=</span><span class="bp">True</span></pre>
<pre class='cython code score-0 '>  PyBoolObject *__pyx_v_refraction = ((PyBoolObject *)Py_True);
  double __pyx_v_ra_ref_now;
  double __pyx_v_ra_ref_now_corr;
  double __pyx_v_dec_ref_corr;
  double __pyx_v_ra_ref_now_corr_j2000;
  double __pyx_v_dec_ref_corr_j2000;
  double __pyx_v_pos_angle_ref_now_corr;
  __pyx_ctuple_double__and_double__and_double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pointingCorrection", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_refraction = __pyx_optional_args-&gt;refraction;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1368</span>:     <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1369</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot; Compute the pointing correction for the given Julian date. The correction is done by computing the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1370</span>: <span class="sd">        difference in RA between the current and the reference epoch. The correction is done in the J2000</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1371</span>: <span class="sd">        epoch to avoid the drift of the FOV centre over time.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1372</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1373</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1374</span>: <span class="sd">        jd: [float] Julian date.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1375</span>: <span class="sd">        lat: [float] Latitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1376</span>: <span class="sd">        lon: [float] Longitude of the observer in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1377</span>: <span class="sd">        h0: [float] Reference hour angle in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1378</span>: <span class="sd">        jd_ref: [float] Reference Julian date of the plate solution.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1379</span>: <span class="sd">        ra_ref: [float] Reference right ascension of the image centre in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1380</span>: <span class="sd">        dec_ref: [float] Reference declination of the image centre in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1381</span>: <span class="sd">        pos_angle_ref: [float] Rotation from the celestial meridian in radians.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1382</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1383</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1384</span>: <span class="sd">        refraction: [bool] Apply refraction correction. True by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1385</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1386</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1387</span>: <span class="sd">        (ra_ref_now_corr, dec_ref_corr, pos_angle_ref_now_corr): [tuple]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1388</span>: <span class="sd">            ra_ref_now_corr: [float] Corrected right ascension of the image centre in J2000 (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1389</span>: <span class="sd">            dec_ref_corr: [float] Corrected declination of the image centre in J2000 (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1390</span>: <span class="sd">            pos_angle_ref_now_corr: [float] Corrected position angle in J2000 (radians).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1391</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1392</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1393</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1394</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ra_ref_now</span><span class="p">,</span> <span class="nf">ra_ref_now_corr</span><span class="p">,</span> <span class="nf">dec_ref_corr</span><span class="p">,</span> <span class="nf">ra_ref_now_corr_j2000</span><span class="p">,</span> <span class="nf">dec_ref_corr_j2000</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1395</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pos_angle_ref_now_corr</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1396</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1397</span>:     <span class="c"># Compute the reference RA centre at the given JD by adding the hour angle difference</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1398</span>:     <span class="n">ra_ref_now</span> <span class="o">=</span> <span class="p">(</span><span class="n">ra_ref</span> <span class="o">+</span> <span class="n">radians</span><span class="p">(</span><span class="n">cyjd2LST</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="mf">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">h0</span> <span class="o">+</span> <span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = (((__pyx_v_ra_ref + __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_f_3RMS_10Astrometry_11CyFunctions_cyjd2LST(__pyx_v_jd, 0.0))) - __pyx_v_h0) + (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi));
  __pyx_t_2 = (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi);
  if (unlikely(__pyx_t_2 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float divmod()");
    <span class='error_goto'>__PYX_ERR(0, 1398, __pyx_L1_error)</span>
  }
  __pyx_v_ra_ref_now = __Pyx_mod_double(__pyx_t_1, __pyx_t_2);
</pre><pre class="cython line score-0">&#xA0;<span class="">1399</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1400</span>:     <span class="c"># Correct the FOV centre for refraction</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1401</span>:     <span class="k">if</span> <span class="n">refraction</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_refraction)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1401, __pyx_L1_error)</span>
  if (__pyx_t_3) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1402</span>:         <span class="n">ra_ref_now_corr</span><span class="p">,</span> <span class="n">dec_ref_corr</span> <span class="o">=</span> <span class="n">eqRefractionTrueToApparent</span><span class="p">(</span><span class="n">ra_ref_now</span><span class="p">,</span> <span class="n">dec_ref</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_f_3RMS_10Astrometry_11CyFunctions_eqRefractionTrueToApparent(__pyx_v_ra_ref_now, __pyx_v_dec_ref, __pyx_v_jd, __pyx_v_lat, __pyx_v_lon, 0);
    __pyx_t_2 = __pyx_t_4.f0;
    __pyx_t_1 = __pyx_t_4.f1;
    __pyx_v_ra_ref_now_corr = __pyx_t_2;
    __pyx_v_dec_ref_corr = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">1403</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1404</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1405</span>:         <span class="n">ra_ref_now_corr</span> <span class="o">=</span> <span class="n">ra_ref_now</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_ra_ref_now_corr = __pyx_v_ra_ref_now;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1406</span>:         <span class="n">dec_ref_corr</span> <span class="o">=</span> <span class="n">dec_ref</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dec_ref_corr = __pyx_v_dec_ref;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1407</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1408</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1409</span>:     <span class="c"># Precess the reference RA, dec, position angle to J2000 (needs to be used to avoid FOV centre drift</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1410</span>:     <span class="c"># over time)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1411</span>:     <span class="c"># The position angle needs to be corrected for precession, otherwise the FOV rotates with time</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1412</span>:     <span class="c"># Applying the difference in RA between the current and the reference epoch fixes the position angle</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1413</span>:     <span class="n">ra_ref_now_corr_j2000</span><span class="p">,</span> <span class="n">dec_ref_corr_j2000</span><span class="p">,</span> <span class="n">pos_angle_ref_now_corr</span> <span class="o">=</span> <span class="n">equatorialCoordAndRotPrecession</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_f_3RMS_10Astrometry_11CyFunctions_equatorialCoordAndRotPrecession(__pyx_v_jd, __pyx_v_3RMS_10Astrometry_11CyFunctions_J2000_DAYS, __pyx_v_ra_ref_now_corr, __pyx_v_dec_ref_corr, __pyx_v_pos_angle_ref, 0);
  __pyx_t_1 = __pyx_t_5.f0;
  __pyx_t_2 = __pyx_t_5.f1;
  __pyx_t_6 = __pyx_t_5.f2;
  __pyx_v_ra_ref_now_corr_j2000 = __pyx_t_1;
  __pyx_v_dec_ref_corr_j2000 = __pyx_t_2;
  __pyx_v_pos_angle_ref_now_corr = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">1414</span>:                                         <span class="n">J2000_DAYS</span><span class="p">,</span> <span class="n">ra_ref_now_corr</span><span class="p">,</span> <span class="n">dec_ref_corr</span><span class="p">,</span> <span class="n">pos_angle_ref</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1415</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1416</span>:     <span class="k">return</span> <span class="n">ra_ref_now_corr_j2000</span><span class="p">,</span> <span class="n">dec_ref_corr_j2000</span><span class="p">,</span> <span class="n">pos_angle_ref_now_corr</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5.f0 = __pyx_v_ra_ref_now_corr_j2000;
  __pyx_t_5.f1 = __pyx_v_dec_ref_corr_j2000;
  __pyx_t_5.f2 = __pyx_v_pos_angle_ref_now_corr;
  __pyx_r = __pyx_t_5;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1417</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1418</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1419</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1420</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1421</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1422</span>: <span class="k">def</span> <span class="nf">cyXYToRADec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">jd_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x_data</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class='cython code score-60 '>/* Python wrapper */
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_37cyXYToRADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3RMS_10Astrometry_11CyFunctions_36cyXYToRADec[] = "\n    Arguments:\n        jd_data: [ndarray] Julian date of each data point.\n        x_data: [ndarray] 1D numpy array containing the image column.\n        y_data: [ndarray] 1D numpy array containing the image row.\n        lat: [float] Latitude of the observer in degrees.\n        lon: [float] Longitude of the observer in degrees.\n        x_res: [int] Image size, X dimension (px).\n        y_res: [int] Image size, Y dimension (px).\n        h0: [float] Reference hour angle (deg).\n        jd_ref: [float] Reference Julian date when the plate was fit.\n        ra_ref: [float] Reference right ascension of the image centre (degrees).\n        dec_ref: [float] Reference declination of the image centre (degrees).\n        pos_angle_ref: [float] Field rotation parameter (degrees).\n        pix_scale: [float] Plate scale (px/deg).\n        x_poly_fwd: [ndarray] 1D numpy array of 12 elements containing forward X axis polynomial parameters.\n        y_poly_fwd: [ndarray] 1D numpy array of 12 elements containing forward Y axis polynomial parameters.\n        dist_type: [str] Distortion type. Can be: poly3+radial, radial3, radial4, or radial5.\n        \n    Keyword arguments:\n        refraction: [bool] Apply refraction correction. True by default.\n        equal_aspect: [bool] Force the X/Y aspect ratio to be equal. Used only for radial distortion.             False by default.\n        force_distortion_centre: [bool] Force the distortion centre to the image centre. False by default.\n        asymmetry_corr: [bool] Correct the distortion for asymmetry. Only for radial distortion. True by\n            default.\n        precompute_pointing_corr: [bool] Precompute the pointing correction. False by default. This is used\n            to speed up the calculation when the input JD is the same for all data points, e.g. during\n            plate solving.\n    \n    Return:\n        (ra_data, dec_data): [tuple of ndarrays]\n            \n            ra_data: [ndarray] Right ascensio""n of each point (deg).\n            dec_data: [ndarray] Declination of each point (deg).\n            magnitude_data: [ndarray] Array of meteor's lightcurve apparent magnitudes.\n    ";
static PyMethodDef __pyx_mdef_3RMS_10Astrometry_11CyFunctions_37cyXYToRADec = {"cyXYToRADec", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_3RMS_10Astrometry_11CyFunctions_37cyXYToRADec, METH_VARARGS|METH_KEYWORDS, __pyx_doc_3RMS_10Astrometry_11CyFunctions_36cyXYToRADec};
static PyObject *__pyx_pw_3RMS_10Astrometry_11CyFunctions_37cyXYToRADec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_jd_data = 0;
  PyArrayObject *__pyx_v_x_data = 0;
  PyArrayObject *__pyx_v_y_data = 0;
  double __pyx_v_lat;
  double __pyx_v_lon;
  double __pyx_v_x_res;
  double __pyx_v_y_res;
  double __pyx_v_h0;
  double __pyx_v_jd_ref;
  double __pyx_v_ra_ref;
  double __pyx_v_dec_ref;
  double __pyx_v_pos_angle_ref;
  double __pyx_v_pix_scale;
  PyArrayObject *__pyx_v_x_poly_fwd = 0;
  PyArrayObject *__pyx_v_y_poly_fwd = 0;
  PyObject *__pyx_v_dist_type = 0;
  PyBoolObject *__pyx_v_refraction = 0;
  PyBoolObject *__pyx_v_equal_aspect = 0;
  PyBoolObject *__pyx_v_force_distortion_centre = 0;
  PyBoolObject *__pyx_v_asymmetry_corr = 0;
  PyBoolObject *__pyx_v_precompute_pointing_corr = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyXYToRADec (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_jd_data,&amp;__pyx_n_s_x_data,&amp;__pyx_n_s_y_data,&amp;__pyx_n_s_lat,&amp;__pyx_n_s_lon,&amp;__pyx_n_s_x_res,&amp;__pyx_n_s_y_res,&amp;__pyx_n_s_h0,&amp;__pyx_n_s_jd_ref,&amp;__pyx_n_s_ra_ref,&amp;__pyx_n_s_dec_ref,&amp;__pyx_n_s_pos_angle_ref,&amp;__pyx_n_s_pix_scale,&amp;__pyx_n_s_x_poly_fwd,&amp;__pyx_n_s_y_poly_fwd,&amp;__pyx_n_s_dist_type,&amp;__pyx_n_s_refraction,&amp;__pyx_n_s_equal_aspect,&amp;__pyx_n_s_force_distortion_centre,&amp;__pyx_n_s_asymmetry_corr,&amp;__pyx_n_s_precompute_pointing_corr,0};
    PyObject* values[21] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3RMS_10Astrometry_11CyFunctions_36cyXYToRADec(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_jd_data, PyArrayObject *__pyx_v_x_data, PyArrayObject *__pyx_v_y_data, double __pyx_v_lat, double __pyx_v_lon, double __pyx_v_x_res, double __pyx_v_y_res, double __pyx_v_h0, double __pyx_v_jd_ref, double __pyx_v_ra_ref, double __pyx_v_dec_ref, double __pyx_v_pos_angle_ref, double __pyx_v_pix_scale, PyArrayObject *__pyx_v_x_poly_fwd, PyArrayObject *__pyx_v_y_poly_fwd, PyObject *__pyx_v_dist_type, PyBoolObject *__pyx_v_refraction, PyBoolObject *__pyx_v_equal_aspect, PyBoolObject *__pyx_v_force_distortion_centre, PyBoolObject *__pyx_v_asymmetry_corr, PyBoolObject *__pyx_v_precompute_pointing_corr) {
  int __pyx_v_i;
  double __pyx_v_jd;
  double __pyx_v_x_img;
  double __pyx_v_y_img;
  double __pyx_v_r;
  double __pyx_v_dx;
  double __pyx_v_x_corr;
  double __pyx_v_dy;
  double __pyx_v_y_corr;
  double __pyx_v_r_corr;
  double __pyx_v_r_scale;
  double __pyx_v_x0;
  double __pyx_v_y0;
  double __pyx_v_xy;
  double __pyx_v_a1;
  double __pyx_v_a2;
  double __pyx_v_k1;
  double __pyx_v_k2;
  double __pyx_v_k3;
  double __pyx_v_k4;
  int __pyx_v_index_offset;
  double __pyx_v_radius;
  double __pyx_v_theta;
  double __pyx_v_sin_t;
  double __pyx_v_cos_t;
  double __pyx_v_ra_ref_now_corr;
  double __pyx_v_ra;
  double __pyx_v_dec;
  double __pyx_v_dec_ref_corr;
  double __pyx_v_pos_angle_ref_now_corr;
  PyArrayObject *__pyx_v_ra_data = 0;
  PyArrayObject *__pyx_v_dec_data = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dec_data;
  __Pyx_Buffer __pyx_pybuffer_dec_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_jd_data;
  __Pyx_Buffer __pyx_pybuffer_jd_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ra_data;
  __Pyx_Buffer __pyx_pybuffer_ra_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x_data;
  __Pyx_Buffer __pyx_pybuffer_x_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x_poly_fwd;
  __Pyx_Buffer __pyx_pybuffer_x_poly_fwd;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_y_data;
  __Pyx_Buffer __pyx_pybuffer_y_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_y_poly_fwd;
  __Pyx_Buffer __pyx_pybuffer_y_poly_fwd;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cyXYToRADec", 0);
  __pyx_pybuffer_ra_data.pybuffer.buf = NULL;
  __pyx_pybuffer_ra_data.refcount = 0;
  __pyx_pybuffernd_ra_data.data = NULL;
  __pyx_pybuffernd_ra_data.rcbuffer = &amp;__pyx_pybuffer_ra_data;
  __pyx_pybuffer_dec_data.pybuffer.buf = NULL;
  __pyx_pybuffer_dec_data.refcount = 0;
  __pyx_pybuffernd_dec_data.data = NULL;
  __pyx_pybuffernd_dec_data.rcbuffer = &amp;__pyx_pybuffer_dec_data;
  __pyx_pybuffer_jd_data.pybuffer.buf = NULL;
  __pyx_pybuffer_jd_data.refcount = 0;
  __pyx_pybuffernd_jd_data.data = NULL;
  __pyx_pybuffernd_jd_data.rcbuffer = &amp;__pyx_pybuffer_jd_data;
  __pyx_pybuffer_x_data.pybuffer.buf = NULL;
  __pyx_pybuffer_x_data.refcount = 0;
  __pyx_pybuffernd_x_data.data = NULL;
  __pyx_pybuffernd_x_data.rcbuffer = &amp;__pyx_pybuffer_x_data;
  __pyx_pybuffer_y_data.pybuffer.buf = NULL;
  __pyx_pybuffer_y_data.refcount = 0;
  __pyx_pybuffernd_y_data.data = NULL;
  __pyx_pybuffernd_y_data.rcbuffer = &amp;__pyx_pybuffer_y_data;
  __pyx_pybuffer_x_poly_fwd.pybuffer.buf = NULL;
  __pyx_pybuffer_x_poly_fwd.refcount = 0;
  __pyx_pybuffernd_x_poly_fwd.data = NULL;
  __pyx_pybuffernd_x_poly_fwd.rcbuffer = &amp;__pyx_pybuffer_x_poly_fwd;
  __pyx_pybuffer_y_poly_fwd.pybuffer.buf = NULL;
  __pyx_pybuffer_y_poly_fwd.refcount = 0;
  __pyx_pybuffernd_y_poly_fwd.data = NULL;
  __pyx_pybuffernd_y_poly_fwd.rcbuffer = &amp;__pyx_pybuffer_y_poly_fwd;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_jd_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_jd_data, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_jd_data.diminfo[0].strides = __pyx_pybuffernd_jd_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_jd_data.diminfo[0].shape = __pyx_pybuffernd_jd_data.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x_data, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x_data.diminfo[0].strides = __pyx_pybuffernd_x_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x_data.diminfo[0].shape = __pyx_pybuffernd_x_data.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_y_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_y_data, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_y_data.diminfo[0].strides = __pyx_pybuffernd_y_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_y_data.diminfo[0].shape = __pyx_pybuffernd_y_data.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x_poly_fwd, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides = __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x_poly_fwd.diminfo[0].shape = __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_y_poly_fwd, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides = __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_y_poly_fwd.diminfo[0].shape = __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_jd_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyXYToRADec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_jd_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ra_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_dec_data);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__16 = <span class='py_c_api'>PyTuple_Pack</span>(54, __pyx_n_s_jd_data, __pyx_n_s_x_data, __pyx_n_s_y_data, __pyx_n_s_lat, __pyx_n_s_lon, __pyx_n_s_x_res, __pyx_n_s_y_res, __pyx_n_s_h0, __pyx_n_s_jd_ref, __pyx_n_s_ra_ref, __pyx_n_s_dec_ref, __pyx_n_s_pos_angle_ref, __pyx_n_s_pix_scale, __pyx_n_s_x_poly_fwd, __pyx_n_s_y_poly_fwd, __pyx_n_s_dist_type, __pyx_n_s_refraction, __pyx_n_s_equal_aspect, __pyx_n_s_force_distortion_centre, __pyx_n_s_asymmetry_corr, __pyx_n_s_precompute_pointing_corr, __pyx_n_s_i, __pyx_n_s_jd, __pyx_n_s_x_img, __pyx_n_s_y_img, __pyx_n_s_r, __pyx_n_s_dx, __pyx_n_s_x_corr, __pyx_n_s_dy, __pyx_n_s_y_corr, __pyx_n_s_r_corr, __pyx_n_s_r_scale, __pyx_n_s_x0, __pyx_n_s_y0, __pyx_n_s_xy, __pyx_n_s_a1, __pyx_n_s_a2, __pyx_n_s_k1, __pyx_n_s_k2, __pyx_n_s_k3, __pyx_n_s_k4, __pyx_n_s_k5, __pyx_n_s_index_offset, __pyx_n_s_radius, __pyx_n_s_theta, __pyx_n_s_sin_t, __pyx_n_s_cos_t, __pyx_n_s_ra_ref_now_corr, __pyx_n_s_ra, __pyx_n_s_dec, __pyx_n_s_dec_ref_corr, __pyx_n_s_pos_angle_ref_now_corr, __pyx_n_s_ra_data, __pyx_n_s_dec_data);<span class='error_goto'> if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 1422, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__16);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3RMS_10Astrometry_11CyFunctions_37cyXYToRADec, NULL, __pyx_n_s_RMS_Astrometry_CyFunctions);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1422, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_cyXYToRADec, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1423</span>:     <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">double</span> <span class="n">lat</span><span class="p">,</span> <span class="n">double</span> <span class="n">lon</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_res</span><span class="p">,</span> <span class="n">double</span> <span class="n">y_res</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1424</span>:     <span class="n">double</span> <span class="n">h0</span><span class="p">,</span> <span class="n">double</span> <span class="n">jd_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">ra_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">dec_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_angle_ref</span><span class="p">,</span> <span class="n">double</span> <span class="n">pix_scale</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1425</span>:     <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x_poly_fwd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">FLOAT_TYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">y_poly_fwd</span><span class="p">,</span> <span class="w">\</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1426</span>:     <span class="nb">str</span> <span class="n">dist_type</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">refraction</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">equal_aspect</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">force_distortion_centre</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="w">\</span></pre>
<pre class='cython code score-0 '>    values[16] = (PyObject *)((PyBoolObject *)Py_True);
    values[17] = (PyObject *)((PyBoolObject *)Py_False);
    values[18] = (PyObject *)((PyBoolObject *)Py_False);
</pre><pre class="cython line score-250" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1427</span>:     <span class="nb">bool</span> <span class="n">asymmetry_corr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">precompute_pointing_corr</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre>
<pre class='cython code score-250 '>    values[19] = (PyObject *)((PyBoolObject *)Py_True);
    values[20] = (PyObject *)((PyBoolObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd_data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x_data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 1); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_y_data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 2); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 3); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lon)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 4); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x_res)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 5); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_y_res)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 6); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_h0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 7); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_jd_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 8); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ra_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 9); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dec_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 10); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pos_angle_ref)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 11); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pix_scale)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 12); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x_poly_fwd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 13); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_y_poly_fwd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 14); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dist_type)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, 15); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_refraction);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equal_aspect);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_force_distortion_centre);
          if (value) { values[18] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_asymmetry_corr);
          if (value) { values[19] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_precompute_pointing_corr);
          if (value) { values[20] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cyXYToRADec") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_jd_data = ((PyArrayObject *)values[0]);
    __pyx_v_x_data = ((PyArrayObject *)values[1]);
    __pyx_v_y_data = ((PyArrayObject *)values[2]);
    __pyx_v_lat = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_lat == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
    __pyx_v_lon = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_lon == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
    __pyx_v_x_res = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_x_res == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
    __pyx_v_y_res = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_y_res == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
    __pyx_v_h0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_h0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1424, __pyx_L3_error)</span>
    __pyx_v_jd_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_jd_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1424, __pyx_L3_error)</span>
    __pyx_v_ra_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_ra_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1424, __pyx_L3_error)</span>
    __pyx_v_dec_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_dec_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1424, __pyx_L3_error)</span>
    __pyx_v_pos_angle_ref = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_pos_angle_ref == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1424, __pyx_L3_error)</span>
    __pyx_v_pix_scale = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_pix_scale == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1424, __pyx_L3_error)</span>
    __pyx_v_x_poly_fwd = ((PyArrayObject *)values[13]);
    __pyx_v_y_poly_fwd = ((PyArrayObject *)values[14]);
    __pyx_v_dist_type = ((PyObject*)values[15]);
    __pyx_v_refraction = ((PyBoolObject *)values[16]);
    __pyx_v_equal_aspect = ((PyBoolObject *)values[17]);
    __pyx_v_force_distortion_centre = ((PyBoolObject *)values[18]);
    __pyx_v_asymmetry_corr = ((PyBoolObject *)values[19]);
    __pyx_v_precompute_pointing_corr = ((PyBoolObject *)values[20]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cyXYToRADec", 0, 16, 21, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("RMS.Astrometry.CyFunctions.cyXYToRADec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_jd_data), __pyx_ptype_5numpy_ndarray, 1, "jd_data", 0))) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x_data), __pyx_ptype_5numpy_ndarray, 1, "x_data", 0))) <span class='error_goto'>__PYX_ERR(0, 1422, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_y_data), __pyx_ptype_5numpy_ndarray, 1, "y_data", 0))) <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x_poly_fwd), __pyx_ptype_5numpy_ndarray, 1, "x_poly_fwd", 0))) <span class='error_goto'>__PYX_ERR(0, 1425, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_y_poly_fwd), __pyx_ptype_5numpy_ndarray, 1, "y_poly_fwd", 0))) <span class='error_goto'>__PYX_ERR(0, 1425, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_dist_type), (&amp;PyUnicode_Type), 1, "dist_type", 1))) <span class='error_goto'>__PYX_ERR(0, 1426, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_refraction), __pyx_ptype_7cpython_4bool_bool, 1, "refraction", 0))) <span class='error_goto'>__PYX_ERR(0, 1426, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_equal_aspect), __pyx_ptype_7cpython_4bool_bool, 1, "equal_aspect", 0))) <span class='error_goto'>__PYX_ERR(0, 1426, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_force_distortion_centre), __pyx_ptype_7cpython_4bool_bool, 1, "force_distortion_centre", 0))) <span class='error_goto'>__PYX_ERR(0, 1426, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_asymmetry_corr), __pyx_ptype_7cpython_4bool_bool, 1, "asymmetry_corr", 0))) <span class='error_goto'>__PYX_ERR(0, 1427, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_precompute_pointing_corr), __pyx_ptype_7cpython_4bool_bool, 1, "precompute_pointing_corr", 0))) <span class='error_goto'>__PYX_ERR(0, 1427, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_3RMS_10Astrometry_11CyFunctions_36cyXYToRADec(__pyx_self, __pyx_v_jd_data, __pyx_v_x_data, __pyx_v_y_data, __pyx_v_lat, __pyx_v_lon, __pyx_v_x_res, __pyx_v_y_res, __pyx_v_h0, __pyx_v_jd_ref, __pyx_v_ra_ref, __pyx_v_dec_ref, __pyx_v_pos_angle_ref, __pyx_v_pix_scale, __pyx_v_x_poly_fwd, __pyx_v_y_poly_fwd, __pyx_v_dist_type, __pyx_v_refraction, __pyx_v_equal_aspect, __pyx_v_force_distortion_centre, __pyx_v_asymmetry_corr, __pyx_v_precompute_pointing_corr);
</pre><pre class="cython line score-0">&#xA0;<span class="">1428</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1429</span>: <span class="sd">    Arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1430</span>: <span class="sd">        jd_data: [ndarray] Julian date of each data point.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1431</span>: <span class="sd">        x_data: [ndarray] 1D numpy array containing the image column.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1432</span>: <span class="sd">        y_data: [ndarray] 1D numpy array containing the image row.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1433</span>: <span class="sd">        lat: [float] Latitude of the observer in degrees.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1434</span>: <span class="sd">        lon: [float] Longitude of the observer in degrees.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1435</span>: <span class="sd">        x_res: [int] Image size, X dimension (px).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1436</span>: <span class="sd">        y_res: [int] Image size, Y dimension (px).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1437</span>: <span class="sd">        h0: [float] Reference hour angle (deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1438</span>: <span class="sd">        jd_ref: [float] Reference Julian date when the plate was fit.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1439</span>: <span class="sd">        ra_ref: [float] Reference right ascension of the image centre (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1440</span>: <span class="sd">        dec_ref: [float] Reference declination of the image centre (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1441</span>: <span class="sd">        pos_angle_ref: [float] Field rotation parameter (degrees).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1442</span>: <span class="sd">        pix_scale: [float] Plate scale (px/deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1443</span>: <span class="sd">        x_poly_fwd: [ndarray] 1D numpy array of 12 elements containing forward X axis polynomial parameters.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1444</span>: <span class="sd">        y_poly_fwd: [ndarray] 1D numpy array of 12 elements containing forward Y axis polynomial parameters.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1445</span>: <span class="sd">        dist_type: [str] Distortion type. Can be: poly3+radial, radial3, radial4, or radial5.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1446</span>: <span class="sd">        </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1447</span>: <span class="sd">    Keyword arguments:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1448</span>: <span class="sd">        refraction: [bool] Apply refraction correction. True by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1449</span>: <span class="sd">        equal_aspect: [bool] Force the X/Y aspect ratio to be equal. Used only for radial distortion. \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1450</span>: <span class="sd">            False by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1451</span>: <span class="sd">        force_distortion_centre: [bool] Force the distortion centre to the image centre. False by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1452</span>: <span class="sd">        asymmetry_corr: [bool] Correct the distortion for asymmetry. Only for radial distortion. True by</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1453</span>: <span class="sd">            default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1454</span>: <span class="sd">        precompute_pointing_corr: [bool] Precompute the pointing correction. False by default. This is used</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1455</span>: <span class="sd">            to speed up the calculation when the input JD is the same for all data points, e.g. during</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1456</span>: <span class="sd">            plate solving.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1457</span>: <span class="sd">    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1458</span>: <span class="sd">    Return:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1459</span>: <span class="sd">        (ra_data, dec_data): [tuple of ndarrays]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1460</span>: <span class="sd">            </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1461</span>: <span class="sd">            ra_data: [ndarray] Right ascension of each point (deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1462</span>: <span class="sd">            dec_data: [ndarray] Declination of each point (deg).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1463</span>: <span class="sd">            magnitude_data: [ndarray] Array of meteor&#39;s lightcurve apparent magnitudes.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1464</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1465</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1466</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1467</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">jd</span><span class="p">,</span> <span class="nf">x_img</span><span class="p">,</span> <span class="nf">y_img</span><span class="p">,</span> <span class="nf">r</span><span class="p">,</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">x_corr</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">y_corr</span><span class="p">,</span> <span class="nf">r_corr</span><span class="p">,</span> <span class="nf">r_scale</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1468</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">x0</span><span class="p">,</span> <span class="nf">y0</span><span class="p">,</span> <span class="nf">xy</span><span class="p">,</span> <span class="nf">a1</span><span class="p">,</span> <span class="nf">a2</span><span class="p">,</span> <span class="nf">k1</span><span class="p">,</span> <span class="nf">k2</span><span class="p">,</span> <span class="nf">k3</span><span class="p">,</span> <span class="nf">k4</span><span class="p">,</span> <span class="nf">k5</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1469</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">index_offset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1470</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">radius</span><span class="p">,</span> <span class="nf">theta</span><span class="p">,</span> <span class="nf">sin_t</span><span class="p">,</span> <span class="nf">cos_t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1471</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ra_ref_now_corr</span><span class="p">,</span> <span class="nf">ra</span><span class="p">,</span> <span class="nf">dec</span><span class="p">,</span> <span class="nf">dec_ref_corr</span><span class="p">,</span> <span class="nf">pos_angle_ref_now_corr</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1472</span>: </pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1473</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">ra_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">jd_data</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1473, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1473, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_jd_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_jd_data));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1473, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1473, __pyx_L1_error)</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_ra_data = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1473, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_ra_data.diminfo[0].strides = __pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ra_data.diminfo[0].shape = __pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_ra_data = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1474</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">FLOAT_TYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">dec_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">jd_data</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1474, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros_like);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1474, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_v_jd_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_jd_data));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1474, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1474, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_dec_data = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1474, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_dec_data.diminfo[0].strides = __pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_dec_data.diminfo[0].shape = __pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_dec_data = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1475</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1476</span>:     <span class="k">if</span> <span class="n">precompute_pointing_corr</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_precompute_pointing_corr)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1476, __pyx_L1_error)</span>
  if (__pyx_t_6) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1477</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1478</span>:         <span class="c"># Correct the pointing for precession (output in radians)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1479</span>:         <span class="n">ra_ref_now_corr</span><span class="p">,</span> <span class="n">dec_ref_corr</span><span class="p">,</span> <span class="n">pos_angle_ref_now_corr</span> <span class="o">=</span> <span class="n">pointingCorrection</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9.__pyx_n = 1;
    __pyx_t_9.refraction = __pyx_v_refraction;
    __pyx_t_8 = __pyx_f_3RMS_10Astrometry_11CyFunctions_pointingCorrection(__pyx_t_7, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lat), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lon), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_h0), __pyx_v_jd_ref, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_ra_ref), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_dec_ref), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_pos_angle_ref), &amp;__pyx_t_9); 
    __pyx_t_7 = __pyx_t_8.f0;
    __pyx_t_10 = __pyx_t_8.f1;
    __pyx_t_11 = __pyx_t_8.f2;
    __pyx_v_ra_ref_now_corr = __pyx_t_7;
    __pyx_v_dec_ref_corr = __pyx_t_10;
    __pyx_v_pos_angle_ref_now_corr = __pyx_t_11;
</pre><pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1480</span>:             <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">jd_data</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span></pre>
<pre class='cython code score-30 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_mean);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_jd_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_jd_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1480, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_7 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1480, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1481</span>:             <span class="n">radians</span><span class="p">(</span><span class="n">h0</span><span class="p">),</span> <span class="n">jd_ref</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">ra_ref</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">dec_ref</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">pos_angle_ref</span><span class="p">),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1482</span>:             <span class="n">refraction</span><span class="o">=</span><span class="n">refraction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1483</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1484</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1485</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1486</span>:     <span class="c"># If the radial distortion is used, unpack radial parameters</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1487</span>:     <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;radial&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>  if (unlikely(__pyx_v_dist_type == Py_None)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "startswith");
    <span class='error_goto'>__PYX_ERR(0, 1487, __pyx_L1_error)</span>
  }
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_n_u_radial, 0, PY_SSIZE_T_MAX, -1);<span class='error_goto'> if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1487, __pyx_L1_error)</span>
  if ((__pyx_t_6 != 0)) {
/* … */
    goto __pyx_L4;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1488</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1489</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1490</span>:         <span class="c"># Index offset for reading distortion parameters. May change as equal aspect or asymmetry correction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1491</span>:         <span class="c">#   is toggled on/off</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1492</span>:         <span class="n">index_offset</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_index_offset = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1493</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1494</span>:         <span class="c"># Force the distortion centre to the image centre</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1495</span>:         <span class="k">if</span> <span class="n">force_distortion_centre</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_force_distortion_centre)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1495, __pyx_L1_error)</span>
    if (__pyx_t_6) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1496</span>:             <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_x0 = (0.5 / (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1497</span>:             <span class="n">y0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_y0 = (0.5 / (__pyx_v_y_res / 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1498</span>:             <span class="n">index_offset</span> <span class="o">+=</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_v_index_offset = (__pyx_v_index_offset + 2);
</pre><pre class="cython line score-0">&#xA0;<span class="">1499</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1500</span>:             <span class="c"># Read distortion offsets</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1501</span>:             <span class="n">x0</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_12 = 0;
      __pyx_v_x0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1502</span>:             <span class="n">y0</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_v_y0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
    }
    __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1503</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1504</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1505</span>:         <span class="c"># Normalize offsets</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1506</span>:         <span class="n">x0</span> <span class="o">*=</span> <span class="p">(</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x0 = (__pyx_v_x0 * (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1507</span>:         <span class="n">y0</span> <span class="o">*=</span> <span class="p">(</span><span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y0 = (__pyx_v_y0 * (__pyx_v_y_res / 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1508</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1509</span>:         <span class="c"># Wrap offsets to always be within the image</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1510</span>:         <span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">%</span><span class="n">x_res</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x0 = (((-__pyx_v_x_res) / 2.0) + fmod((__pyx_v_x0 + (__pyx_v_x_res / 2.0)), __pyx_v_x_res));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1511</span>:         <span class="n">y0</span> <span class="o">=</span> <span class="o">-</span><span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">%</span><span class="n">y_res</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y0 = (((-__pyx_v_y_res) / 2.0) + fmod((__pyx_v_y0 + (__pyx_v_y_res / 2.0)), __pyx_v_y_res));
</pre><pre class="cython line score-0">&#xA0;<span class="">1512</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1513</span>:         <span class="c"># Aspect ratio</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1514</span>:         <span class="k">if</span> <span class="n">equal_aspect</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_equal_aspect)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1514, __pyx_L1_error)</span>
    if (__pyx_t_6) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1515</span>:             <span class="n">xy</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_xy = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1516</span>:             <span class="n">index_offset</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_v_index_offset = (__pyx_v_index_offset + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">1517</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1518</span>:             <span class="c"># Read aspect ratio</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1519</span>:             <span class="n">xy</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">2</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_12 = (2 - __pyx_v_index_offset);
      __pyx_v_xy = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
    }
    __pyx_L6:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1520</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1521</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1522</span>:         <span class="c"># Asymmetry correction</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1523</span>:         <span class="k">if</span> <span class="n">asymmetry_corr</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_asymmetry_corr)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1523, __pyx_L1_error)</span>
    if (__pyx_t_6) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1524</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1525</span>:             <span class="c"># Asymmetry amplitude</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1526</span>:             <span class="n">a1</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">3</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (3 - __pyx_v_index_offset);
      __pyx_v_a1 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1527</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1528</span>:             <span class="c"># Asymmetry angle - normalize so full circle fits within 0-1</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1529</span>:             <span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">4</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (4 - __pyx_v_index_offset);
      __pyx_v_a2 = fmod(((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi)), (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi));
</pre><pre class="cython line score-0">&#xA0;<span class="">1530</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1531</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1532</span>:             <span class="n">a1</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_a1 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1533</span>:             <span class="n">a2</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_a2 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1534</span>:             <span class="n">index_offset</span> <span class="o">+=</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_v_index_offset = (__pyx_v_index_offset + 2);
    }
    __pyx_L7:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1535</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1536</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1537</span>:         <span class="c"># Distortion coeffs</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1538</span>:         <span class="n">k1</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">5</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = (5 - __pyx_v_index_offset);
    __pyx_v_k1 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1539</span>:         <span class="n">k2</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">6</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = (6 - __pyx_v_index_offset);
    __pyx_v_k2 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1540</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1541</span>:         <span class="k">if</span> <span class="n">x_poly_fwd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">7</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = (((__pyx_v_x_poly_fwd-&gt;dimensions[0]) &gt; (7 - __pyx_v_index_offset)) != 0);
    if (__pyx_t_6) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1542</span>:             <span class="n">k3</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">7</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (7 - __pyx_v_index_offset);
      __pyx_v_k3 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1543</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1544</span>:         <span class="k">if</span> <span class="n">x_poly_fwd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">8</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = (((__pyx_v_x_poly_fwd-&gt;dimensions[0]) &gt; (8 - __pyx_v_index_offset)) != 0);
    if (__pyx_t_6) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1545</span>:             <span class="n">k4</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">8</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = (8 - __pyx_v_index_offset);
      __pyx_v_k4 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1546</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1547</span>:         <span class="c"># if x_poly_fwd.shape[0] &gt; (9 - index_offset):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1548</span>:         <span class="c">#     k5 = x_poly_fwd[9 - index_offset]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1549</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1550</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1551</span>:     <span class="c"># If the polynomial distortion was used, unpack the offsets</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1552</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1553</span>:         <span class="n">x0</span> <span class="o">=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_12 = 0;
    __pyx_v_x0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1554</span>:         <span class="n">y0</span> <span class="o">=</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    __pyx_v_y0 = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides));
  }
  __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1555</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1556</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1557</span>:     <span class="c"># Go through all given data points and convert them from X, Y to RA, Dec</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1558</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jd_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_13 = (__pyx_v_jd_data-&gt;dimensions[0]);
  __pyx_t_14 = __pyx_t_13;
  for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_14; __pyx_t_15+=1) {
    __pyx_v_i = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">1559</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1560</span>:         <span class="c"># Choose time and image coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1561</span>:         <span class="n">jd</span> <span class="o">=</span> <span class="n">jd_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_v_jd = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_jd_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_jd_data.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1562</span>:         <span class="n">x_img</span> <span class="o">=</span> <span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_v_x_img = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_data.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1563</span>:         <span class="n">y_img</span> <span class="o">=</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_v_y_img = (*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_data.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1564</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1565</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1566</span>:         <span class="c">### APPLY DISTORTION CORRECTION ###</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1567</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1568</span>:         <span class="c"># Normalize image coordinates to the image centre and compute the radius from image centre</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1569</span>:         <span class="n">x_img</span> <span class="o">=</span> <span class="n">x_img</span> <span class="o">-</span> <span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x_img = (__pyx_v_x_img - (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1570</span>:         <span class="n">y_img</span> <span class="o">=</span> <span class="n">y_img</span> <span class="o">-</span> <span class="n">y_res</span><span class="o">/</span><span class="mf">2.0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y_img = (__pyx_v_y_img - (__pyx_v_y_res / 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1571</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1572</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1573</span>:         <span class="c"># Apply 3rd order polynomial + one radial term distortion</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1574</span>:         <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;poly3+radial&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>    if (unlikely(__pyx_v_dist_type == Py_None)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "startswith");
      <span class='error_goto'>__PYX_ERR(0, 1574, __pyx_L1_error)</span>
    }
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_poly3_radial, 0, PY_SSIZE_T_MAX, -1);<span class='error_goto'> if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1574, __pyx_L1_error)</span>
    if ((__pyx_t_6 != 0)) {
/* … */
      goto __pyx_L12;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1575</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1576</span>:             <span class="c"># Compute the radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1577</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x_img</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_img</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = sqrt((pow((__pyx_v_x_img - __pyx_v_x0), 2.0) + pow((__pyx_v_y_img - __pyx_v_y0), 2.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1578</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1579</span>:             <span class="c"># Compute offset in X direction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1580</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1581</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1582</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = 2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1583</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = 3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1584</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">y_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = 4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1585</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">5</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = 5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1586</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">6</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_20 = 6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1587</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">7</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">**</span><span class="mf">2</span><span class="o">*</span><span class="n">y_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_21 = 7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1588</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">8</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">y_img</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = 8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1589</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">9</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_23 = 9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1590</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">10</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">r</span></pre>
<pre class='cython code score-0 '>      __pyx_t_24 = 10;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1591</span>:                 <span class="o">+</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">11</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">*</span><span class="n">r</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_25 = 11;
      __pyx_v_dx = (((((((((((__pyx_v_x0 + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_y_img)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_x_img, 2.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * __pyx_v_y_img)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_y_img, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_x_img, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_x_img, 2.0)) * __pyx_v_y_img)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * pow(__pyx_v_y_img, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_y_img, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * __pyx_v_r)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_y_img) * __pyx_v_r));
</pre><pre class="cython line score-0">&#xA0;<span class="">1592</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1593</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1594</span>:             <span class="c"># Compute offset in Y direction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1595</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1596</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_25 = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1597</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_24 = 2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1598</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_23 = 3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1599</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">y_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = 4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1600</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">5</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_21 = 5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1601</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">6</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_20 = 6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1602</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">7</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">**</span><span class="mf">2</span><span class="o">*</span><span class="n">y_img</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = 7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1603</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">8</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">y_img</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = 8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1604</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">9</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = 9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1605</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">10</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">*</span><span class="n">r</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = 10;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1606</span>:                 <span class="o">+</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">11</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">r</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 11;
      __pyx_v_dy = (((((((((((__pyx_v_y0 + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_y_img)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_x_img, 2.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * __pyx_v_y_img)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_y_img, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_x_img, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_x_img, 2.0)) * __pyx_v_y_img)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * pow(__pyx_v_y_img, 2.0))) + ((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * pow(__pyx_v_y_img, 3.0))) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_y_img) * __pyx_v_r)) + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * __pyx_v_r));
</pre><pre class="cython line score-0">&#xA0;<span class="">1607</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1608</span>:             <span class="c"># If the 3rd order radial term is used, apply it</span></pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1609</span>:             <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;+radial3&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;+radial5&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-14 '>      if (unlikely(__pyx_v_dist_type == Py_None)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "endswith");
        <span class='error_goto'>__PYX_ERR(0, 1609, __pyx_L1_error)</span>
      }
      __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_radial3, 0, PY_SSIZE_T_MAX, 1);<span class='error_goto'> if (unlikely(__pyx_t_26 == ((int)-1))) __PYX_ERR(0, 1609, __pyx_L1_error)</span>
      if (!(__pyx_t_26 != 0)) {
      } else {
        __pyx_t_6 = (__pyx_t_26 != 0);
        goto __pyx_L14_bool_binop_done;
      }
      if (unlikely(__pyx_v_dist_type == Py_None)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "endswith");
        <span class='error_goto'>__PYX_ERR(0, 1609, __pyx_L1_error)</span>
      }
      __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_radial5, 0, PY_SSIZE_T_MAX, 1);<span class='error_goto'> if (unlikely(__pyx_t_26 == ((int)-1))) __PYX_ERR(0, 1609, __pyx_L1_error)</span>
      __pyx_t_6 = (__pyx_t_26 != 0);
      __pyx_L14_bool_binop_done:;
      if (__pyx_t_6) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1610</span>:                 <span class="n">dx</span> <span class="o">+=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">12</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 12;
        __pyx_v_dx = (__pyx_v_dx + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1611</span>:                 <span class="n">dy</span> <span class="o">+=</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">12</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 12;
        __pyx_v_dy = (__pyx_v_dy + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_y_img) * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1612</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1613</span>:             <span class="c"># If the 5th order radial term is used, apply it</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1614</span>:             <span class="k">if</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;+radial5&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>      if (unlikely(__pyx_v_dist_type == Py_None)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "endswith");
        <span class='error_goto'>__PYX_ERR(0, 1614, __pyx_L1_error)</span>
      }
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_kp_u_radial5, 0, PY_SSIZE_T_MAX, 1);<span class='error_goto'> if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1614, __pyx_L1_error)</span>
      if ((__pyx_t_6 != 0)) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1615</span>:                 <span class="n">dx</span> <span class="o">+=</span> <span class="n">x_poly_fwd</span><span class="p">[</span><span class="mf">13</span><span class="p">]</span><span class="o">*</span><span class="n">x_img</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 13;
        __pyx_v_dx = (__pyx_v_dx + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_x_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_x_poly_fwd.diminfo[0].strides)) * __pyx_v_x_img) * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1616</span>:                 <span class="n">dy</span> <span class="o">+=</span> <span class="n">y_poly_fwd</span><span class="p">[</span><span class="mf">13</span><span class="p">]</span><span class="o">*</span><span class="n">y_img</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = 13;
        __pyx_v_dy = (__pyx_v_dy + (((*__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_y_poly_fwd.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_y_poly_fwd.diminfo[0].strides)) * __pyx_v_y_img) * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1617</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1618</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1619</span>:         <span class="c"># Apply a radial distortion</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1620</span>:         <span class="k">elif</span> <span class="n">dist_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;radial&quot;</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>    if (unlikely(__pyx_v_dist_type == Py_None)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "startswith");
      <span class='error_goto'>__PYX_ERR(0, 1620, __pyx_L1_error)</span>
    }
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyUnicode_Tailmatch</span>(__pyx_v_dist_type, __pyx_n_u_radial, 0, PY_SSIZE_T_MAX, -1);<span class='error_goto'> if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1620, __pyx_L1_error)</span>
    if ((__pyx_t_6 != 0)) {
/* … */
    }
    __pyx_L12:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1621</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1622</span>:             <span class="c"># Compute the radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1623</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x_img</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y_img</span> <span class="o">-</span> <span class="n">y0</span><span class="p">))</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = sqrt((pow((__pyx_v_x_img - __pyx_v_x0), 2.0) + pow(((1.0 + __pyx_v_xy) * (__pyx_v_y_img - __pyx_v_y0)), 2.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1624</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1625</span>:             <span class="c"># Apply the asymmetry correction</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1626</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y_img</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">x_img</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = ((__pyx_v_r + (((__pyx_v_a1 * (1.0 + __pyx_v_xy)) * (__pyx_v_y_img - __pyx_v_y0)) * cos(__pyx_v_a2))) - ((__pyx_v_a1 * (__pyx_v_x_img - __pyx_v_x0)) * sin(__pyx_v_a2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1627</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1628</span>:             <span class="c"># Normalize radius to horizontal size</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1629</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">x_res</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r = (__pyx_v_r / (__pyx_v_x_res / 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1630</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1631</span>:             <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span></pre>
<pre class='cython code score-0 '>      __pyx_v_r_corr = __pyx_v_r;
</pre><pre class="cython line score-0">&#xA0;<span class="">1632</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1633</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1634</span>:             <span class="c"># Apply the 3rd order radial distortion, all powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1635</span>:             <span class="k">if</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial3-all&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial3_all, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1635, __pyx_L1_error)</span>
      __pyx_t_26 = (__pyx_t_6 != 0);
      if (__pyx_t_26) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1636</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1637</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1638</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 2.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1639</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1640</span>:             <span class="c"># Apply the 4th order radial distortion, all powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1641</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial4-all&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_26 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial4_all, Py_EQ)); if (unlikely(__pyx_t_26 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1641, __pyx_L1_error)</span>
      __pyx_t_6 = (__pyx_t_26 != 0);
      if (__pyx_t_6) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1642</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1643</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1644</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">4</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = (((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 2.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 4.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1645</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1646</span>:             <span class="c"># Apply the 5th order radial distortion, all powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1647</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial5-all&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial5_all, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1647, __pyx_L1_error)</span>
      __pyx_t_26 = (__pyx_t_6 != 0);
      if (__pyx_t_26) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1648</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1649</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1650</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">4</span> <span class="o">+</span> <span class="n">k4</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 2.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 4.0))) + (__pyx_v_k4 * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1651</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1652</span>:             <span class="c"># Apply the 3rd order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1653</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial3-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_26 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial3_odd, Py_EQ)); if (unlikely(__pyx_t_26 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1653, __pyx_L1_error)</span>
      __pyx_t_6 = (__pyx_t_26 != 0);
      if (__pyx_t_6) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1654</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1655</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1656</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = (__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1657</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1658</span>:             <span class="c"># Apply the 5th order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1659</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial5-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial5_odd, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1659, __pyx_L1_error)</span>
      __pyx_t_26 = (__pyx_t_6 != 0);
      if (__pyx_t_26) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1660</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1661</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1662</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 5.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1663</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1664</span>:             <span class="c"># Apply the 7th order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1665</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial7-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_26 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial7_odd, Py_EQ)); if (unlikely(__pyx_t_26 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1665, __pyx_L1_error)</span>
      __pyx_t_6 = (__pyx_t_26 != 0);
      if (__pyx_t_6) {
/* … */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1666</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1667</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1668</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">7</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = (((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 5.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 7.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1669</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1670</span>:             <span class="c"># Apply the 9th order radial distortion, only odd powers</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1671</span>:             <span class="k">elif</span> <span class="n">dist_type</span> <span class="o">==</span> <span class="s">&quot;radial9-odd&quot;</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_6 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_dist_type, __pyx_kp_u_radial9_odd, Py_EQ)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1671, __pyx_L1_error)</span>
      __pyx_t_26 = (__pyx_t_6 != 0);
      if (__pyx_t_26) {
/* … */
      }
      __pyx_L17:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1672</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1673</span>:                 <span class="c"># Compute the new radius</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1674</span>:                 <span class="n">r_corr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k1</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">3</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">5</span> <span class="o">+</span> <span class="n">k3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">7</span> <span class="o">+</span> <span class="n">k4</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mf">9</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_corr = ((((__pyx_v_r + (__pyx_v_k1 * pow(__pyx_v_r, 3.0))) + (__pyx_v_k2 * pow(__pyx_v_r, 5.0))) + (__pyx_v_k3 * pow(__pyx_v_r, 7.0))) + (__pyx_v_k4 * pow(__pyx_v_r, 9.0)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1675</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1676</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1677</span>:             <span class="c"># Compute the scaling term</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1678</span>:             <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_26 = ((__pyx_v_r == 0.0) != 0);
      if (__pyx_t_26) {
/* … */
        goto __pyx_L18;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1679</span>:                 <span class="n">r_scale</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_r_scale = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1680</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1681</span>:                 <span class="n">r_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_corr</span><span class="o">/</span><span class="n">r</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_r_scale = ((__pyx_v_r_corr / __pyx_v_r) - 1.0);
      }
      __pyx_L18:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1682</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1683</span>:             <span class="c"># Compute offsets</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1684</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_img</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="n">r_scale</span> <span class="o">-</span> <span class="n">x0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dx = (((__pyx_v_x_img - __pyx_v_x0) * __pyx_v_r_scale) - __pyx_v_x0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1685</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_img</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">*</span><span class="n">r_scale</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xy</span><span class="p">)</span> <span class="o">-</span> <span class="n">y0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">xy</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_img</span><span class="o">*</span><span class="n">xy</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dy = (((((__pyx_v_y_img - __pyx_v_y0) * __pyx_v_r_scale) * (1.0 + __pyx_v_xy)) - (__pyx_v_y0 * (1.0 + __pyx_v_xy))) + (__pyx_v_y_img * __pyx_v_xy));
</pre><pre class="cython line score-0">&#xA0;<span class="">1686</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1687</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1688</span>:         <span class="c"># Correct image coordinates for distortion</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1689</span>:         <span class="n">x_corr</span> <span class="o">=</span> <span class="n">x_img</span> <span class="o">+</span> <span class="n">dx</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x_corr = (__pyx_v_x_img + __pyx_v_dx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1690</span>:         <span class="n">y_corr</span> <span class="o">=</span> <span class="n">y_img</span> <span class="o">+</span> <span class="n">dy</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y_corr = (__pyx_v_y_img + __pyx_v_dy);
</pre><pre class="cython line score-0">&#xA0;<span class="">1691</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1692</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1693</span>:         <span class="c"># Gnomonize coordinates</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1694</span>:         <span class="n">x_corr</span> <span class="o">=</span> <span class="n">x_corr</span><span class="o">/</span><span class="n">pix_scale</span></pre>
<pre class='cython code score-0 '>    __pyx_v_x_corr = (__pyx_v_x_corr / __pyx_v_pix_scale);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1695</span>:         <span class="n">y_corr</span> <span class="o">=</span> <span class="n">y_corr</span><span class="o">/</span><span class="n">pix_scale</span></pre>
<pre class='cython code score-0 '>    __pyx_v_y_corr = (__pyx_v_y_corr / __pyx_v_pix_scale);
</pre><pre class="cython line score-0">&#xA0;<span class="">1696</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1697</span>:         <span class="c">### ###</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1698</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1699</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1700</span>:         <span class="c">### Convert gnomonic X, Y to RA, Dec ###</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1701</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1702</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="n">precompute_pointing_corr</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_precompute_pointing_corr)); if (unlikely(__pyx_t_26 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1702, __pyx_L1_error)</span>
    __pyx_t_6 = ((!__pyx_t_26) != 0);
    if (__pyx_t_6) {
/* … */
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1703</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1704</span>:             <span class="c"># Correct the pointing for precession (output in radians)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1705</span>:             <span class="n">ra_ref_now_corr</span><span class="p">,</span> <span class="n">dec_ref_corr</span><span class="p">,</span> <span class="n">pos_angle_ref_now_corr</span> <span class="o">=</span> <span class="n">pointingCorrection</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9.__pyx_n = 1;
      __pyx_t_9.refraction = __pyx_v_refraction;
      __pyx_t_8 = __pyx_f_3RMS_10Astrometry_11CyFunctions_pointingCorrection(__pyx_v_jd, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lat), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lon), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_h0), __pyx_v_jd_ref, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_ra_ref), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_dec_ref), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_pos_angle_ref), &amp;__pyx_t_9); 
      __pyx_t_11 = __pyx_t_8.f0;
      __pyx_t_10 = __pyx_t_8.f1;
      __pyx_t_7 = __pyx_t_8.f2;
      __pyx_v_ra_ref_now_corr = __pyx_t_11;
      __pyx_v_dec_ref_corr = __pyx_t_10;
      __pyx_v_pos_angle_ref_now_corr = __pyx_t_7;
</pre><pre class="cython line score-0">&#xA0;<span class="">1706</span>:                 <span class="n">jd</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1707</span>:                 <span class="n">radians</span><span class="p">(</span><span class="n">h0</span><span class="p">),</span> <span class="n">jd_ref</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">ra_ref</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">dec_ref</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">pos_angle_ref</span><span class="p">),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1708</span>:                 <span class="n">refraction</span><span class="o">=</span><span class="n">refraction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1709</span>:                 <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1710</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1711</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1712</span>:         <span class="c"># Radius from FOV centre to sky coordinate</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1713</span>:         <span class="n">radius</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x_corr</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">y_corr</span><span class="o">**</span><span class="mf">2</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_v_radius = __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(sqrt((pow(__pyx_v_x_corr, 2.0) + pow(__pyx_v_y_corr, 2.0))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1714</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1715</span>:         <span class="c"># Compute theta - the direction angle between the FOV centre, sky coordinate, and the north </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1716</span>:         <span class="c">#   celestial pole</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1717</span>:         <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mf">2</span> <span class="o">-</span> <span class="n">pos_angle_ref_now_corr</span> <span class="o">+</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y_corr</span><span class="p">,</span> <span class="n">x_corr</span><span class="p">))</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_theta = fmod((((__pyx_v_3RMS_10Astrometry_11CyFunctions_pi / 2.0) - __pyx_v_pos_angle_ref_now_corr) + atan2(__pyx_v_y_corr, __pyx_v_x_corr)), (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi));
</pre><pre class="cython line score-0">&#xA0;<span class="">1718</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1719</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1720</span>:         <span class="c"># Compute declination</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1721</span>:         <span class="n">sin_t</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">dec_ref_corr</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">dec_ref_corr</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sin_t = ((sin(__pyx_v_dec_ref_corr) * cos(__pyx_v_radius)) + ((cos(__pyx_v_dec_ref_corr) * sin(__pyx_v_radius)) * cos(__pyx_v_theta)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1722</span>:         <span class="n">dec</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">sin_t</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">sin_t</span><span class="o">**</span><span class="mf">2</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dec = atan2(__pyx_v_sin_t, sqrt((1.0 - pow(__pyx_v_sin_t, 2.0))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1723</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1724</span>:         <span class="c"># Compute right ascension</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1725</span>:         <span class="n">sin_t</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span><span class="o">/</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sin_t = ((sin(__pyx_v_theta) * sin(__pyx_v_radius)) / cos(__pyx_v_dec));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1726</span>:         <span class="n">cos_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dec_ref_corr</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">dec_ref_corr</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_v_cos_t = ((cos(__pyx_v_radius) - (sin(__pyx_v_dec) * sin(__pyx_v_dec_ref_corr))) / (cos(__pyx_v_dec) * cos(__pyx_v_dec_ref_corr)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1727</span>:         <span class="n">ra</span> <span class="o">=</span> <span class="p">(</span><span class="n">ra_ref_now_corr</span> <span class="o">-</span> <span class="n">atan2</span><span class="p">(</span><span class="n">sin_t</span><span class="p">,</span> <span class="n">cos_t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_ra = fmod(((__pyx_v_ra_ref_now_corr - atan2(__pyx_v_sin_t, __pyx_v_cos_t)) + (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi)), (2.0 * __pyx_v_3RMS_10Astrometry_11CyFunctions_pi));
</pre><pre class="cython line score-0">&#xA0;<span class="">1728</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1729</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1730</span>:         <span class="c"># Apply refraction correction</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1731</span>:         <span class="k">if</span> <span class="n">refraction</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_refraction)); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1731, __pyx_L1_error)</span>
    if (__pyx_t_6) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1732</span>:             <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">eqRefractionApparentToTrue</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">jd</span><span class="p">,</span> <span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_27 = __pyx_f_3RMS_10Astrometry_11CyFunctions_eqRefractionApparentToTrue(__pyx_v_ra, __pyx_v_dec, __pyx_v_jd, __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lat), __pyx_f_3RMS_10Astrometry_11CyFunctions_radians(__pyx_v_lon), 0);
      __pyx_t_7 = __pyx_t_27.f0;
      __pyx_t_10 = __pyx_t_27.f1;
      __pyx_v_ra = __pyx_t_7;
      __pyx_v_dec = __pyx_t_10;
</pre><pre class="cython line score-0">&#xA0;<span class="">1733</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1734</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1735</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1736</span>:         <span class="c"># Convert coordinates to degrees</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1737</span>:         <span class="n">ra</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_ra = __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_ra);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1738</span>:         <span class="n">dec</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dec = __pyx_f_3RMS_10Astrometry_11CyFunctions_degrees(__pyx_v_dec);
</pre><pre class="cython line score-0">&#xA0;<span class="">1739</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1740</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1741</span>:         <span class="c"># Assign values to output list</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1742</span>:         <span class="n">ra_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ra</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_ra_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_ra_data.diminfo[0].strides) = __pyx_v_ra;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1743</span>:         <span class="n">dec_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dec</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_3RMS_10Astrometry_11CyFunctions_FLOAT_TYPE_t *, __pyx_pybuffernd_dec_data.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_dec_data.diminfo[0].strides) = __pyx_v_dec;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1744</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1745</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1746</span>:     <span class="k">return</span> <span class="n">ra_data</span><span class="p">,</span> <span class="n">dec_data</span></pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1746, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_ra_data));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_ra_data));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_ra_data));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_dec_data));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_dec_data));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, ((PyObject *)__pyx_v_dec_data));
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre></div></body></html>
